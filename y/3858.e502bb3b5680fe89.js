"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3858],{3858:(QI,Tm,$)=>{$.d(Tm,{O:()=>KI});var p=$(5861),Ge=$(4004),P=$(4650),Nc=$(4986),Rc=$(9751),wt=$(8996),Es=$(9646),ye=$(4976),ao=$(8675),Pc=$(4482),Oc=$(5403);function uo(){return(0,Pc.e)((n,e)=>{let t,r=!1;n.subscribe((0,Oc.x)(e,s=>{const i=t;t=s,r&&e.next([i,s]),r=!0}))})}var E,co=$(5026),xm=$(1884),Fc=$(9300),It=$(2011),Em=$(6895),Mc=($(2644),$(3942)),Tt=$(6881),Ss=$(4859),Qt=$(1877),M=$(2090),Sm=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ke={},lo=lo||{},N=Sm||self;function bs(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function ar(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var ho="closure_uid_"+(1e9*Math.random()>>>0),Cm=0;function Am(n,e,t){return n.call.apply(n.bind,arguments)}function Dm(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,r),n.apply(e,s)}}return function(){return n.apply(e,arguments)}}function xe(n,e,t){return(xe=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Am:Dm).apply(null,arguments)}function Cs(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function de(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,s,i){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[s].apply(r,o)}}function xt(){this.s=this.s,this.o=this.o}xt.prototype.s=!1,xt.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),0)&&function bm(n){Object.prototype.hasOwnProperty.call(n,ho)&&n[ho]||(n[ho]=++Cm)}(this)},xt.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Lc=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function fo(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function Uc(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(bs(r)){const s=n.length||0,i=r.length||0;n.length=s+i;for(let o=0;o<i;o++)n[s+o]=r[o]}else n.push(r)}}function Ee(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}Ee.prototype.h=function(){this.defaultPrevented=!0};var Nm=function(){if(!N.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{N.addEventListener("test",()=>{},e),N.removeEventListener("test",()=>{},e)}catch{}return n}();function ur(n){return/^[\s\xa0]*$/.test(n)}function As(){var n=N.navigator;return n&&(n=n.userAgent)?n:""}function Ze(n){return-1!=As().indexOf(n)}function go(n){return go[" "](n),n}go[" "]=function(){};var po,n,Pm=Ze("Opera"),In=Ze("Trident")||Ze("MSIE"),Vc=Ze("Edge"),mo=Vc||In,qc=Ze("Gecko")&&!(-1!=As().toLowerCase().indexOf("webkit")&&!Ze("Edge"))&&!(Ze("Trident")||Ze("MSIE"))&&!Ze("Edge"),Om=-1!=As().toLowerCase().indexOf("webkit")&&!Ze("Edge");function Bc(){var n=N.document;return n?n.documentMode:void 0}e:{var yo="",_o=(n=As(),qc?/rv:([^\);]+)(\)|;)/.exec(n):Vc?/Edge\/([\d\.]+)/.exec(n):In?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):Om?/WebKit\/(\S+)/.exec(n):Pm?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(_o&&(yo=_o?_o[1]:""),In){var vo=Bc();if(null!=vo&&vo>parseFloat(yo)){po=String(vo);break e}}po=yo}var Fm=N.document&&In&&(Bc()||parseInt(po,10))||void 0;function cr(n,e){if(Ee.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(qc){e:{try{go(e.nodeName);var s=!0;break e}catch{}s=!1}s||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:Mm[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&cr.$.h.call(this)}}de(cr,Ee);var Mm={2:"touch",3:"pen",4:"mouse"};cr.prototype.h=function(){cr.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var lr="closure_listenable_"+(1e6*Math.random()|0),Lm=0;function Um(n,e,t,r,s){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=s,this.key=++Lm,this.fa=this.ia=!1}function Ds(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function Io(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function zc(n){const e={};for(const t in n)e[t]=n[t];return e}const jc="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function $c(n,e){let t,r;for(let s=1;s<arguments.length;s++){for(t in r=arguments[s],r)n[t]=r[t];for(let i=0;i<jc.length;i++)t=jc[i],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function ks(n){this.src=n,this.g={},this.h=0}function To(n,e){var t=e.type;if(t in n.g){var i,r=n.g[t],s=Lc(r,e);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(Ds(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function xo(n,e,t,r){for(var s=0;s<n.length;++s){var i=n[s];if(!i.fa&&i.listener==e&&i.capture==!!t&&i.la==r)return s}return-1}ks.prototype.add=function(n,e,t,r,s){var i=n.toString();(n=this.g[i])||(n=this.g[i]=[],this.h++);var o=xo(n,e,r,s);return-1<o?(e=n[o],t||(e.ia=!1)):((e=new Um(e,this.src,i,!!r,s)).ia=t,n.push(e)),e};var Eo="closure_lm_"+(1e6*Math.random()|0),So={};function Kc(n,e,t,r,s){if(r&&r.once)return Hc(n,e,t,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)Kc(n,e[i],t,r,s);return null}return t=Do(t),n&&n[lr]?n.O(e,t,ar(r)?!!r.capture:!!r,s):Qc(n,e,t,!1,r,s)}function Qc(n,e,t,r,s,i){if(!e)throw Error("Invalid event type");var o=ar(s)?!!s.capture:!!s,a=Co(n);if(a||(n[Eo]=a=new ks(n)),(t=a.add(e,t,r,o,i)).proxy)return t;if(r=function qm(){const e=Bm;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)Nm||(s=o),void 0===s&&(s=!1),n.addEventListener(e.toString(),r,s);else if(n.attachEvent)n.attachEvent(Zc(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function Hc(n,e,t,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)Hc(n,e[i],t,r,s);return null}return t=Do(t),n&&n[lr]?n.P(e,t,ar(r)?!!r.capture:!!r,s):Qc(n,e,t,!0,r,s)}function Wc(n,e,t,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)Wc(n,e[i],t,r,s);else r=ar(r)?!!r.capture:!!r,t=Do(t),n&&n[lr]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=xo(i=n.g[e],t,r,s))&&(Ds(i[t]),Array.prototype.splice.call(i,t,1),0==i.length&&(delete n.g[e],n.h--))):n&&(n=Co(n))&&(e=n.g[e.toString()],n=-1,e&&(n=xo(e,t,r,s)),(t=-1<n?e[n]:null)&&bo(t))}function bo(n){if("number"!=typeof n&&n&&!n.fa){var e=n.src;if(e&&e[lr])To(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(Zc(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=Co(e))?(To(t,n),0==t.h&&(t.src=null,e[Eo]=null)):Ds(n)}}}function Zc(n){return n in So?So[n]:So[n]="on"+n}function Bm(n,e){if(n.fa)n=!0;else{e=new cr(e,this);var t=n.listener,r=n.la||n.src;n.ia&&bo(n),n=t.call(r,e)}return n}function Co(n){return(n=n[Eo])instanceof ks?n:null}var Ao="__closure_events_fn_"+(1e9*Math.random()>>>0);function Do(n){return"function"==typeof n?n:(n[Ao]||(n[Ao]=function(e){return n.handleEvent(e)}),n[Ao])}function fe(){xt.call(this),this.i=new ks(this),this.S=this,this.J=null}function _e(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,"string"==typeof e)e=new Ee(e,n);else if(e instanceof Ee)e.target=e.target||n;else{var s=e;$c(e=new Ee(r,n),s)}if(s=!0,t)for(var i=t.length-1;0<=i;i--){var o=e.g=t[i];s=Ns(o,r,!0,e)&&s}if(s=Ns(o=e.g=n,r,!0,e)&&s,s=Ns(o,r,!1,e)&&s,t)for(i=0;i<t.length;i++)s=Ns(o=e.g=t[i],r,!1,e)&&s}function Ns(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.fa&&o.capture==t){var a=o.listener,u=o.la||o.src;o.ia&&To(n.i,o),s=!1!==a.call(u,r)&&s}}return s&&!r.defaultPrevented}de(fe,xt),fe.prototype[lr]=!0,fe.prototype.removeEventListener=function(n,e,t,r){Wc(this,n,e,t,r)},fe.prototype.N=function(){if(fe.$.N.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Ds(t[r]);delete n.g[e],n.h--}}this.J=null},fe.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},fe.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var ko=N.JSON.stringify;function zm(){var n=No;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var Xc=new class Gm{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new $m,n=>n.reset());class $m{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Km(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function Qm(n){N.setTimeout(()=>{throw n},0)}let hr,dr=!1,No=new class jm{constructor(){this.h=this.g=null}add(e,t){const r=Xc.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},Yc=()=>{const n=N.Promise.resolve(void 0);hr=()=>{n.then(Hm)}};var Hm=()=>{for(var n;n=zm();){try{n.h.call(n.g)}catch(t){Qm(t)}var e=Xc;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}dr=!1};function Rs(n,e){fe.call(this),this.h=n||1,this.g=e||N,this.j=xe(this.qb,this),this.l=Date.now()}function Ro(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}function Po(n,e,t){if("function"==typeof n)t&&(n=xe(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=xe(n.handleEvent,n)}return 2147483647<Number(e)?-1:N.setTimeout(n,e||0)}function Jc(n){n.g=Po(()=>{n.g=null,n.i&&(n.i=!1,Jc(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}de(Rs,fe),(E=Rs.prototype).ga=!1,E.T=null,E.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),_e(this,"tick"),this.ga&&(Ro(this),this.start()))}},E.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},E.N=function(){Rs.$.N.call(this),Ro(this),delete this.g};class Wm extends xt{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Jc(this)}N(){super.N(),this.g&&(N.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function fr(n){xt.call(this),this.h=n,this.g={}}de(fr,xt);var el=[];function tl(n,e,t,r){Array.isArray(t)||(t&&(el[0]=t.toString()),t=el);for(var s=0;s<t.length;s++){var i=Kc(e,t[s],r||n.handleEvent,!1,n.h||n);if(!i)break;n.g[i.key]=i}}function nl(n){Io(n.g,function(e,t){this.g.hasOwnProperty(t)&&bo(e)},n),n.g={}}function Ps(){this.g=!0}function Tn(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function Jm(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return ko(t)}catch{return e}}(n,t)+(r?" "+r:"")})}fr.prototype.N=function(){fr.$.N.call(this),nl(this)},fr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ps.prototype.Ea=function(){this.g=!1},Ps.prototype.info=function(){};var Ht={},rl=null;function Os(){return rl=rl||new fe}function sl(n){Ee.call(this,Ht.Ta,n)}function gr(n){const e=Os();_e(e,new sl(e))}function il(n,e){Ee.call(this,Ht.STAT_EVENT,n),this.stat=e}function De(n){const e=Os();_e(e,new il(e,n))}function ol(n,e){Ee.call(this,Ht.Ua,n),this.size=e}function mr(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return N.setTimeout(function(){n()},e)}Ht.Ta="serverreachability",de(sl,Ee),Ht.STAT_EVENT="statevent",de(il,Ee),Ht.Ua="timingevent",de(ol,Ee);var Fs={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},al={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Oo(){}function cl(){}Oo.prototype.h=null;var Lo,pr={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Fo(){Ee.call(this,"d")}function Mo(){Ee.call(this,"c")}function Ms(){}function yr(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new fr(this),this.P=ep,this.V=new Rs(n=mo?125:void 0),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new ll}function ll(){this.i=null,this.g="",this.h=!1}de(Fo,Ee),de(Mo,Ee),de(Ms,Oo),Ms.prototype.g=function(){return new XMLHttpRequest},Ms.prototype.i=function(){return{}},Lo=new Ms;var ep=45e3,Uo={},Ls={};function Vo(n,e,t){n.L=1,n.v=Bs(ut(e)),n.s=t,n.S=!0,hl(n,null)}function hl(n,e){n.G=Date.now(),_r(n),n.A=ut(n.v);var t=n.A,r=n.W;Array.isArray(r)||(r=[String(r)]),Il(t.i,"t",r),n.C=0,t=n.l.J,n.h=new ll,n.g=$l(n.l,t?e:null,!n.s),0<n.O&&(n.M=new Wm(xe(n.Pa,n,n.g),n.O)),tl(n.U,n.g,"readystatechange",n.nb),e=n.I?zc(n.I):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.A,n.u,n.s,e)):(n.u="GET",n.g.ha(n.A,n.u,null,e)),gr(),function Zm(n,e,t,r,s,i){n.info(function(){if(n.g)if(i)for(var o="",a=i.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+c+"&":o+(l+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.u,n.A,n.m,n.W,n.s)}function dl(n){return!!n.g&&"GET"==n.u&&2!=n.L&&n.l.Ha}function fl(n,e,t){let s,r=!0;for(;!n.J&&n.C<t.length;){if(s=tp(n,t),s==Ls){4==e&&(n.o=4,De(14),r=!1),Tn(n.j,n.m,null,"[Incomplete Response]");break}if(s==Uo){n.o=4,De(15),Tn(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}Tn(n.j,n.m,s,null),qo(n,s)}dl(n)&&s!=Ls&&s!=Uo&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,De(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,(e=n.l).g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),Qo(e),e.M=!0,De(11))):(Tn(n.j,n.m,t,"[Invalid Chunked Response]"),Wt(n),vr(n))}function tp(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?Ls:(t=Number(e.substring(t,r)),isNaN(t)?Uo:(r+=1)+t>e.length?Ls:(e=e.slice(r,r+t),n.C=r+t,e))}function _r(n){n.Y=Date.now()+n.P,gl(n,n.P)}function gl(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=mr(xe(n.lb,n),e)}function Us(n){n.B&&(N.clearTimeout(n.B),n.B=null)}function vr(n){0==n.l.H||n.J||Bl(n.l,n)}function Wt(n){Us(n);var e=n.M;e&&"function"==typeof e.sa&&e.sa(),n.M=null,Ro(n.V),nl(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function qo(n,e){try{var t=n.l;if(0!=t.H&&(t.g==n||Bo(t.i,n)))if(!n.K&&Bo(t.i,n)&&3==t.H){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){e:if(!t.u){if(t.g){if(!(t.g.G+3e3<n.G))break e;Qs(t),$s(t)}Ko(t),De(18)}}else t.Fa=s[1],0<t.Fa-t.V&&37500>s[2]&&t.G&&0==t.A&&!t.v&&(t.v=mr(xe(t.ib,t),6e3));if(1>=El(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else Xt(t,11)}else if((n.K||t.g==n)&&Qs(t),!ur(e))for(s=t.Ja.g.parse(e),e=0;e<s.length;e++){let c=s[e];if(t.V=c[0],c=c[1],2==t.H)if("c"==c[0]){t.K=c[1],t.pa=c[2];const l=c[3];null!=l&&(t.ra=l,t.l.info("VER="+t.ra));const h=c[4];null!=h&&(t.Ga=h,t.l.info("SVER="+t.Ga));const d=c[5];null!=d&&"number"==typeof d&&0<d&&(t.L=r=1.5*d,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;const f=n.g;if(f){const y=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(y){var i=r.i;i.g||-1==y.indexOf("spdy")&&-1==y.indexOf("quic")&&-1==y.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(Go(i,i.h),i.h=null))}if(r.F){const I=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;I&&(r.Da=I,H(r.I,r.F,I))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms"));var o=n;if((r=t).wa=jl(r,r.J?r.pa:null,r.Y),o.K){Sl(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.B&&(Us(a),_r(a)),r.g=o}else Vl(r);0<t.j.length&&Ks(t)}else"stop"!=c[0]&&"close"!=c[0]||Xt(t,7);else 3==t.H&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?Xt(t,7):$o(t):"noop"!=c[0]&&t.h&&t.h.Aa(c),t.A=0)}gr()}catch{}}function ml(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(bs(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function rp(n){if(n.ta&&"function"==typeof n.ta)return n.ta();if(!n.Z||"function"!=typeof n.Z){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(bs(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function np(n){if(n.Z&&"function"==typeof n.Z)return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(bs(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),s=r.length,i=0;i<s;i++)e.call(void 0,r[i],t&&t[i],n)}(E=yr.prototype).setTimeout=function(n){this.P=n},E.nb=function(n){n=n.target;const e=this.M;e&&3==Xe(n)?e.l():this.Pa(n)},E.Pa=function(n){try{if(n==this.g)e:{const l=Xe(this.g);var e=this.g.Ia();if(this.g.da(),!(3>l)&&(3!=l||mo||this.g&&(this.h.h||this.g.ja()||Pl(this.g)))){this.J||4!=l||7==e||gr(),Us(this);var t=this.g.da();this.ca=t;t:if(dl(this)){var r=Pl(this.g);n="";var s=r.length,i=4==Xe(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){Wt(this),vr(this);var o="";break t}this.h.i=new N.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:i&&e==s-1});r.splice(0,s),this.h.g+=n,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==t,function Xm(n,e,t,r,s,i,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+t+"\n"+i+" "+o})}(this.j,this.u,this.A,this.m,this.W,l,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ur(a)){var c=a;break t}}c=null}if(!(t=c)){this.i=!1,this.o=3,De(12),Wt(this),vr(this);break e}Tn(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,qo(this,t)}this.S?(fl(this,l,o),mo&&this.i&&3==l&&(tl(this.U,this.V,"tick",this.mb),this.V.start())):(Tn(this.j,this.m,o,null),qo(this,o)),4==l&&Wt(this),this.i&&!this.J&&(4==l?Bl(this.l,this):(this.i=!1,_r(this)))}else(function Ip(n){const e={};n=(n.g&&2<=Xe(n)&&n.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<n.length;r++){if(ur(n[r]))continue;var t=Km(n[r]);const s=t[0];if("string"!=typeof(t=t[1]))continue;t=t.trim();const i=e[s]||[];e[s]=i,i.push(t)}!function Vm(n,e){for(const t in n)e.call(void 0,n[t],t,n)}(e,function(r){return r.join(", ")})})(this.g),400==t&&0<o.indexOf("Unknown SID")?(this.o=3,De(12)):(this.o=0,De(13)),Wt(this),vr(this)}}}catch{}},E.mb=function(){if(this.g){var n=Xe(this.g),e=this.g.ja();this.C<e.length&&(Us(this),fl(this,n,e),this.i&&4!=n&&_r(this))}},E.cancel=function(){this.J=!0,Wt(this)},E.lb=function(){this.B=null;const n=Date.now();0<=n-this.Y?(function Ym(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.L&&(gr(),De(17)),Wt(this),this.o=2,vr(this)):gl(this,this.Y-n)};var pl=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Zt(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Zt){this.h=n.h,Vs(this,n.j),this.s=n.s,this.g=n.g,qs(this,n.m),this.l=n.l;var e=n.i,t=new Tr;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),yl(this,t),this.o=n.o}else n&&(e=String(n).match(pl))?(this.h=!1,Vs(this,e[1]||"",!0),this.s=wr(e[2]||""),this.g=wr(e[3]||"",!0),qs(this,e[4]),this.l=wr(e[5]||"",!0),yl(this,e[6]||"",!0),this.o=wr(e[7]||"")):(this.h=!1,this.i=new Tr(null,this.h))}function ut(n){return new Zt(n)}function Vs(n,e,t){n.j=t?wr(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function qs(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function yl(n,e,t){e instanceof Tr?(n.i=e,function lp(n,e){e&&!n.j&&(Et(n),n.i=null,n.g.forEach(function(t,r){var s=r.toLowerCase();r!=s&&(vl(this,r),Il(this,s,t))},n)),n.j=e}(n.i,n.h)):(t||(e=Ir(e,up)),n.i=new Tr(e,n.h))}function H(n,e,t){n.i.set(e,t)}function Bs(n){return H(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function wr(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Ir(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,ip),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function ip(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}Zt.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Ir(e,_l,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(Ir(e,_l,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(Ir(t,"/"==t.charAt(0)?ap:op,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Ir(t,cp)),n.join("")};var _l=/[#\/\?@]/g,op=/[#\?:]/g,ap=/[#\?]/g,up=/[#\?@]/g,cp=/#/g;function Tr(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Et(n){n.g||(n.g=new Map,n.h=0,n.i&&function sp(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),s=null;if(0<=r){var i=n[t].substring(0,r);s=n[t].substring(r+1)}else i=n[t];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function vl(n,e){Et(n),e=xn(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function wl(n,e){return Et(n),e=xn(n,e),n.g.has(e)}function Il(n,e,t){vl(n,e),0<t.length&&(n.i=null,n.g.set(xn(n,e),fo(t)),n.h+=t.length)}function xn(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function Tl(n){this.l=n||dp,n=N.PerformanceNavigationTiming?0<(n=N.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(N.g&&N.g.Ka&&N.g.Ka()&&N.g.Ka().ec),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(E=Tr.prototype).add=function(n,e){Et(this),this.i=null,n=xn(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},E.forEach=function(n,e){Et(this),this.g.forEach(function(t,r){t.forEach(function(s){n.call(e,s,r,this)},this)},this)},E.ta=function(){Et(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const s=n[r];for(let i=0;i<s.length;i++)t.push(e[r])}return t},E.Z=function(n){Et(this);let e=[];if("string"==typeof n)wl(this,n)&&(e=e.concat(this.g.get(xn(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},E.set=function(n,e){return Et(this),this.i=null,wl(this,n=xn(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},E.get=function(n,e){return n&&0<(n=this.Z(n)).length?String(n[0]):e},E.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const i=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var s=i;""!==o[r]&&(s+="="+encodeURIComponent(String(o[r]))),n.push(s)}}return this.i=n.join("&")};var dp=10;function xl(n){return!!n.h||!!n.g&&n.g.size>=n.j}function El(n){return n.h?1:n.g?n.g.size:0}function Bo(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function Go(n,e){n.g?n.g.add(e):n.h=e}function Sl(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function bl(n){if(null!=n.h)return n.i.concat(n.h.F);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return fo(n.i)}Tl.prototype.cancel=function(){if(this.i=bl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}};var fp=class{stringify(n){return N.JSON.stringify(n,void 0)}parse(n){return N.JSON.parse(n,void 0)}};function gp(){this.g=new fp}function mp(n,e,t){const r=t||"";try{ml(n,function(s,i){let o=s;ar(s)&&(o=ko(s)),e.push(r+i+"="+encodeURIComponent(o))})}catch(s){throw e.push(r+"type="+encodeURIComponent("_badmap")),s}}function Gs(n,e,t,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch{}}function xr(n){this.l=n.fc||null,this.j=n.ob||!1}function zs(n,e){fe.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=zo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}de(xr,Oo),xr.prototype.g=function(){return new zs(this.l,this.j)},xr.prototype.i=function(n){return function(){return n}}({}),de(zs,fe);var zo=0;function Cl(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}function Er(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Sr(n)}function Sr(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(E=zs.prototype).open=function(n,e){if(this.readyState!=zo)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,Sr(this)},E.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||N).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},E.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Er(this)),this.readyState=zo},E.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Sr(this)),this.g&&(this.readyState=3,Sr(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof N.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Cl(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))},E.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Er(this):Sr(this),3==this.readyState&&Cl(this)}},E.Za=function(n){this.g&&(this.response=this.responseText=n,Er(this))},E.Ya=function(n){this.g&&(this.response=n,Er(this))},E.ka=function(){this.g&&Er(this)},E.setRequestHeader=function(n,e){this.v.append(n,e)},E.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},E.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(zs.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var yp=N.JSON.parse;function ne(n){fe.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Al,this.L=this.M=!1}de(ne,fe);var Al="",_p=/^https?$/i,vp=["POST","PUT"];function Dl(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,kl(n),js(n)}function kl(n){n.F||(n.F=!0,_e(n,"complete"),_e(n,"error"))}function Nl(n){if(n.h&&typeof lo<"u"&&(!n.C[1]||4!=Xe(n)||2!=n.da()))if(n.v&&4==Xe(n))Po(n.La,0,n);else if(_e(n,"readystatechange"),4==Xe(n)){n.h=!1;try{const o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===o){var s=String(n.I).match(pl)[1]||null;!s&&N.self&&N.self.location&&(s=N.self.location.protocol.slice(0,-1)),r=!_p.test(s?s.toLowerCase():"")}t=r}if(t)_e(n,"complete"),_e(n,"success");else{n.m=6;try{var i=2<Xe(n)?n.g.statusText:""}catch{i=""}n.j=i+" ["+n.da()+"]",kl(n)}}finally{js(n)}}}function js(n,e){if(n.g){Rl(n);const t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||_e(n,"ready");try{t.onreadystatechange=r}catch{}}}function Rl(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(N.clearTimeout(n.A),n.A=null)}function Xe(n){return n.g?n.g.readyState:0}function Pl(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case Al:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function Ol(n){let e="";return Io(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function jo(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=Ol(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):H(n,e,t))}function br(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function Fl(n){this.Ga=0,this.j=[],this.l=new Ps,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=br("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=br("baseRetryDelayMs",5e3,n),this.hb=br("retryDelaySeedMs",1e4,n),this.eb=br("forwardChannelMaxRetries",2,n),this.xa=br("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.dc||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new Tl(n&&n.concurrentRequestLimit),this.Ja=new gp,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function $o(n){if(Ml(n),3==n.H){var e=n.W++,t=ut(n.I);if(H(t,"SID",n.K),H(t,"RID",e),H(t,"TYPE","terminate"),Cr(n,t),(e=new yr(n,n.l,e)).L=2,e.v=Bs(ut(t)),t=!1,N.navigator&&N.navigator.sendBeacon)try{t=N.navigator.sendBeacon(e.v.toString(),"")}catch{}!t&&N.Image&&((new Image).src=e.v,t=!0),t||(e.g=$l(e.l,null),e.g.ha(e.v)),e.G=Date.now(),_r(e)}zl(n)}function $s(n){n.g&&(Qo(n),n.g.cancel(),n.g=null)}function Ml(n){$s(n),n.u&&(N.clearTimeout(n.u),n.u=null),Qs(n),n.i.cancel(),n.m&&("number"==typeof n.m&&N.clearTimeout(n.m),n.m=null)}function Ks(n){if(!xl(n.i)&&!n.m){n.m=!0;var e=n.Na;hr||Yc(),dr||(hr(),dr=!0),No.add(e,n),n.C=0}}function Ll(n,e){var t;t=e?e.m:n.W++;const r=ut(n.I);H(r,"SID",n.K),H(r,"RID",t),H(r,"AID",n.V),Cr(n,r),n.o&&n.s&&jo(r,n.o,n.s),t=new yr(n,n.l,t,n.C+1),null===n.o&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=Ul(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Go(n.i,t),Vo(t,r,e)}function Cr(n,e){n.na&&Io(n.na,function(t,r){H(e,r,t)}),n.h&&ml({},function(t,r){H(e,r,t)})}function Ul(n,e,t){t=Math.min(n.j.length,t);var r=n.h?xe(n.h.Va,n.h,n):null;e:{var s=n.j;let i=-1;for(;;){const o=["count="+t];-1==i?0<t?(i=s[0].g,o.push("ofs="+i)):i=0:o.push("ofs="+i);let a=!0;for(let u=0;u<t;u++){let c=s[u].g;const l=s[u].map;if(c-=i,0>c)i=Math.max(0,s[u].g-100),a=!1;else try{mp(l,o,"req"+c+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function Vl(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;hr||Yc(),dr||(hr(),dr=!0),No.add(e,n),n.A=0}}function Ko(n){return!(n.g||n.u||3<=n.A||(n.ba++,n.u=mr(xe(n.Ma,n),Gl(n,n.A)),n.A++,0))}function Qo(n){null!=n.B&&(N.clearTimeout(n.B),n.B=null)}function ql(n){n.g=new yr(n,n.l,"rpc",n.ba),null===n.o&&(n.g.I=n.s),n.g.O=0;var e=ut(n.wa);H(e,"RID","rpc"),H(e,"SID",n.K),H(e,"AID",n.V),H(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&H(e,"TO",n.qa),H(e,"TYPE","xmlhttp"),Cr(n,e),n.o&&n.s&&jo(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.v=Bs(ut(e)),t.s=null,t.S=!0,hl(t,n)}function Qs(n){null!=n.v&&(N.clearTimeout(n.v),n.v=null)}function Bl(n,e){var t=null;if(n.g==e){Qs(n),Qo(n),n.g=null;var r=2}else{if(!Bo(n.i,e))return;t=e.F,Sl(n.i,e),r=1}if(0!=n.H)if(e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.G;var s=n.C;_e(r=Os(),new ol(r,t)),Ks(n)}else Vl(n);else if(3==(s=e.o)||0==s&&0<e.ca||!(1==r&&function Tp(n,e){return!(El(n.i)>=n.i.j-(n.m?1:0)||(n.m?(n.j=e.F.concat(n.j),0):1==n.H||2==n.H||n.C>=(n.cb?0:n.eb)||(n.m=mr(xe(n.Na,n,e),Gl(n,n.C)),n.C++,0)))}(n,e)||2==r&&Ko(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),s){case 1:Xt(n,5);break;case 4:Xt(n,10);break;case 3:Xt(n,6);break;default:Xt(n,2)}}function Gl(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function Xt(n,e){if(n.l.info("Error code "+e),2==e){var t=null;n.h&&(t=null);var r=xe(n.pb,n);t||(t=new Zt("//www.google.com/images/cleardot.gif"),N.location&&"http"==N.location.protocol||Vs(t,"https"),Bs(t)),function pp(n,e){const t=new Ps;if(N.Image){const r=new Image;r.onload=Cs(Gs,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Cs(Gs,t,r,"TestLoadImage: error",!1,e),r.onabort=Cs(Gs,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Cs(Gs,t,r,"TestLoadImage: timeout",!1,e),N.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else De(2);n.H=0,n.h&&n.h.za(e),zl(n),Ml(n)}function zl(n){if(n.H=0,n.ma=[],n.h){const e=bl(n.i);(0!=e.length||0!=n.j.length)&&(Uc(n.ma,e),Uc(n.ma,n.j),n.i.i.length=0,fo(n.j),n.j.length=0),n.h.ya()}}function jl(n,e,t){var r=t instanceof Zt?ut(t):new Zt(t);if(""!=r.g)e&&(r.g=e+"."+r.g),qs(r,r.m);else{var s=N.location;r=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var i=new Zt(null);r&&Vs(i,r),e&&(i.g=e),s&&qs(i,s),t&&(i.l=t),r=i}return e=n.Da,(t=n.F)&&e&&H(r,t,e),H(r,"VER",n.ra),Cr(n,r),r}function $l(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new ne(t&&n.Ha&&!n.va?new xr({ob:!0}):n.va)).Oa(n.J),e}function Kl(){}function Hs(){if(In&&!(10<=Number(Fm)))throw Error("Environmental error: no available transport.")}function Le(n,e){fe.call(this),this.g=new Fl(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!ur(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!ur(e)&&(this.g.F=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new En(this)}function Ql(n){Fo.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function Hl(){Mo.call(this),this.status=1}function En(n){this.g=n}function Qe(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Ho(n,e,t){t||(t=0);var r=Array(16);if("string"==typeof e)for(var s=0;16>s;++s)r[s]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(s=0;16>s;++s)r[s]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var i=n.g[3],o=(e=n.g[0])+(i^(t=n.g[1])&((s=n.g[2])^i))+r[0]+3614090360&4294967295;o=(t=(s=(i=(e=(t=(s=(i=(e=(t=(s=(i=(e=(t=(s=(i=(e=(t=(s=(i=(e=(t=(s=(i=(e=(t=(s=(i=(e=(t=(s=(i=(e=(t=(s=(i=(e=(t=(s=(i=(e=(t=(s=(i=(e=(t=(s=(i=(e=(t=(s=(i=(e=(t=(s=(i=(e=(t=(s=(i=(e=t+(o<<7&4294967295|o>>>25))+((o=i+(s^e&(t^s))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=s+(t^i&(e^t))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^s&(i^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^t&(s^i))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(t^s))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=s+(t^i&(e^t))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^s&(i^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^t&(s^i))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(t^s))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=s+(t^i&(e^t))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^s&(i^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^t&(s^i))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(t^s))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=s+(t^i&(e^t))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=t+(e^s&(i^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^i&(t^s))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=i+(t^s&(e^t))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^t&(i^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=t+(i^e&(s^i))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(t^s))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=i+(t^s&(e^t))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^t&(i^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=t+(i^e&(s^i))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(t^s))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=i+(t^s&(e^t))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^t&(i^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=t+(i^e&(s^i))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(t^s))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=i+(t^s&(e^t))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^t&(i^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=t+(i^e&(s^i))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(t^s^i)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^t^s)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^t)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=t+(s^i^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^s^i)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^t^s)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^t)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=t+(s^i^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^s^i)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^t^s)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^t)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=t+(s^i^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(t^s^i)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^t^s)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^t)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=t+(s^i^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(s^(t|~i))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=i+(t^(e|~s))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~t))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=t+(i^(s|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(t|~i))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=i+(t^(e|~s))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~t))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=t+(i^(s|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(t|~i))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=i+(t^(e|~s))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~t))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=t+(i^(s|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((i=(e=t+((o=e+(s^(t|~i))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=i+(t^(e|~s))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((s=i+((o=s+(e^(i|~t))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+s&4294967295,n.g[3]=n.g[3]+i&4294967295}function z(n,e){this.h=e;for(var t=[],r=!0,s=n.length-1;0<=s;s--){var i=0|n[s];r&&i==e||(t[s]=i,r=!1)}this.g=t}(E=ne.prototype).Oa=function(n){this.M=n},E.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Lo.g(),this.C=function ul(n){return n.h||(n.h=n.i())}(this.u?this.u:Lo),this.g.onreadystatechange=xe(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(i){return void Dl(this,i)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)t.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const i of r.keys())t.set(i,r.get(i))}r=Array.from(t.keys()).find(i=>"content-type"==i.toLowerCase()),s=N.FormData&&n instanceof N.FormData,!(0<=Lc(vp,e))||r||s||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,o]of t)this.g.setRequestHeader(i,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Rl(this),0<this.B&&((this.L=function wp(n){return In&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=xe(this.ua,this)):this.A=Po(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(i){Dl(this,i)}},E.ua=function(){typeof lo<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,_e(this,"timeout"),this.abort(8))},E.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,_e(this,"complete"),_e(this,"abort"),js(this))},E.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),js(this,!0)),ne.$.N.call(this)},E.La=function(){this.s||(this.G||this.v||this.l?Nl(this):this.kb())},E.kb=function(){Nl(this)},E.isActive=function(){return!!this.g},E.da=function(){try{return 2<Xe(this)?this.g.status:-1}catch{return-1}},E.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}},E.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),yp(e)}},E.Ia=function(){return this.m},E.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(E=Fl.prototype).ra=8,E.H=1,E.Na=function(n){if(this.m)if(this.m=null,1==this.H){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const s=new yr(this,this.l,n);let i=this.s;if(this.U&&(i?(i=zc(i),$c(i,this.U)):i=this.U),null!==this.o||this.O||(s.I=i,i=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){var r=this.j[t];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=Ul(this,s,e),H(t=ut(this.I),"RID",n),H(t,"CVER",22),this.F&&H(t,"X-HTTP-Session-Id",this.F),Cr(this,t),i&&(this.O?e="headers="+encodeURIComponent(String(Ol(i)))+"&"+e:this.o&&jo(t,this.o,i)),Go(this.i,s),this.bb&&H(t,"TYPE","init"),this.P?(H(t,"$req",e),H(t,"SID","null"),s.aa=!0,Vo(s,t,null)):Vo(s,t,e),this.H=2}}else 3==this.H&&(n?Ll(this,n):0==this.j.length||xl(this.i)||Ll(this))},E.Ma=function(){if(this.u=null,ql(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=mr(xe(this.jb,this),n)}},E.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,De(10),$s(this),ql(this))},E.ib=function(){null!=this.v&&(this.v=null,$s(this),Ko(this),De(19))},E.pb=function(n){n?(this.l.info("Successfully pinged google.com"),De(2)):(this.l.info("Failed to ping google.com"),De(1))},E.isActive=function(){return!!this.h&&this.h.isActive(this)},(E=Kl.prototype).Ba=function(){},E.Aa=function(){},E.za=function(){},E.ya=function(){},E.isActive=function(){return!0},E.Va=function(){},Hs.prototype.g=function(n,e){return new Le(n,e)},de(Le,fe),Le.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;De(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=jl(n,null,n.Y),Ks(n)},Le.prototype.close=function(){$o(this.g)},Le.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=ko(n),n=t);e.j.push(new class{constructor(n,e){this.g=n,this.map=e}}(e.fb++,n)),3==e.H&&Ks(e)},Le.prototype.N=function(){this.g.h=null,delete this.j,$o(this.g),delete this.g,Le.$.N.call(this)},de(Ql,Fo),de(Hl,Mo),de(En,Kl),En.prototype.Ba=function(){_e(this.g,"a")},En.prototype.Aa=function(n){_e(this.g,new Ql(n))},En.prototype.za=function(n){_e(this.g,new Hl)},En.prototype.ya=function(){_e(this.g,"b")},de(Qe,function xp(){this.blockSize=-1}),Qe.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Qe.prototype.j=function(n,e){void 0===e&&(e=n.length);for(var t=e-this.blockSize,r=this.m,s=this.h,i=0;i<e;){if(0==s)for(;i<=t;)Ho(this,n,i),i+=this.blockSize;if("string"==typeof n){for(;i<e;)if(r[s++]=n.charCodeAt(i++),s==this.blockSize){Ho(this,r),s=0;break}}else for(;i<e;)if(r[s++]=n[i++],s==this.blockSize){Ho(this,r),s=0;break}}this.h=s,this.i+=e},Qe.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=255&t,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};var Ep={};function Wo(n){return-128<=n&&128>n?function Rm(n,e){var t=Ep;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}(n,function(e){return new z([0|e],0>e?-1:0)}):new z([0|n],0>n?-1:0)}function Ye(n){if(isNaN(n)||!isFinite(n))return Sn;if(0>n)return ve(Ye(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=Zo;return new z(e,0)}var Zo=4294967296,Sn=Wo(0),Xo=Wo(1),Zl=Wo(16777216);function ct(n){if(0!=n.h)return!1;for(var e=0;e<n.g.length;e++)if(0!=n.g[e])return!1;return!0}function ze(n){return-1==n.h}function ve(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new z(t,~n.h).add(Xo)}function Ws(n,e){return n.add(ve(e))}function Zs(n,e){for(;(65535&n[e])!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function Ar(n,e){this.g=n,this.h=e}function Xs(n,e){if(ct(e))throw Error("division by zero");if(ct(n))return new Ar(Sn,Sn);if(ze(n))return e=Xs(ve(n),e),new Ar(ve(e.g),ve(e.h));if(ze(e))return e=Xs(n,ve(e)),new Ar(ve(e.g),e.h);if(30<n.g.length){if(ze(n)||ze(e))throw Error("slowDivide_ only works with positive integers.");for(var t=Xo,r=e;0>=r.X(n);)t=Xl(t),r=Xl(r);var s=bn(t,1),i=bn(r,1);for(r=bn(r,2),t=bn(t,2);!ct(r);){var o=i.add(r);0>=o.X(n)&&(s=s.add(t),i=o),r=bn(r,1),t=bn(t,1)}return e=Ws(n,s.R(e)),new Ar(s,e)}for(s=Sn;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(t)/Math.LN2))?1:Math.pow(2,r-48),o=(i=Ye(t)).R(e);ze(o)||0<o.X(n);)o=(i=Ye(t-=r)).R(e);ct(i)&&(i=Xo),s=s.add(i),n=Ws(n,o)}return new Ar(s,n)}function Xl(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new z(t,n.h)}function bn(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,s=[],i=0;i<r;i++)s[i]=0<e?n.D(i+t)>>>e|n.D(i+t+1)<<32-e:n.D(i+t);return new z(s,n.h)}(E=z.prototype).ea=function(){if(ze(this))return-ve(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:Zo+r)*e,e*=Zo}return n},E.toString=function(n){if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if(ct(this))return"0";if(ze(this))return"-"+ve(this).toString(n);for(var e=Ye(Math.pow(n,6)),t=this,r="";;){var s=Xs(t,e).g,i=((0<(t=Ws(t,s.R(e))).g.length?t.g[0]:t.h)>>>0).toString(n);if(ct(t=s))return i+r;for(;6>i.length;)i="0"+i;r=i+r}},E.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h},E.X=function(n){return ze(n=Ws(this,n))?-1:ct(n)?0:1},E.abs=function(){return ze(this)?ve(this):this},E.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,s=0;s<=e;s++){var i=r+(65535&this.D(s))+(65535&n.D(s)),o=(i>>>16)+(this.D(s)>>>16)+(n.D(s)>>>16);r=o>>>16,t[s]=(o&=65535)<<16|(i&=65535)}return new z(t,-2147483648&t[t.length-1]?-1:0)},E.R=function(n){if(ct(this)||ct(n))return Sn;if(ze(this))return ze(n)?ve(this).R(ve(n)):ve(ve(this).R(n));if(ze(n))return ve(this.R(ve(n)));if(0>this.X(Zl)&&0>n.X(Zl))return Ye(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<n.g.length;s++){var i=this.D(r)>>>16,o=65535&this.D(r),a=n.D(s)>>>16,u=65535&n.D(s);t[2*r+2*s]+=o*u,Zs(t,2*r+2*s),t[2*r+2*s+1]+=i*u,Zs(t,2*r+2*s+1),t[2*r+2*s+1]+=o*a,Zs(t,2*r+2*s+1),t[2*r+2*s+2]+=i*a,Zs(t,2*r+2*s+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new z(t,0)},E.gb=function(n){return Xs(this,n).h},E.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new z(t,this.h&n.h)},E.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new z(t,this.h|n.h)},E.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new z(t,this.h^n.h)},Hs.prototype.createWebChannel=Hs.prototype.g,Le.prototype.send=Le.prototype.u,Le.prototype.open=Le.prototype.m,Le.prototype.close=Le.prototype.close,Fs.NO_ERROR=0,Fs.TIMEOUT=8,Fs.HTTP_ERROR=6,al.COMPLETE="complete",cl.EventType=pr,pr.OPEN="a",pr.CLOSE="b",pr.ERROR="c",pr.MESSAGE="d",fe.prototype.listen=fe.prototype.O,ne.prototype.listenOnce=ne.prototype.P,ne.prototype.getLastError=ne.prototype.Sa,ne.prototype.getLastErrorCode=ne.prototype.Ia,ne.prototype.getStatus=ne.prototype.da,ne.prototype.getResponseJson=ne.prototype.Wa,ne.prototype.getResponseText=ne.prototype.ja,ne.prototype.send=ne.prototype.ha,ne.prototype.setWithCredentials=ne.prototype.Oa,Qe.prototype.digest=Qe.prototype.l,Qe.prototype.reset=Qe.prototype.reset,Qe.prototype.update=Qe.prototype.j,z.prototype.add=z.prototype.add,z.prototype.multiply=z.prototype.R,z.prototype.modulo=z.prototype.gb,z.prototype.compare=z.prototype.X,z.prototype.toNumber=z.prototype.ea,z.prototype.toString=z.prototype.toString,z.prototype.getBits=z.prototype.D,z.fromNumber=Ye,z.fromString=function Wl(n,e){if(0==n.length)throw Error("number format error: empty string");if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if("-"==n.charAt(0))return ve(Wl(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=Ye(Math.pow(e,8)),r=Sn,s=0;s<n.length;s+=8){var i=Math.min(8,n.length-s),o=parseInt(n.substring(s,s+i),e);8>i?(i=Ye(Math.pow(e,i)),r=r.R(i).add(Ye(o))):r=(r=r.R(t)).add(Ye(o))}return r};var Sp=Ke.createWebChannelTransport=function(){return new Hs},bp=Ke.getStatEventTarget=function(){return Os()},Yo=Ke.ErrorCode=Fs,Cp=Ke.EventType=al,Ap=Ke.Event=Ht,Yl=Ke.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Dp=Ke.FetchXmlHttpFactory=xr,Ys=Ke.WebChannel=cl,kp=Ke.XhrIo=ne,Np=Ke.Md5=Qe,Cn=Ke.Integer=z;const Jl="@firebase/firestore";class ge{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ge.UNAUTHENTICATED=new ge(null),ge.GOOGLE_CREDENTIALS=new ge("google-credentials-uid"),ge.FIRST_PARTY=new ge("first-party-uid"),ge.MOCK_USER=new ge("mock-user");let An="9.23.0";const St=new Qt.Yd("@firebase/firestore");function Jo(){return St.logLevel}function v(n,...e){if(St.logLevel<=Qt.in.DEBUG){const t=e.map(ea);St.debug(`Firestore (${An}): ${n}`,...t)}}function ie(n,...e){if(St.logLevel<=Qt.in.ERROR){const t=e.map(ea);St.error(`Firestore (${An}): ${n}`,...t)}}function je(n,...e){if(St.logLevel<=Qt.in.WARN){const t=e.map(ea);St.warn(`Firestore (${An}): ${n}`,...t)}}function ea(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch{return n}}function S(n="Unexpected state"){const e=`FIRESTORE (${An}) INTERNAL ASSERTION FAILED: `+n;throw ie(e),new Error(e)}function C(n,e){n||S()}function x(n,e){return n}const m={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class _ extends M.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class le{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class eh{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Op{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ge.UNAUTHENTICATED))}shutdown(){}}class Fp{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Mp{constructor(e){this.t=e,this.currentUser=ge.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let s=this.i;const i=c=>this.i!==s?(s=this.i,t(c)):Promise.resolve();let o=new le;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new le,e.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const c=o;e.enqueueRetryable((0,p.Z)(function*(){yield c.promise,yield i(r.currentUser)}))},u=c=>{v("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(v("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new le)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(v("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(C("string"==typeof r.accessToken),new eh(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return C(null===e||"string"==typeof e),new ge(e)}}class Lp{constructor(e,t,r){this.h=e,this.l=t,this.m=r,this.type="FirstParty",this.user=ge.FIRST_PARTY,this.g=new Map}p(){return this.m?this.m():null}get headers(){this.g.set("X-Goog-AuthUser",this.h);const e=this.p();return e&&this.g.set("Authorization",e),this.l&&this.g.set("X-Goog-Iam-Authorization-Token",this.l),this.g}}class Up{constructor(e,t,r){this.h=e,this.l=t,this.m=r}getToken(){return Promise.resolve(new Lp(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(ge.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class th{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Vp{constructor(e){this.I=e,this.forceRefresh=!1,this.appCheck=null,this.T=null}start(e,t){const r=i=>{null!=i.error&&v("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.T;return this.T=i.token,v("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{v("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.appCheck.addTokenListener(this.o)};this.I.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.I.getImmediate({optional:!0});i?s(i):v("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(C("string"==typeof t.token),this.T=t.token,new th(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function qp(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class nh{static A(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=qp(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function k(n,e){return n<e?-1:n>e?1:0}function Dn(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function rh(n){return n+"\0"}class J{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new _(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new _(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new _(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new _(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return J.fromMillis(Date.now())}static fromDate(e){return J.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new J(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?k(this.nanoseconds,e.nanoseconds):k(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class A{constructor(e){this.timestamp=e}static fromTimestamp(e){return new A(e)}static min(){return new A(new J(0,0))}static max(){return new A(new J(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Dr{constructor(e,t,r){void 0===t?t=0:t>e.length&&S(),void 0===r?r=e.length-t:r>e.length-t&&S(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===Dr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Dr?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class V extends Dr{construct(e,t,r){return new V(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new _(m.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new V(t)}static emptyPath(){return new V([])}}const Bp=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class re extends Dr{construct(e,t,r){return new re(e,t,r)}static isValidIdentifier(e){return Bp.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),re.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new re(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(0===r.length)throw new _(m.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if("\\"===a){if(s+1===e.length)throw new _(m.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new _(m.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else"`"===a?(o=!o,s++):"."!==a||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new _(m.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new re(t)}static emptyPath(){return new re([])}}class T{constructor(e){this.path=e}static fromPath(e){return new T(V.fromString(e))}static fromName(e){return new T(V.fromString(e).popFirst(5))}static empty(){return new T(V.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===V.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return V.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new T(new V(e.slice()))}}class Js{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function ta(n){return n.fields.find(e=>2===e.kind)}function Yt(n){return n.fields.filter(e=>2!==e.kind)}Js.UNKNOWN_ID=-1;class ei{constructor(e,t){this.fieldPath=e,this.kind=t}}class kr{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new kr(0,Ue.min())}}function sh(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=A.fromTimestamp(1e9===r?new J(t+1,0):new J(t,r));return new Ue(s,T.empty(),e)}function ih(n){return new Ue(n.readTime,n.key,-1)}class Ue{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Ue(A.min(),T.empty(),-1)}static max(){return new Ue(A.max(),T.empty(),-1)}}function na(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=T.comparator(n.documentKey,e.documentKey),0!==t?t:k(n.largestBatchId,e.largestBatchId))}const oh="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ah{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function bt(n){return ra.apply(this,arguments)}function ra(){return ra=(0,p.Z)(function*(n){if(n.code!==m.FAILED_PRECONDITION||n.message!==oh)throw n;v("LocalStore","Unexpectedly lost primary lease")}),ra.apply(this,arguments)}class g{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&S(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new g((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof g?t:g.resolve(t)}catch(t){return g.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):g.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):g.reject(t)}static resolve(e){return new g((t,r)=>{t(e)})}static reject(e){return new g((t,r)=>{r(e)})}static waitFor(e){return new g((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},u=>r(u))}),o=!0,i===s&&t()})}static or(e){let t=g.resolve(!1);for(const r of e)t=t.next(s=>s?g.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new g((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let u=0;u<i;u++){const c=u;t(e[c]).next(l=>{o[c]=l,++a,a===i&&r(o)},l=>s(l))}})}static doWhile(e,t){return new g((r,s)=>{const i=()=>{!0===e()?t().next(()=>{i()},s):r()};i()})}}class ti{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.v=new le,this.transaction.oncomplete=()=>{this.v.resolve()},this.transaction.onabort=()=>{t.error?this.v.reject(new Nr(e,t.error)):this.v.resolve()},this.transaction.onerror=r=>{const s=sa(r.target.error);this.v.reject(new Nr(e,s))}}static open(e,t,r,s){try{return new ti(t,e.transaction(s,r))}catch(i){throw new Nr(t,i)}}get R(){return this.v.promise}abort(e){e&&this.v.reject(e),this.aborted||(v("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}P(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new $p(t)}}class He{constructor(e,t,r){this.name=e,this.version=t,this.V=r,12.2===He.S((0,M.z$)())&&ie("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return v("SimpleDb","Removing database:",e),Jt(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,M.hl)())return!1;if(He.C())return!0;const e=(0,M.z$)(),t=He.S(e),r=0<t&&t<10,s=He.N(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static C(){var e;return typeof process<"u"&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.k)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static N(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}$(e){var t=this;return(0,p.Z)(function*(){return t.db||(v("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,s)=>{const i=indexedDB.open(t.name,t.version);i.onsuccess=o=>{r(o.target.result)},i.onblocked=()=>{s(new Nr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=o=>{const a=o.target.error;s("VersionError"===a.name?new _(m.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===a.name?new _(m.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a):new Nr(e,a))},i.onupgradeneeded=o=>{v("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.V.O(o.target.result,i.transaction,o.oldVersion,t.version).next(()=>{v("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.F&&(t.db.onversionchange=r=>t.F(r)),t.db})()}B(e){this.F=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,s){var i=this;return(0,p.Z)(function*(){const o="readonly"===t;let a=0;for(;;){++a;try{i.db=yield i.$(e);const u=ti.open(i.db,e,o?"readonly":"readwrite",r),c=s(u).next(l=>(u.P(),l)).catch(l=>(u.abort(l),g.reject(l))).toPromise();return c.catch(()=>{}),yield u.R,c}catch(u){const c=u,l="FirebaseError"!==c.name&&a<3;if(v("SimpleDb","Transaction failed with error:",c.message,"Retrying:",l),i.close(),!l)return Promise.reject(c)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class jp{constructor(e){this.L=e,this.q=!1,this.U=null}get isDone(){return this.q}get K(){return this.U}set cursor(e){this.L=e}done(){this.q=!0}G(e){this.U=e}delete(){return Jt(this.L.delete())}}class Nr extends _{constructor(e,t){super(m.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Ct(n){return"IndexedDbTransactionError"===n.name}class $p{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(v("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(v("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Jt(r)}add(e){return v("SimpleDb","ADD",this.store.name,e,e),Jt(this.store.add(e))}get(e){return Jt(this.store.get(e)).next(t=>(void 0===t&&(t=null),v("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return v("SimpleDb","DELETE",this.store.name,e),Jt(this.store.delete(e))}count(){return v("SimpleDb","COUNT",this.store.name),Jt(this.store.count())}j(e,t){const r=this.options(e,t);if(r.index||"function"!=typeof this.store.getAll){const s=this.cursor(r),i=[];return this.W(s,(o,a)=>{i.push(a)}).next(()=>i)}{const s=this.store.getAll(r.range);return new g((i,o)=>{s.onerror=a=>{o(a.target.error)},s.onsuccess=a=>{i(a.target.result)}})}}H(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new g((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}J(e,t){v("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.Y=!1;const s=this.cursor(r);return this.W(s,(i,o,a)=>a.delete())}X(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.W(s,t)}Z(e){const t=this.cursor({});return new g((r,s)=>{t.onerror=i=>{const o=sa(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}W(e,t){const r=[];return new g((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const u=new jp(a),c=t(a.primaryKey,a.value,u);if(c instanceof g){const l=c.catch(h=>(u.done(),g.reject(h)));r.push(l)}u.isDone?s():null===u.K?a.continue():a.continue(u.K)}}).next(()=>g.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.Y?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Jt(n){return new g((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const s=sa(r.target.error);t(s)}})}let uh=!1;function sa(n){const e=He.S((0,M.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new _("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return uh||(uh=!0,setTimeout(()=>{throw r},0)),r}}return n}class Kp{constructor(e,t){this.asyncQueue=e,this.tt=t,this.task=null}start(){this.et(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}et(e){var t=this;v("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,p.Z)(function*(){t.task=null;try{v("IndexBackiller",`Documents written: ${yield t.tt.nt()}`)}catch(r){Ct(r)?v("IndexBackiller","Ignoring IndexedDB error during index backfill: ",r):yield bt(r)}yield t.et(6e4)}))}}class Qp{constructor(e,t){this.localStore=e,this.persistence=t}nt(e=50){var t=this;return(0,p.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.st(r,e))})()}st(e,t){const r=new Set;let s=t,i=!0;return g.doWhile(()=>!0===i&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(null!==o&&!r.has(o))return v("IndexBackiller",`Processing collection: ${o}`),this.it(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}it(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.rt(s,i)).next(a=>(v("IndexBackiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}rt(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=ih(i);na(o,r)>0&&(r=o)}),new Ue(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}let Ve=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=s=>this.ot(s),this.ut=s=>r.writeSequenceNumber(s))}ot(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ut&&this.ut(t),t}}return n.ct=-1,n})();function Rr(n){return null==n}function Pr(n){return 0===n&&1/n==-1/0}function ch(n){return"number"==typeof n&&Number.isInteger(n)&&!Pr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function Se(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=lh(e)),e=Hp(n.get(t),e);return lh(e)}function Hp(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=i}}return t}function lh(n){return n+"\x01\x01"}function Je(n){const e=n.length;if(C(e>=2),2===e)return C("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),V.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("\x01",i);switch((o<0||o>t)&&S(),n.charAt(o+1)){case"\x01":const a=n.substring(i,o);let u;0===s.length?u=a:(s+=a,u=s,s=""),r.push(u);break;case"\x10":s+=n.substring(i,o),s+="\0";break;case"\x11":s+=n.substring(i,o+1);break;default:S()}i=o+2}return new V(r)}const hh=["userId","batchId"];function ni(n,e){return[n,Se(e)]}function dh(n,e,t){return[n,Se(e),t]}const Wp={},Zp=["prefixPath","collectionGroup","readTime","documentId"],Xp=["prefixPath","collectionGroup","documentId"],Yp=["collectionGroup","readTime","prefixPath","documentId"],Jp=["canonicalId","targetId"],ey=["targetId","path"],ty=["path","targetId"],ny=["collectionId","parent"],ry=["indexId","uid"],sy=["uid","sequenceNumber"],iy=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],oy=["indexId","uid","orderedDocumentKey"],ay=["userId","collectionPath","documentId"],uy=["userId","collectionPath","largestBatchId"],cy=["userId","collectionGroup","largestBatchId"],fh=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],ly=[...fh,"documentOverlays"],gh=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],mh=gh,hy=[...mh,"indexConfiguration","indexState","indexEntries"];class ia extends ah{constructor(e,t){super(),this.ht=e,this.currentSequenceNumber=t}}function me(n,e){const t=x(n);return He.M(t.ht,e)}function ph(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function At(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function yh(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class K{constructor(e,t){this.comparator=e,this.root=t||we.EMPTY}insert(e,t){return new K(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,we.BLACK,null,null))}remove(e){return new K(this.comparator,this.root.remove(e,this.comparator).copy(null,null,we.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(0===s)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ri(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ri(this.root,e,this.comparator,!1)}getReverseIterator(){return new ri(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ri(this.root,e,this.comparator,!0)}}class ri{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class we{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=null!=r?r:we.RED,this.left=null!=s?s:we.EMPTY,this.right=null!=i?i:we.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new we(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):0===i?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return we.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return we.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,we.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,we.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw S();const e=this.left.check();if(e!==this.right.check())throw S();return e+(this.isRed()?0:1)}}we.EMPTY=null,we.RED=!0,we.BLACK=!1,we.EMPTY=new class{constructor(){this.size=0}get key(){throw S()}get value(){throw S()}get color(){throw S()}get left(){throw S()}get right(){throw S()}copy(n,e,t,r,s){return this}insert(n,e,t){return new we(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class W{constructor(e){this.comparator=e,this.data=new K(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new _h(this.data.getIterator())}getIteratorFrom(e){return new _h(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof W)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(0!==this.comparator(s,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new W(this.comparator);return t.data=e,t}}class _h{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function kn(n){return n.hasNext()?n.getNext():void 0}class Fe{constructor(e){this.fields=e,e.sort(re.comparator)}static empty(){return new Fe([])}unionWith(e){let t=new W(re.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Fe(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Dn(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class vh extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class he{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(r){try{return atob(r)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new vh("Invalid base64 string: "+s):s}}(e);return new he(t)}static fromUint8Array(e){const t=function(r){let s="";for(let i=0;i<r.length;++i)s+=String.fromCharCode(r[i]);return s}(e);return new he(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return k(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}he.EMPTY_BYTE_STRING=new he("");const fy=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Dt(n){if(C(!!n),"string"==typeof n){let e=0;const t=fy.exec(n);if(C(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:se(n.seconds),nanos:se(n.nanos)}}function se(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function lt(n){return"string"==typeof n?he.fromBase64String(n):he.fromUint8Array(n)}function si(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==n?void 0:n.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function ii(n){const e=n.mapValue.fields.__previous_value__;return si(e)?ii(e):e}function Or(n){const e=Dt(n.mapValue.fields.__local_write_time__.timestampValue);return new J(e.seconds,e.nanos)}class gy{constructor(e,t,r,s,i,o,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}}class kt{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new kt("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof kt&&e.projectId===this.projectId&&e.database===this.database}}const Nt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},oi={nullValue:"NULL_VALUE"};function Rt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?si(n)?4:xh(n)?9007199254740991:10:S()}function et(n,e){if(n===e)return!0;const t=Rt(n);if(t!==Rt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Or(n).isEqual(Or(e));case 3:return function(r,s){if("string"==typeof r.timestampValue&&"string"==typeof s.timestampValue&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;const i=Dt(r.timestampValue),o=Dt(s.timestampValue);return i.seconds===o.seconds&&i.nanos===o.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,lt(n.bytesValue).isEqual(lt(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,s){return se(r.geoPointValue.latitude)===se(s.geoPointValue.latitude)&&se(r.geoPointValue.longitude)===se(s.geoPointValue.longitude)}(n,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return se(r.integerValue)===se(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){const i=se(r.doubleValue),o=se(s.doubleValue);return i===o?Pr(i)===Pr(o):isNaN(i)&&isNaN(o)}return!1}(n,e);case 9:return Dn(n.arrayValue.values||[],e.arrayValue.values||[],et);case 10:return function(r,s){const i=r.mapValue.fields||{},o=s.mapValue.fields||{};if(ph(i)!==ph(o))return!1;for(const a in i)if(i.hasOwnProperty(a)&&(void 0===o[a]||!et(i[a],o[a])))return!1;return!0}(n,e);default:return S()}var s}function Fr(n,e){return void 0!==(n.values||[]).find(t=>et(t,e))}function Pt(n,e){if(n===e)return 0;const t=Rt(n),r=Rt(e);if(t!==r)return k(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return k(n.booleanValue,e.booleanValue);case 2:return function(s,i){const o=se(s.integerValue||s.doubleValue),a=se(i.integerValue||i.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(n,e);case 3:return wh(n.timestampValue,e.timestampValue);case 4:return wh(Or(n),Or(e));case 5:return k(n.stringValue,e.stringValue);case 6:return function(s,i){const o=lt(s),a=lt(i);return o.compareTo(a)}(n.bytesValue,e.bytesValue);case 7:return function(s,i){const o=s.split("/"),a=i.split("/");for(let u=0;u<o.length&&u<a.length;u++){const c=k(o[u],a[u]);if(0!==c)return c}return k(o.length,a.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,i){const o=k(se(s.latitude),se(i.latitude));return 0!==o?o:k(se(s.longitude),se(i.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,i){const o=s.values||[],a=i.values||[];for(let u=0;u<o.length&&u<a.length;++u){const c=Pt(o[u],a[u]);if(c)return c}return k(o.length,a.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,i){if(s===Nt.mapValue&&i===Nt.mapValue)return 0;if(s===Nt.mapValue)return 1;if(i===Nt.mapValue)return-1;const o=s.fields||{},a=Object.keys(o),u=i.fields||{},c=Object.keys(u);a.sort(),c.sort();for(let l=0;l<a.length&&l<c.length;++l){const h=k(a[l],c[l]);if(0!==h)return h;const d=Pt(o[a[l]],u[c[l]]);if(0!==d)return d}return k(a.length,c.length)}(n.mapValue,e.mapValue);default:throw S()}}function wh(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return k(n,e);const t=Dt(n),r=Dt(e),s=k(t.seconds,r.seconds);return 0!==s?s:k(t.nanos,r.nanos)}function Nn(n){return oa(n)}function oa(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(r){const s=Dt(r);return`time(${s.seconds},${s.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?lt(n.bytesValue).toBase64():"referenceValue"in n?T.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(r){let s="[",i=!0;for(const o of r.values||[])i?i=!1:s+=",",s+=oa(o);return s+"]"}(n.arrayValue):"mapValue"in n?function(r){const s=Object.keys(r.fields||{}).sort();let i="{",o=!0;for(const a of s)o?o=!1:i+=",",i+=`${a}:${oa(r.fields[a])}`;return i+"}"}(n.mapValue):S();var e}function en(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function aa(n){return!!n&&"integerValue"in n}function Mr(n){return!!n&&"arrayValue"in n}function Ih(n){return!!n&&"nullValue"in n}function Th(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ui(n){return!!n&&"mapValue"in n}function Lr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return At(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Lr(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Lr(n.arrayValue.values[t]);return e}return Object.assign({},n)}function xh(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function my(n){return"nullValue"in n?oi:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?en(kt.empty(),T.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:S()}function py(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?en(kt.empty(),T.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Nt:S()}function Eh(n,e){const t=Pt(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Sh(n,e){const t=Pt(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class Ie{constructor(e){this.value=e}static empty(){return new Ie({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ui(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Lr(t)}setAll(e){let t=re.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const u=this.getFieldsMap(t);this.applyChanges(u,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=Lr(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());ui(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return et(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];ui(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){At(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Ie(Lr(this.value))}}function bh(n){const e=[];return At(n.fields,(t,r)=>{const s=new re([t]);if(ui(r)){const i=bh(r.mapValue).fields;if(0===i.length)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Fe(e)}class Z{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Z(e,0,A.min(),A.min(),A.min(),Ie.empty(),0)}static newFoundDocument(e,t,r,s){return new Z(e,1,t,A.min(),r,s,0)}static newNoDocument(e,t){return new Z(e,2,t,A.min(),A.min(),Ie.empty(),0)}static newUnknownDocument(e,t){return new Z(e,3,t,A.min(),A.min(),Ie.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(A.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ie.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ie.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=A.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Z&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Z(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ot{constructor(e,t){this.position=e,this.inclusive=t}}function Ch(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(r=i.field.isKeyField()?T.comparator(T.fromName(o.referenceValue),t.key):Pt(o,t.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function Ah(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!et(n.position[t],e.position[t]))return!1;return!0}class Rn{constructor(e,t="asc"){this.field=e,this.dir=t}}function yy(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Dh{}class L extends Dh{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new _y(e,t,r):"array-contains"===t?new Iy(e,r):"in"===t?new Fh(e,r):"not-in"===t?new Ty(e,r):"array-contains-any"===t?new xy(e,r):new L(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new vy(e,r):new wy(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Pt(t,this.value)):null!==t&&Rt(this.value)===Rt(t)&&this.matchesComparison(Pt(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return S()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class j extends Dh{constructor(e,t){super(),this.filters=e,this.op=t,this.lt=null}static create(e,t){return new j(e,t)}matches(e){return Pn(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.lt||(this.lt=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.lt}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.ft(t=>t.isInequality());return null!==e?e.field:null}ft(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function Pn(n){return"and"===n.op}function ua(n){return"or"===n.op}function ca(n){return kh(n)&&Pn(n)}function kh(n){for(const e of n.filters)if(e instanceof j)return!1;return!0}function la(n){if(n instanceof L)return n.field.canonicalString()+n.op.toString()+Nn(n.value);if(ca(n))return n.filters.map(e=>la(e)).join(",");{const e=n.filters.map(t=>la(t)).join(",");return`${n.op}(${e})`}}function Nh(n,e){return n instanceof L?(t=n,(r=e)instanceof L&&t.op===r.op&&t.field.isEqual(r.field)&&et(t.value,r.value)):n instanceof j?function(t,r){return r instanceof j&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((s,i,o)=>s&&Nh(i,r.filters[o]),!0)}(n,e):void S();var t,r}function Rh(n,e){const t=n.filters.concat(e);return j.create(t,n.op)}function Ph(n){return n instanceof L?`${(e=n).field.canonicalString()} ${e.op} ${Nn(e.value)}`:n instanceof j?function(e){return e.op.toString()+" {"+e.getFilters().map(Ph).join(" ,")+"}"}(n):"Filter";var e}class _y extends L{constructor(e,t,r){super(e,t,r),this.key=T.fromName(r.referenceValue)}matches(e){const t=T.comparator(e.key,this.key);return this.matchesComparison(t)}}class vy extends L{constructor(e,t){super(e,"in",t),this.keys=Oh(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class wy extends L{constructor(e,t){super(e,"not-in",t),this.keys=Oh(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Oh(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>T.fromName(r.referenceValue))}class Iy extends L{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Mr(t)&&Fr(t.arrayValue,this.value)}}class Fh extends L{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Fr(this.value.arrayValue,t)}}class Ty extends L{constructor(e,t){super(e,"not-in",t)}matches(e){if(Fr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Fr(this.value.arrayValue,t)}}class xy extends L{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Mr(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Fr(this.value.arrayValue,r))}}class Ey{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.dt=null}}function ha(n,e=null,t=[],r=[],s=null,i=null,o=null){return new Ey(n,e,t,r,s,i,o)}function tn(n){const e=x(n);if(null===e.dt){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>la(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),Rr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Nn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Nn(r)).join(",")),e.dt=t}return e.dt}function Ur(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!yy(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Nh(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Ah(n.startAt,e.startAt)&&Ah(n.endAt,e.endAt)}function ci(n){return T.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function li(n,e){return n.filters.filter(t=>t instanceof L&&t.field.isEqual(e))}function Mh(n,e,t){let r=oi,s=!0;for(const i of li(n,e)){let o=oi,a=!0;switch(i.op){case"<":case"<=":o=my(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=oi}Eh({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(null!==t)for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Eh({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}return{value:r,inclusive:s}}function Lh(n,e,t){let r=Nt,s=!0;for(const i of li(n,e)){let o=Nt,a=!0;switch(i.op){case">=":case">":o=py(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Nt}Sh({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(null!==t)for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Sh({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}return{value:r,inclusive:s}}class ht{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=u,this.wt=null,this._t=null}}function Uh(n,e,t,r,s,i,o,a){return new ht(n,e,t,r,s,i,o,a)}function On(n){return new ht(n)}function Vh(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function da(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function hi(n){for(const e of n.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}function fa(n){return null!==n.collectionGroup}function nn(n){const e=x(n);if(null===e.wt){e.wt=[];const t=hi(e),r=da(e);if(null!==t&&null===r)t.isKeyField()||e.wt.push(new Rn(t)),e.wt.push(new Rn(re.keyField(),"asc"));else{let s=!1;for(const i of e.explicitOrderBy)e.wt.push(i),i.field.isKeyField()&&(s=!0);if(!s){const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.wt.push(new Rn(re.keyField(),i))}}}return e.wt}function ke(n){const e=x(n);if(!e._t)if("F"===e.limitType)e._t=ha(e.path,e.collectionGroup,nn(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const i of nn(e))t.push(new Rn(i.field,"desc"===i.dir?"asc":"desc"));const r=e.endAt?new Ot(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new Ot(e.startAt.position,e.startAt.inclusive):null;e._t=ha(e.path,e.collectionGroup,t,e.filters,e.limit,r,s)}return e._t}function ga(n,e){e.getFirstInequalityField(),hi(n);const t=n.filters.concat([e]);return new ht(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function di(n,e,t){return new ht(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Vr(n,e){return Ur(ke(n),ke(e))&&n.limitType===e.limitType}function qh(n){return`${tn(ke(n))}|lt:${n.limitType}`}function ma(n){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(r=>Ph(r)).join(", ")}]`),Rr(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(r=>{return`${(s=r).field.canonicalString()} (${s.dir})`;var s}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Nn(r)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Nn(r)).join(",")),`Target(${t})`}(ke(n))}; limitType=${n.limitType})`}function qr(n,e){return e.isFoundDocument()&&function(t,r){const s=r.key.path;return null!==t.collectionGroup?r.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(s):T.isDocumentKey(t.path)?t.path.isEqual(s):t.path.isImmediateParentOf(s)}(n,e)&&function(t,r){for(const s of nn(t))if(!s.field.isKeyField()&&null===r.data.field(s.field))return!1;return!0}(n,e)&&function(t,r){for(const s of t.filters)if(!s.matches(r))return!1;return!0}(n,e)&&(r=e,!((t=n).startAt&&!function(s,i,o){const a=Ch(s,i,o);return s.inclusive?a<=0:a<0}(t.startAt,nn(t),r)||t.endAt&&!function(s,i,o){const a=Ch(s,i,o);return s.inclusive?a>=0:a>0}(t.endAt,nn(t),r)));var t,r}function Bh(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Gh(n){return(e,t)=>{let r=!1;for(const s of nn(n)){const i=Sy(s,e,t);if(0!==i)return i;r=r||s.field.isKeyField()}return 0}}function Sy(n,e,t){const r=n.field.isKeyField()?T.comparator(e.key,t.key):function(s,i,o){const a=i.data.field(s),u=o.data.field(s);return null!==a&&null!==u?Pt(a,u):S()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return S()}}class dt{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[s,i]of r)if(this.equalsFn(s,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(void 0===s)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return 1===r.length?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){At(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return yh(this.inner)}size(){return this.innerSize}}const by=new K(T.comparator);function Me(){return by}const zh=new K(T.comparator);function Br(...n){let e=zh;for(const t of n)e=e.insert(t.key,t);return e}function jh(n){let e=zh;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function tt(){return Gr()}function $h(){return Gr()}function Gr(){return new dt(n=>n.toString(),(n,e)=>n.isEqual(e))}const Cy=new K(T.comparator),Ay=new W(T.comparator);function O(...n){let e=Ay;for(const t of n)e=e.add(t);return e}const Dy=new W(k);function pa(){return Dy}function Kh(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Pr(e)?"-0":e}}function Qh(n){return{integerValue:""+n}}function Hh(n,e){return ch(e)?Qh(e):Kh(n,e)}class fi{constructor(){this._=void 0}}function ky(n,e,t){return n instanceof Fn?function(r,s){const i={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&si(s)&&(s=ii(s)),s&&(i.fields.__previous_value__=s),{mapValue:i}}(t,e):n instanceof rn?Zh(n,e):n instanceof sn?Xh(n,e):function(r,s){const i=Wh(r,s),o=Yh(i)+Yh(r.gt);return aa(i)&&aa(r.gt)?Qh(o):Kh(r.serializer,o)}(n,e)}function Ny(n,e,t){return n instanceof rn?Zh(n,e):n instanceof sn?Xh(n,e):t}function Wh(n,e){return n instanceof Mn?aa(t=e)||(r=t)&&"doubleValue"in r?e:{integerValue:0}:null;var r,t}class Fn extends fi{}class rn extends fi{constructor(e){super(),this.elements=e}}function Zh(n,e){const t=Jh(e);for(const r of n.elements)t.some(s=>et(s,r))||t.push(r);return{arrayValue:{values:t}}}class sn extends fi{constructor(e){super(),this.elements=e}}function Xh(n,e){let t=Jh(e);for(const r of n.elements)t=t.filter(s=>!et(s,r));return{arrayValue:{values:t}}}class Mn extends fi{constructor(e,t){super(),this.serializer=e,this.gt=t}}function Yh(n){return se(n.integerValue||n.doubleValue)}function Jh(n){return Mr(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class zr{constructor(e,t){this.field=e,this.transform=t}}class Py{constructor(e,t){this.version=e,this.transformResults=t}}class ee{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ee}static exists(e){return new ee(void 0,e)}static updateTime(e){return new ee(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function gi(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class mi{}function ed(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new Un(n.key,ee.none()):new Ln(n.key,n.data,ee.none());{const t=n.data,r=Ie.empty();let s=new W(re.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);null===o&&i.length>1&&(i=i.popLast(),o=t.field(i)),null===o?r.delete(i):r.set(i,o),s=s.add(i)}return new ft(n.key,r,new Fe(s.toArray()),ee.none())}}function Oy(n,e,t){n instanceof Ln?function(r,s,i){const o=r.value.clone(),a=rd(r.fieldTransforms,s,i.transformResults);o.setAll(a),s.convertToFoundDocument(i.version,o).setHasCommittedMutations()}(n,e,t):n instanceof ft?function(r,s,i){if(!gi(r.precondition,s))return void s.convertToUnknownDocument(i.version);const o=rd(r.fieldTransforms,s,i.transformResults),a=s.data;a.setAll(nd(r)),a.setAll(o),s.convertToFoundDocument(i.version,a).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function jr(n,e,t,r){return n instanceof Ln?function(s,i,o,a){if(!gi(s.precondition,i))return o;const u=s.value.clone(),c=sd(s.fieldTransforms,a,i);return u.setAll(c),i.convertToFoundDocument(i.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof ft?function(s,i,o,a){if(!gi(s.precondition,i))return o;const u=sd(s.fieldTransforms,a,i),c=i.data;return c.setAll(nd(s)),c.setAll(u),i.convertToFoundDocument(i.version,c).setHasLocalMutations(),null===o?null:o.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(l=>l.field))}(n,e,t,r):(o=t,gi(n.precondition,i=e)?(i.convertToNoDocument(i.version).setHasLocalMutations(),null):o);var i,o}function Fy(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Wh(r.transform,s||null);null!=i&&(null===t&&(t=Ie.empty()),t.set(r.field,i))}return t||null}function td(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(r=e.fieldTransforms,!!(void 0===(t=n.fieldTransforms)&&void 0===r||t&&r&&Dn(t,r,(s,i)=>function Ry(n,e){return n.field.isEqual(e.field)&&(r=e.transform,(t=n.transform)instanceof rn&&r instanceof rn||t instanceof sn&&r instanceof sn?Dn(t.elements,r.elements,et):t instanceof Mn&&r instanceof Mn?et(t.gt,r.gt):t instanceof Fn&&r instanceof Fn);var t,r}(s,i))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var t,r}class Ln extends mi{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class ft extends mi{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function nd(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function rd(n,e,t){const r=new Map;C(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,Ny(o,a,t[s]))}return r}function sd(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,ky(i,o,e))}return r}class Un extends mi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ya extends mi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class _a{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&Oy(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=jr(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=jr(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=$h();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const u=ed(o,a);null!==u&&r.set(s.key,u),o.isValidDocument()||o.convertToNoDocument(A.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),O())}isEqual(e){return this.batchId===e.batchId&&Dn(this.mutations,e.mutations,(t,r)=>td(t,r))&&Dn(this.baseMutations,e.baseMutations,(t,r)=>td(t,r))}}class va{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){C(e.mutations.length===r.length);let s=Cy;const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new va(e,t,r,s)}}class wa{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Ly{constructor(e,t){this.count=e,this.unchangedNames=t}}var ue,q;function id(n){switch(n){default:return S();case m.CANCELLED:case m.UNKNOWN:case m.DEADLINE_EXCEEDED:case m.RESOURCE_EXHAUSTED:case m.INTERNAL:case m.UNAVAILABLE:case m.UNAUTHENTICATED:return!1;case m.INVALID_ARGUMENT:case m.NOT_FOUND:case m.ALREADY_EXISTS:case m.PERMISSION_DENIED:case m.FAILED_PRECONDITION:case m.ABORTED:case m.OUT_OF_RANGE:case m.UNIMPLEMENTED:case m.DATA_LOSS:return!0}}function od(n){if(void 0===n)return ie("GRPC error has no .code"),m.UNKNOWN;switch(n){case ue.OK:return m.OK;case ue.CANCELLED:return m.CANCELLED;case ue.UNKNOWN:return m.UNKNOWN;case ue.DEADLINE_EXCEEDED:return m.DEADLINE_EXCEEDED;case ue.RESOURCE_EXHAUSTED:return m.RESOURCE_EXHAUSTED;case ue.INTERNAL:return m.INTERNAL;case ue.UNAVAILABLE:return m.UNAVAILABLE;case ue.UNAUTHENTICATED:return m.UNAUTHENTICATED;case ue.INVALID_ARGUMENT:return m.INVALID_ARGUMENT;case ue.NOT_FOUND:return m.NOT_FOUND;case ue.ALREADY_EXISTS:return m.ALREADY_EXISTS;case ue.PERMISSION_DENIED:return m.PERMISSION_DENIED;case ue.FAILED_PRECONDITION:return m.FAILED_PRECONDITION;case ue.ABORTED:return m.ABORTED;case ue.OUT_OF_RANGE:return m.OUT_OF_RANGE;case ue.UNIMPLEMENTED:return m.UNIMPLEMENTED;case ue.DATA_LOSS:return m.DATA_LOSS;default:return S()}}(q=ue||(ue={}))[q.OK=0]="OK",q[q.CANCELLED=1]="CANCELLED",q[q.UNKNOWN=2]="UNKNOWN",q[q.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",q[q.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",q[q.NOT_FOUND=5]="NOT_FOUND",q[q.ALREADY_EXISTS=6]="ALREADY_EXISTS",q[q.PERMISSION_DENIED=7]="PERMISSION_DENIED",q[q.UNAUTHENTICATED=16]="UNAUTHENTICATED",q[q.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",q[q.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",q[q.ABORTED=10]="ABORTED",q[q.OUT_OF_RANGE=11]="OUT_OF_RANGE",q[q.UNIMPLEMENTED=12]="UNIMPLEMENTED",q[q.INTERNAL=13]="INTERNAL",q[q.UNAVAILABLE=14]="UNAVAILABLE",q[q.DATA_LOSS=15]="DATA_LOSS";class Ia{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return pi}static getOrCreateInstance(){return null===pi&&(pi=new Ia),pi}onExistenceFilterMismatch(e){const t=Symbol();return this.onExistenceFilterMismatchCallbacks.set(t,e),()=>this.onExistenceFilterMismatchCallbacks.delete(t)}notifyOnExistenceFilterMismatch(e){this.onExistenceFilterMismatchCallbacks.forEach(t=>t(e))}}let pi=null;function ad(){return new TextEncoder}const Uy=new Cn([4294967295,4294967295],0);function ud(n){const e=ad().encode(n),t=new Np;return t.update(e),new Uint8Array(t.digest())}function cd(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Cn([t,r],0),new Cn([s,i],0)]}class Ta{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new $r(`Invalid padding: ${t}`);if(r<0)throw new $r(`Invalid hash count: ${r}`);if(e.length>0&&0===this.hashCount)throw new $r(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new $r(`Invalid padding when bitmap length is 0: ${t}`);this.It=8*e.length-t,this.Tt=Cn.fromNumber(this.It)}Et(e,t,r){let s=e.add(t.multiply(Cn.fromNumber(r)));return 1===s.compare(Uy)&&(s=new Cn([s.getBits(0),s.getBits(1)],0)),s.modulo(this.Tt).toNumber()}At(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}vt(e){if(0===this.It)return!1;const t=ud(e),[r,s]=cd(t);for(let i=0;i<this.hashCount;i++){const o=this.Et(r,s,i);if(!this.At(o))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Ta(i,s,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(0===this.It)return;const t=ud(e),[r,s]=cd(t);for(let i=0;i<this.hashCount;i++){const o=this.Et(r,s,i);this.Rt(o)}}Rt(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class $r extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Kr{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Qr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Kr(A.min(),s,new K(k),Me(),O())}}class Qr{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Qr(r,t,O(),O(),O())}}class yi{constructor(e,t,r,s){this.Pt=e,this.removedTargetIds=t,this.key=r,this.bt=s}}class ld{constructor(e,t){this.targetId=e,this.Vt=t}}class hd{constructor(e,t,r=he.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class dd{constructor(){this.St=0,this.Dt=gd(),this.Ct=he.EMPTY_BYTE_STRING,this.xt=!1,this.Nt=!0}get current(){return this.xt}get resumeToken(){return this.Ct}get kt(){return 0!==this.St}get Mt(){return this.Nt}$t(e){e.approximateByteSize()>0&&(this.Nt=!0,this.Ct=e)}Ot(){let e=O(),t=O(),r=O();return this.Dt.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:S()}}),new Qr(this.Ct,this.xt,e,t,r)}Ft(){this.Nt=!1,this.Dt=gd()}Bt(e,t){this.Nt=!0,this.Dt=this.Dt.insert(e,t)}Lt(e){this.Nt=!0,this.Dt=this.Dt.remove(e)}qt(){this.St+=1}Ut(){this.St-=1}Kt(){this.Nt=!0,this.xt=!0}}class Vy{constructor(e){this.Gt=e,this.Qt=new Map,this.jt=Me(),this.zt=fd(),this.Wt=new K(k)}Ht(e){for(const t of e.Pt)e.bt&&e.bt.isFoundDocument()?this.Jt(t,e.bt):this.Yt(t,e.key,e.bt);for(const t of e.removedTargetIds)this.Yt(t,e.key,e.bt)}Xt(e){this.forEachTarget(e,t=>{const r=this.Zt(t);switch(e.state){case 0:this.te(t)&&r.$t(e.resumeToken);break;case 1:r.Ut(),r.kt||r.Ft(),r.$t(e.resumeToken);break;case 2:r.Ut(),r.kt||this.removeTarget(t);break;case 3:this.te(t)&&(r.Kt(),r.$t(e.resumeToken));break;case 4:this.te(t)&&(this.ee(t),r.$t(e.resumeToken));break;default:S()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Qt.forEach((r,s)=>{this.te(s)&&t(s)})}ne(e){var t;const r=e.targetId,s=e.Vt.count,i=this.se(r);if(i){const o=i.target;if(ci(o))if(0===s){const a=new T(o.path);this.Yt(r,a,Z.newNoDocument(a,A.min()))}else C(1===s);else{const a=this.ie(r);if(a!==s){const u=this.re(e,a);0!==u&&(this.ee(r),this.Wt=this.Wt.insert(r,2===u?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch")),null===(t=Ia.instance)||void 0===t||t.notifyOnExistenceFilterMismatch(function(c,l,h){var d,f,y,I,w,D;const R={localCacheCount:l,existenceFilterCount:h.count},b=h.unchangedNames;return b&&(R.bloomFilter={applied:0===c,hashCount:null!==(d=null==b?void 0:b.hashCount)&&void 0!==d?d:0,bitmapLength:null!==(I=null===(y=null===(f=null==b?void 0:b.bits)||void 0===f?void 0:f.bitmap)||void 0===y?void 0:y.length)&&void 0!==I?I:0,padding:null!==(D=null===(w=null==b?void 0:b.bits)||void 0===w?void 0:w.padding)&&void 0!==D?D:0}),R}(u,a,e.Vt))}}}}re(e,t){const{unchangedNames:r,count:s}=e.Vt;if(!r||!r.bits)return 1;const{bits:{bitmap:i="",padding:o=0},hashCount:a=0}=r;let u,c;try{u=lt(i).toUint8Array()}catch(l){if(l instanceof vh)return je("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),1;throw l}try{c=new Ta(u,o,a)}catch(l){return je(l instanceof $r?"BloomFilter error: ":"Applying bloom filter failed: ",l),1}return 0===c.It?1:s!==t-this.oe(e.targetId,c)?2:0}oe(e,t){const r=this.Gt.getRemoteKeysForTarget(e);let s=0;return r.forEach(i=>{const o=this.Gt.ue(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;t.vt(a)||(this.Yt(e,i,null),s++)}),s}ce(e){const t=new Map;this.Qt.forEach((i,o)=>{const a=this.se(o);if(a){if(i.current&&ci(a.target)){const u=new T(a.target.path);null!==this.jt.get(u)||this.ae(o,u)||this.Yt(o,u,Z.newNoDocument(u,e))}i.Mt&&(t.set(o,i.Ot()),i.Ft())}});let r=O();this.zt.forEach((i,o)=>{let a=!0;o.forEachWhile(u=>{const c=this.se(u);return!c||"TargetPurposeLimboResolution"===c.purpose||(a=!1,!1)}),a&&(r=r.add(i))}),this.jt.forEach((i,o)=>o.setReadTime(e));const s=new Kr(e,t,this.Wt,this.jt,r);return this.jt=Me(),this.zt=fd(),this.Wt=new K(k),s}Jt(e,t){if(!this.te(e))return;const r=this.ae(e,t.key)?2:0;this.Zt(e).Bt(t.key,r),this.jt=this.jt.insert(t.key,t),this.zt=this.zt.insert(t.key,this.he(t.key).add(e))}Yt(e,t,r){if(!this.te(e))return;const s=this.Zt(e);this.ae(e,t)?s.Bt(t,1):s.Lt(t),this.zt=this.zt.insert(t,this.he(t).delete(e)),r&&(this.jt=this.jt.insert(t,r))}removeTarget(e){this.Qt.delete(e)}ie(e){const t=this.Zt(e).Ot();return this.Gt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}qt(e){this.Zt(e).qt()}Zt(e){let t=this.Qt.get(e);return t||(t=new dd,this.Qt.set(e,t)),t}he(e){let t=this.zt.get(e);return t||(t=new W(k),this.zt=this.zt.insert(e,t)),t}te(e){const t=null!==this.se(e);return t||v("WatchChangeAggregator","Detected inactive target",e),t}se(e){const t=this.Qt.get(e);return t&&t.kt?null:this.Gt.le(e)}ee(e){this.Qt.set(e,new dd),this.Gt.getRemoteKeysForTarget(e).forEach(t=>{this.Yt(e,t,null)})}ae(e,t){return this.Gt.getRemoteKeysForTarget(e).has(t)}}function fd(){return new K(T.comparator)}function gd(){return new K(T.comparator)}const qy={asc:"ASCENDING",desc:"DESCENDING"},By={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Gy={and:"AND",or:"OR"};class zy{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function xa(n,e){return n.useProto3Json||Rr(e)?e:{value:e}}function Vn(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function md(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function jy(n,e){return Vn(n,e.toTimestamp())}function oe(n){return C(!!n),A.fromTimestamp(function(e){const t=Dt(e);return new J(t.seconds,t.nanos)}(n))}function Ea(n,e){return(t=n,new V(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function pd(n){const e=V.fromString(n);return C(Sd(e)),e}function Hr(n,e){return Ea(n.databaseId,e.path)}function nt(n,e){const t=pd(e);if(t.get(1)!==n.databaseId.projectId)throw new _(m.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new _(m.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new T(_d(t))}function Sa(n,e){return Ea(n.databaseId,e)}function yd(n){const e=pd(n);return 4===e.length?V.emptyPath():_d(e)}function Wr(n){return new V(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function _d(n){return C(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function vd(n,e,t){return{name:Hr(n,e),fields:t.value.mapValue.fields}}function wd(n,e,t){const r=nt(n,e.name),s=oe(e.updateTime),i=e.createTime?oe(e.createTime):A.min(),o=new Ie({mapValue:{fields:e.fields}}),a=Z.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function Zr(n,e){let t;if(e instanceof Ln)t={update:vd(n,e.key,e.value)};else if(e instanceof Un)t={delete:Hr(n,e.key)};else if(e instanceof ft)t={update:vd(n,e.key,e.data),updateMask:Yy(e.fieldMask)};else{if(!(e instanceof ya))return S();t={verify:Hr(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,i){const o=i.transform;if(o instanceof Fn)return{fieldPath:i.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof rn)return{fieldPath:i.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof sn)return{fieldPath:i.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof Mn)return{fieldPath:i.field.canonicalString(),increment:o.gt};throw S()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:jy(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:S()),t;var s}function ba(n,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?ee.updateTime(oe(s.updateTime)):void 0!==s.exists?ee.exists(s.exists):ee.none():ee.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(i,o){let a=null;"setToServerValue"in o?(C("REQUEST_TIME"===o.setToServerValue),a=new Fn):"appendMissingElements"in o?a=new rn(o.appendMissingElements.values||[]):"removeAllFromArray"in o?a=new sn(o.removeAllFromArray.values||[]):"increment"in o?a=new Mn(i,o.increment):S();const u=re.fromServerFormat(o.fieldPath);return new zr(u,a)}(n,s)):[];var s;if(e.update){const s=nt(n,e.update.name),i=new Ie({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=new Fe((e.updateMask.fieldPaths||[]).map(c=>re.fromServerFormat(c)));return new ft(s,i,o,t,r)}return new Ln(s,i,t,r)}if(e.delete){const s=nt(n,e.delete);return new Un(s,t)}if(e.verify){const s=nt(n,e.verify);return new ya(s,t)}return S()}function Id(n,e){return{documents:[Sa(n,e.path)]}}function Ca(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=Sa(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=Sa(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const s=function(u){if(0!==u.length)return Ed(j.create(u,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const i=function(u){if(0!==u.length)return u.map(c=>{return{field:Ft((l=c).field),direction:Wy(l.dir)};var l})}(e.orderBy);i&&(t.structuredQuery.orderBy=i);const o=xa(n,e.limit);var a,u;return null!==o&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(t.structuredQuery.endAt={before:!(u=e.endAt).inclusive,values:u.position}),t}function Td(n){let e=yd(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){C(1===r);const l=t.from[0];l.allDescendants?s=l.collectionId:e=e.child(l.collectionId)}let i=[];t.where&&(i=function(l){const h=xd(l);return h instanceof j&&ca(h)?h.getFilters():[h]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(l=>{return new Rn(qn((h=l).field),function(d){switch(d){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(h.direction));var h}));let a=null;t.limit&&(a=function(l){let h;return h="object"==typeof l?l.value:l,Rr(h)?null:h}(t.limit));let u=null;var l;t.startAt&&(u=new Ot((l=t.startAt).values||[],!!l.before));let c=null;return t.endAt&&(c=function(l){return new Ot(l.values||[],!l.before)}(t.endAt)),Uh(e,s,o,i,a,"F",u,c)}function xd(n){return void 0!==n.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=qn(e.unaryFilter.field);return L.create(t,"==",{doubleValue:NaN});case"IS_NULL":const r=qn(e.unaryFilter.field);return L.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=qn(e.unaryFilter.field);return L.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=qn(e.unaryFilter.field);return L.create(i,"!=",{nullValue:"NULL_VALUE"});default:return S()}}(n):void 0!==n.fieldFilter?L.create(qn((e=n).fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return S()}}(e.fieldFilter.op),e.fieldFilter.value):void 0!==n.compositeFilter?function(e){return j.create(e.compositeFilter.filters.map(t=>xd(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return S()}}(e.compositeFilter.op))}(n):S();var e}function Wy(n){return qy[n]}function Zy(n){return By[n]}function Xy(n){return Gy[n]}function Ft(n){return{fieldPath:n.canonicalString()}}function qn(n){return re.fromServerFormat(n.fieldPath)}function Ed(n){return n instanceof L?function(e){if("=="===e.op){if(Th(e.value))return{unaryFilter:{field:Ft(e.field),op:"IS_NAN"}};if(Ih(e.value))return{unaryFilter:{field:Ft(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Th(e.value))return{unaryFilter:{field:Ft(e.field),op:"IS_NOT_NAN"}};if(Ih(e.value))return{unaryFilter:{field:Ft(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ft(e.field),op:Zy(e.op),value:e.value}}}(n):n instanceof j?function(e){const t=e.getFilters().map(r=>Ed(r));return 1===t.length?t[0]:{compositeFilter:{op:Xy(e.op),filters:t}}}(n):S()}function Yy(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Sd(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}class gt{constructor(e,t,r,s,i=A.min(),o=A.min(),a=he.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new gt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new gt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new gt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new gt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class bd{constructor(e){this.fe=e}}function Cd(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:_i(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:Hr(s=n.fe,(i=e).key),fields:i.data.value.mapValue.fields,updateTime:Vn(s,i.version.toTimestamp()),createTime:Vn(s,i.createTime.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:on(e.version)};else{if(!e.isUnknownDocument())return S();r.unknownDocument={path:t.path.toArray(),version:on(e.version)}}var s,i;return r}function _i(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function on(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function an(n){const e=new J(n.seconds,n.nanoseconds);return A.fromTimestamp(e)}function un(n,e){const t=(e.baseMutations||[]).map(i=>ba(n.fe,i));for(let i=0;i<e.mutations.length-1;++i)i+1<e.mutations.length&&void 0!==e.mutations[i+1].transform&&(e.mutations[i].updateTransforms=e.mutations[i+1].transform.fieldTransforms,e.mutations.splice(i+1,1),++i);const r=e.mutations.map(i=>ba(n.fe,i)),s=J.fromMillis(e.localWriteTimeMs);return new _a(e.batchId,s,t,r)}function Xr(n){const e=an(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?an(n.lastLimboFreeSnapshotVersion):A.min();let r;var s;return void 0!==n.query.documents?(C(1===(s=n.query).documents.length),r=ke(On(yd(s.documents[0])))):r=ke(Td(n.query)),new gt(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,he.fromBase64String(n.resumeToken))}function Ad(n,e){const t=on(e.snapshotVersion),r=on(e.lastLimboFreeSnapshotVersion);let s;s=ci(e.target)?Id(n.fe,e.target):Ca(n.fe,e.target);const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:tn(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function Aa(n){const e=Td({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?di(e,e.limit,"L"):e}function Da(n,e){return new wa(e.largestBatchId,ba(n.fe,e.overlayMutation))}function Dd(n,e){const t=e.path.lastSegment();return[n,Se(e.path.popLast()),t]}function kd(n,e,t,r){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:on(r.readTime),documentKey:Se(r.documentKey.path),largestBatchId:r.largestBatchId}}class e_{getBundleMetadata(e,t){return Nd(e).get(t).next(r=>{if(r)return{id:(s=r).bundleId,createTime:an(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return Nd(e).put({bundleId:(r=t).id,createTime:on(oe(r.createTime)),version:r.version});var r}getNamedQuery(e,t){return Rd(e).get(t).next(r=>{if(r)return{name:(s=r).name,query:Aa(s.bundledQuery),readTime:an(s.readTime)};var s})}saveNamedQuery(e,t){return Rd(e).put({name:(r=t).name,readTime:on(oe(r.readTime)),bundledQuery:r.bundledQuery});var r}}function Nd(n){return me(n,"bundles")}function Rd(n){return me(n,"namedQueries")}class vi{constructor(e,t){this.serializer=e,this.userId=t}static de(e,t){return new vi(e,t.uid||"")}getOverlay(e,t){return Yr(e).get(Dd(this.userId,t)).next(r=>r?Da(this.serializer,r):null)}getOverlays(e,t){const r=tt();return g.forEach(t,s=>this.getOverlay(e,s).next(i=>{null!==i&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new wa(t,o);s.push(this.we(e,a))}),g.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(Se(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(Yr(e).J("collectionPathOverlayIndex",a))}),g.waitFor(i)}getOverlaysForCollection(e,t,r){const s=tt(),i=Se(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Yr(e).j("collectionPathOverlayIndex",o).next(a=>{for(const u of a){const c=Da(this.serializer,u);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=tt();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Yr(e).X({index:"collectionGroupOverlayIndex",range:a},(u,c,l)=>{const h=Da(this.serializer,c);i.size()<s||h.largestBatchId===o?(i.set(h.getKey(),h),o=h.largestBatchId):l.done()}).next(()=>i)}we(e,t){return Yr(e).put(function(r,s,i){const[o,a,u]=Dd(s,i.mutation.key);return{userId:s,collectionPath:a,documentId:u,collectionGroup:i.mutation.key.getCollectionGroup(),largestBatchId:i.largestBatchId,overlayMutation:Zr(r.fe,i.mutation)}}(this.serializer,this.userId,t))}}function Yr(n){return me(n,"documentOverlays")}class cn{constructor(){}_e(e,t){this.me(e,t),t.ge()}me(e,t){if("nullValue"in e)this.ye(t,5);else if("booleanValue"in e)this.ye(t,10),t.pe(e.booleanValue?1:0);else if("integerValue"in e)this.ye(t,15),t.pe(se(e.integerValue));else if("doubleValue"in e){const r=se(e.doubleValue);isNaN(r)?this.ye(t,13):(this.ye(t,15),Pr(r)?t.pe(0):t.pe(r))}else if("timestampValue"in e){const r=e.timestampValue;this.ye(t,20),"string"==typeof r?t.Ie(r):(t.Ie(`${r.seconds||""}`),t.pe(r.nanos||0))}else if("stringValue"in e)this.Te(e.stringValue,t),this.Ee(t);else if("bytesValue"in e)this.ye(t,30),t.Ae(lt(e.bytesValue)),this.Ee(t);else if("referenceValue"in e)this.ve(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.ye(t,45),t.pe(r.latitude||0),t.pe(r.longitude||0)}else"mapValue"in e?xh(e)?this.ye(t,Number.MAX_SAFE_INTEGER):(this.Re(e.mapValue,t),this.Ee(t)):"arrayValue"in e?(this.Pe(e.arrayValue,t),this.Ee(t)):S()}Te(e,t){this.ye(t,25),this.be(e,t)}be(e,t){t.Ie(e)}Re(e,t){const r=e.fields||{};this.ye(t,55);for(const s of Object.keys(r))this.Te(s,t),this.me(r[s],t)}Pe(e,t){const r=e.values||[];this.ye(t,50);for(const s of r)this.me(s,t)}ve(e,t){this.ye(t,37),T.fromName(e).path.forEach(r=>{this.ye(t,60),this.be(r,t)})}ye(e,t){e.pe(t)}Ee(e){e.pe(2)}}function t_(n){if(0===n)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function Pd(n){const e=64-function(t){let r=0;for(let s=0;s<8;++s){const i=t_(255&t[s]);if(r+=i,8!==i)break}return r}(n);return Math.ceil(e/8)}cn.Ve=new cn;class n_{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Se(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.De(r.value),r=t.next();this.Ce()}xe(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ne(r.value),r=t.next();this.ke()}Me(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.De(r);else if(r<2048)this.De(960|r>>>6),this.De(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.De(480|r>>>12),this.De(128|63&r>>>6),this.De(128|63&r);else{const s=t.codePointAt(0);this.De(240|s>>>18),this.De(128|63&s>>>12),this.De(128|63&s>>>6),this.De(128|63&s)}}this.Ce()}$e(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ne(r);else if(r<2048)this.Ne(960|r>>>6),this.Ne(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ne(480|r>>>12),this.Ne(128|63&r>>>6),this.Ne(128|63&r);else{const s=t.codePointAt(0);this.Ne(240|s>>>18),this.Ne(128|63&s>>>12),this.Ne(128|63&s>>>6),this.Ne(128|63&s)}}this.ke()}Oe(e){const t=this.Fe(e),r=Pd(t);this.Be(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}Le(e){const t=this.Fe(e),r=Pd(t);this.Be(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}qe(){this.Ue(255),this.Ue(255)}Ke(){this.Ge(255),this.Ge(255)}reset(){this.position=0}seed(e){this.Be(e.length),this.buffer.set(e,this.position),this.position+=e.length}Qe(){return this.buffer.slice(0,this.position)}Fe(e){const t=function(s){const i=new DataView(new ArrayBuffer(8));return i.setFloat64(0,s,!1),new Uint8Array(i.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}De(e){const t=255&e;0===t?(this.Ue(0),this.Ue(255)):255===t?(this.Ue(255),this.Ue(0)):this.Ue(t)}Ne(e){const t=255&e;0===t?(this.Ge(0),this.Ge(255)):255===t?(this.Ge(255),this.Ge(0)):this.Ge(e)}Ce(){this.Ue(0),this.Ue(1)}ke(){this.Ge(0),this.Ge(1)}Ue(e){this.Be(1),this.buffer[this.position++]=e}Ge(e){this.Be(1),this.buffer[this.position++]=~e}Be(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class r_{constructor(e){this.je=e}Ae(e){this.je.Se(e)}Ie(e){this.je.Me(e)}pe(e){this.je.Oe(e)}ge(){this.je.qe()}}class s_{constructor(e){this.je=e}Ae(e){this.je.xe(e)}Ie(e){this.je.$e(e)}pe(e){this.je.Le(e)}ge(){this.je.Ke()}}class Jr{constructor(){this.je=new n_,this.ze=new r_(this.je),this.We=new s_(this.je)}seed(e){this.je.seed(e)}He(e){return 0===e?this.ze:this.We}Qe(){return this.je.Qe()}reset(){this.je.reset()}}class ln{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Je(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new ln(this.indexId,this.documentKey,this.arrayValue,r)}}function Mt(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=Od(n.arrayValue,e.arrayValue),0!==t?t:(t=Od(n.directionalValue,e.directionalValue),0!==t?t:T.comparator(n.documentKey,e.documentKey)))}function Od(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class i_{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ye=e.orderBy,this.Xe=[];for(const t of e.filters){const r=t;r.isInequality()?this.Ze=r:this.Xe.push(r)}}tn(e){C(e.collectionGroup===this.collectionId);const t=ta(e);if(void 0!==t&&!this.en(t))return!1;const r=Yt(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.en(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(void 0!==this.Ze){if(!s.has(this.Ze.field.canonicalString())){const a=r[i];if(!this.nn(this.Ze,a)||!this.sn(this.Ye[o++],a))return!1}++i}for(;i<r.length;++i)if(o>=this.Ye.length||!this.sn(this.Ye[o++],r[i]))return!1;return!0}en(e){for(const t of this.Xe)if(this.nn(t,e))return!0;return!1}nn(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Fd(n){var e,t;if(C(n instanceof L||n instanceof j),n instanceof L){if(n instanceof Fh){const s=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(i=>L.create(n.field,"==",i)))||[];return j.create(s,"or")}return n}const r=n.filters.map(s=>Fd(s));return j.create(r,n.op)}function o_(n){if(0===n.getFilters().length)return[];const e=Ra(Fd(n));return C(Md(e)),ka(e)||Na(e)?[e]:e.getFilters()}function ka(n){return n instanceof L}function Na(n){return n instanceof j&&ca(n)}function Md(n){return ka(n)||Na(n)||function(e){if(e instanceof j&&ua(e)){for(const t of e.getFilters())if(!ka(t)&&!Na(t))return!1;return!0}return!1}(n)}function Ra(n){if(C(n instanceof L||n instanceof j),n instanceof L)return n;if(1===n.filters.length)return Ra(n.filters[0]);const e=n.filters.map(r=>Ra(r));let t=j.create(e,n.op);return t=wi(t),Md(t)?t:(C(t instanceof j),C(Pn(t)),C(t.filters.length>1),t.filters.reduce((r,s)=>Pa(r,s)))}function Pa(n,e){let t;return C(n instanceof L||n instanceof j),C(e instanceof L||e instanceof j),t=n instanceof L?e instanceof L?j.create([n,e],"and"):Ld(n,e):e instanceof L?Ld(e,n):function(r,s){if(C(r.filters.length>0&&s.filters.length>0),Pn(r)&&Pn(s))return Rh(r,s.getFilters());const i=ua(r)?r:s,o=ua(r)?s:r,a=i.filters.map(u=>Pa(u,o));return j.create(a,"or")}(n,e),wi(t)}function Ld(n,e){if(Pn(e))return Rh(e,n.getFilters());{const t=e.filters.map(r=>Pa(n,r));return j.create(t,"or")}}function wi(n){if(C(n instanceof L||n instanceof j),n instanceof L)return n;const e=n.getFilters();if(1===e.length)return wi(e[0]);if(kh(n))return n;const t=e.map(s=>wi(s)),r=[];return t.forEach(s=>{s instanceof L?r.push(s):s instanceof j&&(s.op===n.op?r.push(...s.filters):r.push(s))}),1===r.length?r[0]:j.create(r,n.op)}class a_{constructor(){this.rn=new Oa}addToCollectionParentIndex(e,t){return this.rn.add(t),g.resolve()}getCollectionParents(e,t){return g.resolve(this.rn.getEntries(t))}addFieldIndex(e,t){return g.resolve()}deleteFieldIndex(e,t){return g.resolve()}getDocumentsMatchingTarget(e,t){return g.resolve(null)}getIndexType(e,t){return g.resolve(0)}getFieldIndexes(e,t){return g.resolve([])}getNextCollectionGroupToUpdate(e){return g.resolve(null)}getMinOffset(e,t){return g.resolve(Ue.min())}getMinOffsetFromCollectionGroup(e,t){return g.resolve(Ue.min())}updateCollectionGroup(e,t,r){return g.resolve()}updateIndexEntries(e,t){return g.resolve()}}class Oa{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new W(V.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new W(V.comparator)).toArray()}}const Ii=new Uint8Array(0);class u_{constructor(e,t){this.user=e,this.databaseId=t,this.on=new Oa,this.un=new dt(r=>tn(r),(r,s)=>Ur(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.on.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.on.add(t)});const i={collectionId:r,parent:Se(s)};return Ud(e).put(i)}return g.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[rh(t),""],!1,!0);return Ud(e).j(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(Je(o.parent))}return r})}addFieldIndex(e,t){const r=Ti(e),s={indexId:(o=t).indexId,collectionGroup:o.collectionGroup,fields:o.fields.map(a=>[a.fieldPath.canonicalString(),a.kind])};var o;delete s.indexId;const i=r.add(s);if(t.indexState){const o=ts(e);return i.next(a=>{o.put(kd(a,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=Ti(e),s=ts(e),i=es(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const r=es(e);let s=!0;const i=new Map;return g.forEach(this.cn(t),o=>this.an(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=O();const a=[];return g.forEach(i,(u,c)=>{var l;v("IndexedDbIndexManager",`Using index ${l=u,`id=${l.indexId}|cg=${l.collectionGroup}|f=${l.fields.map(b=>`${b.fieldPath}:${b.kind}`).join(",")}`} to execute ${tn(t)}`);const h=function(b,F){const G=ta(F);if(void 0===G)return null;for(const B of li(b,G.fieldPath))switch(B.op){case"array-contains-any":return B.value.arrayValue.values||[];case"array-contains":return[B.value]}return null}(c,u),d=function(b,F){const G=new Map;for(const B of Yt(F))for(const ce of li(b,B.fieldPath))switch(ce.op){case"==":case"in":G.set(B.fieldPath.canonicalString(),ce.value);break;case"not-in":case"!=":return G.set(B.fieldPath.canonicalString(),ce.value),Array.from(G.values())}return null}(c,u),f=function(b,F){const G=[];let B=!0;for(const ce of Yt(F)){const Be=0===ce.kind?Mh(b,ce.fieldPath,b.startAt):Lh(b,ce.fieldPath,b.startAt);G.push(Be.value),B&&(B=Be.inclusive)}return new Ot(G,B)}(c,u),y=function(b,F){const G=[];let B=!0;for(const ce of Yt(F)){const Be=0===ce.kind?Lh(b,ce.fieldPath,b.endAt):Mh(b,ce.fieldPath,b.endAt);G.push(Be.value),B&&(B=Be.inclusive)}return new Ot(G,B)}(c,u),I=this.hn(u,c,f),w=this.hn(u,c,y),D=this.ln(u,c,d),R=this.fn(u.indexId,h,I,f.inclusive,w,y.inclusive,D);return g.forEach(R,b=>r.H(b,t.limit).next(F=>{F.forEach(G=>{const B=T.fromSegments(G.documentKey);o.has(B)||(o=o.add(B),a.push(B))})}))}).next(()=>a)}return g.resolve(null)})}cn(e){let t=this.un.get(e);return t||(t=0===e.filters.length?[e]:o_(j.create(e.filters,"and")).map(r=>ha(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,t),t)}fn(e,t,r,s,i,o,a){const u=(null!=t?t.length:1)*Math.max(r.length,i.length),c=u/(null!=t?t.length:1),l=[];for(let h=0;h<u;++h){const d=t?this.dn(t[h/c]):Ii,f=this.wn(e,d,r[h%c],s),y=this._n(e,d,i[h%c],o),I=a.map(w=>this.wn(e,d,w,!0));l.push(...this.createRange(f,y,I))}return l}wn(e,t,r,s){const i=new ln(e,T.empty(),t,r);return s?i:i.Je()}_n(e,t,r,s){const i=new ln(e,T.empty(),t,r);return s?i.Je():i}an(e,t){const r=new i_(t),s=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.tn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.cn(t);return g.forEach(s,i=>this.an(e,i).next(o=>{o?0!==r&&o.fields.length<function(a){let u=new W(re.comparator),c=!1;for(const l of a.filters)for(const h of l.getFlattenedFilters())h.field.isKeyField()||("array-contains"===h.op||"array-contains-any"===h.op?c=!0:u=u.add(h.field));for(const l of a.orderBy)l.field.isKeyField()||(u=u.add(l.field));return u.size+(c?1:0)}(i)&&(r=1):r=0})).next(()=>null!==t.limit&&s.length>1&&2===r?1:r)}mn(e,t){const r=new Jr;for(const s of Yt(e)){const i=t.data.field(s.fieldPath);if(null==i)return null;const o=r.He(s.kind);cn.Ve._e(i,o)}return r.Qe()}dn(e){const t=new Jr;return cn.Ve._e(e,t.He(0)),t.Qe()}gn(e,t){const r=new Jr;return cn.Ve._e(en(this.databaseId,t),r.He(function(s){const i=Yt(s);return 0===i.length?0:i[i.length-1].kind}(e))),r.Qe()}ln(e,t,r){if(null===r)return[];let s=[];s.push(new Jr);let i=0;for(const o of Yt(e)){const a=r[i++];for(const u of s)if(this.yn(t,o.fieldPath)&&Mr(a))s=this.pn(s,o,a);else{const c=u.He(o.kind);cn.Ve._e(a,c)}}return this.In(s)}hn(e,t,r){return this.ln(e,t,r.position)}In(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Qe();return t}pn(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const u=new Jr;u.seed(a.Qe()),cn.Ve._e(o,u.He(t.kind)),i.push(u)}return i}yn(e,t){return!!e.filters.find(r=>r instanceof L&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=Ti(e),s=ts(e);return(t?r.j("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.j()).next(i=>{const o=[];return g.forEach(i,a=>s.get([a.indexId,this.uid]).next(u=>{o.push(function(c,l){const h=l?new kr(l.sequenceNumber,new Ue(an(l.readTime),new T(Je(l.documentKey)),l.largestBatchId)):kr.empty(),d=c.fields.map(([f,y])=>new ei(re.fromServerFormat(f),y));return new Js(c.indexId,c.collectionGroup,d,h)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return 0!==i?i:k(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=Ti(e),i=ts(e);return this.Tn(e).next(o=>s.j("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>g.forEach(a,u=>i.put(kd(u.indexId,this.user,o,r)))))}updateIndexEntries(e,t){const r=new Map;return g.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?g.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),g.forEach(a,u=>this.En(e,s,u).next(c=>{const l=this.An(i,u);return c.isEqual(l)?g.resolve():this.vn(e,i,u,c,l)}))))})}Rn(e,t,r,s){return es(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.gn(r,t.key),documentKey:t.key.path.toArray()})}Pn(e,t,r,s){return es(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.gn(r,t.key),t.key.path.toArray()])}En(e,t,r){const s=es(e);let i=new W(Mt);return s.X({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.gn(r,t)])},(o,a)=>{i=i.add(new ln(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}An(e,t){let r=new W(Mt);const s=this.mn(t,e);if(null==s)return r;const i=ta(t);if(null!=i){const o=e.data.field(i.fieldPath);if(Mr(o))for(const a of o.arrayValue.values||[])r=r.add(new ln(t.indexId,e.key,this.dn(a),s))}else r=r.add(new ln(t.indexId,e.key,Ii,s));return r}vn(e,t,r,s,i){v("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(a,u,c,l,h){const d=a.getIterator(),f=u.getIterator();let y=kn(d),I=kn(f);for(;y||I;){let w=!1,D=!1;if(y&&I){const R=c(y,I);R<0?D=!0:R>0&&(w=!0)}else null!=y?D=!0:w=!0;w?(l(I),I=kn(f)):D?(h(y),y=kn(d)):(y=kn(d),I=kn(f))}}(s,i,Mt,a=>{o.push(this.Rn(e,t,r,a))},a=>{o.push(this.Pn(e,t,r,a))}),g.waitFor(o)}Tn(e){let t=1;return ts(e).X({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Mt(o,a)).filter((o,a,u)=>!a||0!==Mt(o,u[a-1]));const s=[];s.push(e);for(const o of r){const a=Mt(o,e),u=Mt(o,t);if(0===a)s[0]=e.Je();else if(a>0&&u<0)s.push(o),s.push(o.Je());else if(u>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.bn(s[o],s[o+1]))return[];i.push(IDBKeyRange.bound([s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,Ii,[]],[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,Ii,[]]))}return i}bn(e,t){return Mt(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Vd)}getMinOffset(e,t){return g.mapArray(this.cn(t),r=>this.an(e,r).next(s=>s||S())).next(Vd)}}function Ud(n){return me(n,"collectionParents")}function es(n){return me(n,"indexEntries")}function Ti(n){return me(n,"indexConfiguration")}function ts(n){return me(n,"indexState")}function Vd(n){C(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;na(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Ue(e.readTime,e.documentKey,t)}const qd={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class be{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new be(e,be.DEFAULT_COLLECTION_PERCENTILE,be.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Bd(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const u=r.X({range:o},(l,h,d)=>(a++,d.delete()));i.push(u.next(()=>{C(1===a)}));const c=[];for(const l of t.mutations){const h=dh(e,l.key.path,t.batchId);i.push(s.delete(h)),c.push(l.key)}return g.waitFor(i).next(()=>c)}function xi(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw S();e=n.noDocument}return JSON.stringify(e).length}be.DEFAULT_COLLECTION_PERCENTILE=10,be.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,be.DEFAULT=new be(41943040,be.DEFAULT_COLLECTION_PERCENTILE,be.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),be.DISABLED=new be(-1,0,0);class Ei{constructor(e,t,r,s){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=s,this.Vn={}}static de(e,t,r,s){C(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new Ei(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Lt(e).X({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=Bn(e),o=Lt(e);return o.add({}).next(a=>{C("number"==typeof a);const u=new _a(a,t,r,s),c=function(d,f,y){const I=y.baseMutations.map(D=>Zr(d.fe,D)),w=y.mutations.map(D=>Zr(d.fe,D));return{userId:f,batchId:y.batchId,localWriteTimeMs:y.localWriteTime.toMillis(),baseMutations:I,mutations:w}}(this.serializer,this.userId,u),l=[];let h=new W((d,f)=>k(d.canonicalString(),f.canonicalString()));for(const d of s){const f=dh(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),l.push(o.put(c)),l.push(i.put(f,Wp))}return h.forEach(d=>{l.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.Vn[a]=u.keys()}),g.waitFor(l).next(()=>u)})}lookupMutationBatch(e,t){return Lt(e).get(t).next(r=>r?(C(r.userId===this.userId),un(this.serializer,r)):null)}Sn(e,t){return this.Vn[t]?g.resolve(this.Vn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.Vn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Lt(e).X({index:"userMutationsIndex",range:s},(o,a,u)=>{a.userId===this.userId&&(C(a.batchId>=r),i=un(this.serializer,a)),u.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Lt(e).X({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Lt(e).j("userMutationsIndex",t).next(r=>r.map(s=>un(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=ni(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return Bn(e).X({range:s},(o,a,u)=>{const[c,l,h]=o,d=Je(l);if(c===this.userId&&t.path.isEqual(d))return Lt(e).get(h).next(f=>{if(!f)throw S();C(f.userId===this.userId),i.push(un(this.serializer,f))});u.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new W(k);const s=[];return t.forEach(i=>{const o=ni(this.userId,i.path),a=IDBKeyRange.lowerBound(o),u=Bn(e).X({range:a},(c,l,h)=>{const[d,f,y]=c,I=Je(f);d===this.userId&&i.path.isEqual(I)?r=r.add(y):h.done()});s.push(u)}),g.waitFor(s).next(()=>this.Dn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=ni(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new W(k);return Bn(e).X({range:o},(u,c,l)=>{const[h,d,f]=u,y=Je(d);h===this.userId&&r.isPrefixOf(y)?y.length===s&&(a=a.add(f)):l.done()}).next(()=>this.Dn(e,a))}Dn(e,t){const r=[],s=[];return t.forEach(i=>{s.push(Lt(e).get(i).next(o=>{if(null===o)throw S();C(o.userId===this.userId),r.push(un(this.serializer,o))}))}),g.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return Bd(e.ht,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Cn(t.batchId)}),g.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}Cn(e){delete this.Vn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return g.resolve();const r=IDBKeyRange.lowerBound([this.userId]),s=[];return Bn(e).X({range:r},(i,o,a)=>{if(i[0]===this.userId){const u=Je(i[1]);s.push(u)}else a.done()}).next(()=>{C(0===s.length)})})}containsKey(e,t){return Gd(e,this.userId,t)}xn(e){return zd(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Gd(n,e,t){const r=ni(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Bn(n).X({range:i,Y:!0},(a,u,c)=>{const[l,h,d]=a;l===e&&h===s&&(o=!0),c.done()}).next(()=>o)}function Lt(n){return me(n,"mutations")}function Bn(n){return me(n,"documentMutations")}function zd(n){return me(n,"mutationQueues")}class hn{constructor(e){this.Nn=e}next(){return this.Nn+=2,this.Nn}static kn(){return new hn(0)}static Mn(){return new hn(-1)}}class c_{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.$n(e).next(t=>{const r=new hn(t.highestTargetId);return t.highestTargetId=r.next(),this.On(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.$n(e).next(t=>A.fromTimestamp(new J(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.$n(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.$n(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.On(e,s)))}addTargetData(e,t){return this.Fn(e,t).next(()=>this.$n(e).next(r=>(r.targetCount+=1,this.Bn(t,r),this.On(e,r))))}updateTargetData(e,t){return this.Fn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Gn(e).delete(t.targetId)).next(()=>this.$n(e)).next(r=>(C(r.targetCount>0),r.targetCount-=1,this.On(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return Gn(e).X((o,a)=>{const u=Xr(a);u.sequenceNumber<=t&&null===r.get(u.targetId)&&(s++,i.push(this.removeTargetData(e,u)))}).next(()=>g.waitFor(i)).next(()=>s)}forEachTarget(e,t){return Gn(e).X((r,s)=>{const i=Xr(s);t(i)})}$n(e){return jd(e).get("targetGlobalKey").next(t=>(C(null!==t),t))}On(e,t){return jd(e).put("targetGlobalKey",t)}Fn(e,t){return Gn(e).put(Ad(this.serializer,t))}Bn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.$n(e).next(t=>t.targetCount)}getTargetData(e,t){const r=tn(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return Gn(e).X({range:s,index:"queryTargetsIndex"},(o,a,u)=>{const c=Xr(a);Ur(t,c.target)&&(i=c,u.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=Ut(e);return t.forEach(o=>{const a=Se(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),g.waitFor(s)}removeMatchingKeys(e,t,r){const s=Ut(e);return g.forEach(t,i=>{const o=Se(i.path);return g.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=Ut(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=Ut(e);let i=O();return s.X({range:r,Y:!0},(o,a,u)=>{const c=Je(o[1]),l=new T(c);i=i.add(l)}).next(()=>i)}containsKey(e,t){const r=Se(t.path),s=IDBKeyRange.bound([r],[rh(r)],!1,!0);let i=0;return Ut(e).X({index:"documentTargetsIndex",Y:!0,range:s},([o,a],u,c)=>{0!==o&&(i++,c.done())}).next(()=>i>0)}le(e,t){return Gn(e).get(t).next(r=>r?Xr(r):null)}}function Gn(n){return me(n,"targets")}function jd(n){return me(n,"targetGlobal")}function Ut(n){return me(n,"targetDocuments")}function $d([n,e],[t,r]){const s=k(n,t);return 0===s?k(e,r):s}class l_{constructor(e){this.Ln=e,this.buffer=new W($d),this.qn=0}Un(){return++this.qn}Kn(e){const t=[e,this.Un()];if(this.buffer.size<this.Ln)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();$d(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Kd{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Gn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Qn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return null!==this.Gn}Qn(e){var t=this;v("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,p.Z)(function*(){t.Gn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){Ct(r)?v("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield bt(r)}yield t.Qn(3e5)}))}}class h_{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.zn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return g.resolve(Ve.ct);const r=new l_(t);return this.jn.forEachTarget(e,s=>r.Kn(s.sequenceNumber)).next(()=>this.jn.Wn(e,s=>r.Kn(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(v("LruGarbageCollector","Garbage collection skipped; disabled"),g.resolve(qd)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(v("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),qd):this.Hn(e,t))}getCacheSize(e){return this.jn.getCacheSize(e)}Hn(e,t){let r,s,i,o,a,u,c;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(v("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),s=this.params.maximumSequenceNumbersToCollect):s=h,o=Date.now(),this.nthSequenceNumber(e,s))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(i=h,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(c=Date.now(),Jo()<=Qt.in.DEBUG&&v("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-l}ms\n\tDetermined least recently used ${s} in `+(a-o)+`ms\n\tRemoved ${i} targets in `+(u-a)+`ms\n\tRemoved ${h} documents in `+(c-u)+`ms\nTotal Duration: ${c-l}ms`),g.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:h})))}}class d_{constructor(e,t){this.db=e,this.garbageCollector=function Qd(n,e){return new h_(n,e)}(this,t)}zn(e){const t=this.Jn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}Jn(e){let t=0;return this.Wn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Wn(e,t){return this.Yn(e,(r,s)=>t(s))}addReference(e,t,r){return Si(e,r)}removeReference(e,t,r){return Si(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Si(e,t)}Xn(e,t){return function(r,s){let i=!1;return zd(r).Z(o=>Gd(r,o,s).next(a=>(a&&(i=!0),g.resolve(!a)))).next(()=>i)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Yn(e,(o,a)=>{if(a<=t){const u=this.Xn(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,A.min()),Ut(e).delete([0,Se(o.path)])))});s.push(u)}}).next(()=>g.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Si(e,t)}Yn(e,t){const r=Ut(e);let s,i=Ve.ct;return r.X({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{0===o?(i!==Ve.ct&&t(new T(Je(s)),i),i=c,s=u):i=Ve.ct}).next(()=>{i!==Ve.ct&&t(new T(Je(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Si(n,e){return Ut(n).put((r=n.currentSequenceNumber,{targetId:0,path:Se(e.path),sequenceNumber:r}));var r}class Hd{constructor(){this.changes=new dt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Z.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?g.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class f_{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return dn(e).put(r)}removeEntry(e,t,r){return dn(e).delete(function(s,i){const o=s.path.toArray();return[o.slice(0,o.length-2),o[o.length-2],_i(i),o[o.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Zn(e,r)))}getEntry(e,t){let r=Z.newInvalidDocument(t);return dn(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(ns(t))},(s,i)=>{r=this.ts(t,i)}).next(()=>r)}es(e,t){let r={size:0,document:Z.newInvalidDocument(t)};return dn(e).X({index:"documentKeyIndex",range:IDBKeyRange.only(ns(t))},(s,i)=>{r={document:this.ts(t,i),size:xi(i)}}).next(()=>r)}getEntries(e,t){let r=Me();return this.ns(e,t,(s,i)=>{const o=this.ts(s,i);r=r.insert(s,o)}).next(()=>r)}ss(e,t){let r=Me(),s=new K(T.comparator);return this.ns(e,t,(i,o)=>{const a=this.ts(i,o);r=r.insert(i,a),s=s.insert(i,xi(o))}).next(()=>({documents:r,rs:s}))}ns(e,t,r){if(t.isEmpty())return g.resolve();let s=new W(Yd);t.forEach(u=>s=s.add(u));const i=IDBKeyRange.bound(ns(s.first()),ns(s.last())),o=s.getIterator();let a=o.getNext();return dn(e).X({index:"documentKeyIndex",range:i},(u,c,l)=>{const h=T.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&Yd(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?l.G(ns(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,s){const i=t.path,o=[i.popLast().toArray(),i.lastSegment(),_i(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],a=[i.popLast().toArray(),i.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return dn(e).j(IDBKeyRange.bound(o,a,!0)).next(u=>{let c=Me();for(const l of u){const h=this.ts(T.fromSegments(l.prefixPath.concat(l.collectionGroup,l.documentId)),l);h.isFoundDocument()&&(qr(t,h)||s.has(h.key))&&(c=c.insert(h.key,h))}return c})}getAllFromCollectionGroup(e,t,r,s){let i=Me();const o=Xd(t,r),a=Xd(t,Ue.max());return dn(e).X({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,l)=>{const h=this.ts(T.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(h.key,h),i.size===s&&l.done()}).next(()=>i)}newChangeBuffer(e){return new g_(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Zd(e).get("remoteDocumentGlobalKey").next(t=>(C(!!t),t))}Zn(e,t){return Zd(e).put("remoteDocumentGlobalKey",t)}ts(e,t){if(t){const r=function Jy(n,e){let t;if(e.document)t=wd(n.fe,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=T.fromSegments(e.noDocument.path),s=an(e.noDocument.readTime);t=Z.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return S();{const r=T.fromSegments(e.unknownDocument.path),s=an(e.unknownDocument.version);t=Z.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(r){const s=new J(r[0],r[1]);return A.fromTimestamp(s)}(e.readTime)),t}(this.serializer,t);if(!r.isNoDocument()||!r.version.isEqual(A.min()))return r}return Z.newInvalidDocument(e)}}function Wd(n){return new f_(n)}class g_ extends Hd{constructor(e,t){super(),this.os=e,this.trackRemovals=t,this.us=new dt(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new W((i,o)=>k(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.us.get(i);if(t.push(this.os.removeEntry(e,i,a.readTime)),o.isValidDocument()){const u=Cd(this.os.serializer,o);s=s.add(i.path.popLast());const c=xi(u);r+=c-a.size,t.push(this.os.addEntry(e,i,u))}else if(r-=a.size,this.trackRemovals){const u=Cd(this.os.serializer,o.convertToNoDocument(A.min()));t.push(this.os.addEntry(e,i,u))}}),s.forEach(i=>{t.push(this.os.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.os.updateMetadata(e,r)),g.waitFor(t)}getFromCache(e,t){return this.os.es(e,t).next(r=>(this.us.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.os.ss(e,t).next(({documents:r,rs:s})=>(s.forEach((i,o)=>{this.us.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function Zd(n){return me(n,"remoteDocumentGlobal")}function dn(n){return me(n,"remoteDocumentsV14")}function ns(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Xd(n,e){const t=e.documentKey.path.toArray();return[n,_i(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Yd(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=k(t[i],r[i]),s)return s;return s=k(t.length,r.length),s||(s=k(t[t.length-2],r[r.length-2]),s||k(t[t.length-1],r[r.length-1]))}class m_{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Jd{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(null!==r&&jr(r.mutation,s,Fe.empty(),J.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,O()).next(()=>r))}getLocalViewOfDocuments(e,t,r=O()){const s=tt();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=Br();return i.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=tt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,O()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=Me();const o=Gr(),a=Gr();return t.forEach((u,c)=>{const l=r.get(c.key);s.has(c.key)&&(void 0===l||l.mutation instanceof ft)?i=i.insert(c.key,c):void 0!==l?(o.set(c.key,l.mutation.getFieldMask()),jr(l.mutation,c,l.mutation.getFieldMask(),J.now())):o.set(c.key,Fe.empty())}),this.recalculateAndSaveOverlays(e,i).next(u=>(u.forEach((c,l)=>o.set(c,l)),t.forEach((c,l)=>{var h;return a.set(c,new m_(l,null!==(h=o.get(c))&&void 0!==h?h:null))}),a))}recalculateAndSaveOverlays(e,t){const r=Gr();let s=new K((o,a)=>o-a),i=O();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(u=>{const c=t.get(u);if(null===c)return;let l=r.get(u)||Fe.empty();l=a.applyToLocalView(c,l),r.set(u,l);const h=(s.get(a.batchId)||O()).add(u);s=s.insert(a.batchId,h)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const u=a.getNext(),c=u.key,l=u.value,h=$h();l.forEach(d=>{if(!i.has(d)){const f=ed(t.get(d),r.get(d));null!==f&&h.set(d,f),i=i.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return g.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r){return T.isDocumentKey((s=t).path)&&null===s.collectionGroup&&0===s.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):fa(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r):this.getDocumentsMatchingCollectionQuery(e,t,r);var s}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):g.resolve(tt());let a=-1,u=i;return o.next(c=>g.forEach(c,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),i.get(l)?g.resolve():this.remoteDocumentCache.getEntry(e,l).next(d=>{u=u.insert(l,d)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,u,c,O())).next(l=>({batchId:a,changes:jh(l)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new T(t)).next(r=>{let s=Br();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r){const s=t.collectionGroup;let i=Br();return this.indexManager.getCollectionParents(e,s).next(o=>g.forEach(o,a=>{const u=(c=t,l=a.child(s),new ht(l,null,c.explicitOrderBy.slice(),c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt));var c,l;return this.getDocumentsMatchingCollectionQuery(e,u,r).next(c=>{c.forEach((l,h)=>{i=i.insert(l,h)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s))).next(i=>{s.forEach((a,u)=>{const c=u.getKey();null===i.get(c)&&(i=i.insert(c,Z.newInvalidDocument(c)))});let o=Br();return i.forEach((a,u)=>{const c=s.get(a);void 0!==c&&jr(c.mutation,u,Fe.empty(),J.now()),qr(t,u)&&(o=o.insert(a,u))}),o})}}class p_{constructor(e){this.serializer=e,this.cs=new Map,this.hs=new Map}getBundleMetadata(e,t){return g.resolve(this.cs.get(t))}saveBundleMetadata(e,t){var r;return this.cs.set(t.id,{id:(r=t).id,version:r.version,createTime:oe(r.createTime)}),g.resolve()}getNamedQuery(e,t){return g.resolve(this.hs.get(t))}saveNamedQuery(e,t){return this.hs.set(t.name,{name:(r=t).name,query:Aa(r.bundledQuery),readTime:oe(r.readTime)}),g.resolve();var r}}class y_{constructor(){this.overlays=new K(T.comparator),this.ls=new Map}getOverlay(e,t){return g.resolve(this.overlays.get(t))}getOverlays(e,t){const r=tt();return g.forEach(t,s=>this.getOverlay(e,s).next(i=>{null!==i&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.we(e,t,i)}),g.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.ls.get(r);return void 0!==s&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.ls.delete(r)),g.resolve()}getOverlaysForCollection(e,t,r){const s=tt(),i=t.length+1,o=new T(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return g.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new K((c,l)=>c-l);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let l=i.get(c.largestBatchId);null===l&&(l=tt(),i=i.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}const a=tt(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=s)););return g.resolve(a)}we(e,t,r){const s=this.overlays.get(r.key);if(null!==s){const o=this.ls.get(s.largestBatchId).delete(r.key);this.ls.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new wa(t,r));let i=this.ls.get(t);void 0===i&&(i=O(),this.ls.set(t,i)),this.ls.set(t,i.add(r.key))}}class Fa{constructor(){this.fs=new W(pe.ds),this.ws=new W(pe._s)}isEmpty(){return this.fs.isEmpty()}addReference(e,t){const r=new pe(e,t);this.fs=this.fs.add(r),this.ws=this.ws.add(r)}gs(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.ys(new pe(e,t))}ps(e,t){e.forEach(r=>this.removeReference(r,t))}Is(e){const t=new T(new V([])),r=new pe(t,e),s=new pe(t,e+1),i=[];return this.ws.forEachInRange([r,s],o=>{this.ys(o),i.push(o.key)}),i}Ts(){this.fs.forEach(e=>this.ys(e))}ys(e){this.fs=this.fs.delete(e),this.ws=this.ws.delete(e)}Es(e){const t=new T(new V([])),r=new pe(t,e),s=new pe(t,e+1);let i=O();return this.ws.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new pe(e,0),r=this.fs.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class pe{constructor(e,t){this.key=e,this.As=t}static ds(e,t){return T.comparator(e.key,t.key)||k(e.As,t.As)}static _s(e,t){return k(e.As,t.As)||T.comparator(e.key,t.key)}}class __{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.vs=1,this.Rs=new W(pe.ds)}checkEmpty(e){return g.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,s){const i=this.vs;this.vs++;const o=new _a(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.Rs=this.Rs.add(new pe(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return g.resolve(o)}lookupMutationBatch(e,t){return g.resolve(this.Ps(t))}getNextMutationBatchAfterBatchId(e,t){const s=this.bs(t+1),i=s<0?0:s;return g.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return g.resolve(0===this.mutationQueue.length?-1:this.vs-1)}getAllMutationBatches(e){return g.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new pe(t,0),s=new pe(t,Number.POSITIVE_INFINITY),i=[];return this.Rs.forEachInRange([r,s],o=>{const a=this.Ps(o.As);i.push(a)}),g.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new W(k);return t.forEach(s=>{const i=new pe(s,0),o=new pe(s,Number.POSITIVE_INFINITY);this.Rs.forEachInRange([i,o],a=>{r=r.add(a.As)})}),g.resolve(this.Vs(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;T.isDocumentKey(i)||(i=i.child(""));const o=new pe(new T(i),0);let a=new W(k);return this.Rs.forEachWhile(u=>{const c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(u.As)),!0)},o),g.resolve(this.Vs(a))}Vs(e){const t=[];return e.forEach(r=>{const s=this.Ps(r);null!==s&&t.push(s)}),t}removeMutationBatch(e,t){C(0===this.Ss(t.batchId,"removed")),this.mutationQueue.shift();let r=this.Rs;return g.forEach(t.mutations,s=>{const i=new pe(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Rs=r})}Cn(e){}containsKey(e,t){const r=new pe(t,0),s=this.Rs.firstAfterOrEqual(r);return g.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return g.resolve()}Ss(e,t){return this.bs(e)}bs(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Ps(e){const t=this.bs(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class v_{constructor(e){this.Ds=e,this.docs=new K(T.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Ds(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return g.resolve(r?r.document.mutableCopy():Z.newInvalidDocument(t))}getEntries(e,t){let r=Me();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Z.newInvalidDocument(s))}),g.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Me();const o=t.path,a=new T(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){const{key:c,value:{document:l}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||na(ih(l),r)<=0||(s.has(l.key)||qr(t,l))&&(i=i.insert(l.key,l.mutableCopy()))}return g.resolve(i)}getAllFromCollectionGroup(e,t,r,s){S()}Cs(e,t){return g.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new w_(this)}getSize(e){return g.resolve(this.size)}}class w_ extends Hd{constructor(e){super(),this.os=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.os.addEntry(e,s)):this.os.removeEntry(r)}),g.waitFor(t)}getFromCache(e,t){return this.os.getEntry(e,t)}getAllFromCache(e,t){return this.os.getEntries(e,t)}}class I_{constructor(e){this.persistence=e,this.xs=new dt(t=>tn(t),Ur),this.lastRemoteSnapshotVersion=A.min(),this.highestTargetId=0,this.Ns=0,this.ks=new Fa,this.targetCount=0,this.Ms=hn.kn()}forEachTarget(e,t){return this.xs.forEach((r,s)=>t(s)),g.resolve()}getLastRemoteSnapshotVersion(e){return g.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return g.resolve(this.Ns)}allocateTargetId(e){return this.highestTargetId=this.Ms.next(),g.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Ns&&(this.Ns=t),g.resolve()}Fn(e){this.xs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ms=new hn(t),this.highestTargetId=t),e.sequenceNumber>this.Ns&&(this.Ns=e.sequenceNumber)}addTargetData(e,t){return this.Fn(t),this.targetCount+=1,g.resolve()}updateTargetData(e,t){return this.Fn(t),g.resolve()}removeTargetData(e,t){return this.xs.delete(t.target),this.ks.Is(t.targetId),this.targetCount-=1,g.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.xs.forEach((o,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.xs.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),g.waitFor(i).next(()=>s)}getTargetCount(e){return g.resolve(this.targetCount)}getTargetData(e,t){const r=this.xs.get(t)||null;return g.resolve(r)}addMatchingKeys(e,t,r){return this.ks.gs(t,r),g.resolve()}removeMatchingKeys(e,t,r){this.ks.ps(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),g.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.ks.Is(t),g.resolve()}getMatchingKeysForTargetId(e,t){const r=this.ks.Es(t);return g.resolve(r)}containsKey(e,t){return g.resolve(this.ks.containsKey(t))}}class Ma{constructor(e,t){this.$s={},this.overlays={},this.Os=new Ve(0),this.Fs=!1,this.Fs=!0,this.referenceDelegate=e(this),this.Bs=new I_(this),this.indexManager=new a_,this.remoteDocumentCache=new v_(r=>this.referenceDelegate.Ls(r)),this.serializer=new bd(t),this.qs=new p_(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Fs=!1,Promise.resolve()}get started(){return this.Fs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new y_,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.$s[e.toKey()];return r||(r=new __(t,this.referenceDelegate),this.$s[e.toKey()]=r),r}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.qs}runTransaction(e,t,r){v("MemoryPersistence","Starting transaction:",e);const s=new T_(this.Os.next());return this.referenceDelegate.Us(),r(s).next(i=>this.referenceDelegate.Ks(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Gs(e,t){return g.or(Object.values(this.$s).map(r=>()=>r.containsKey(e,t)))}}class T_ extends ah{constructor(e){super(),this.currentSequenceNumber=e}}class bi{constructor(e){this.persistence=e,this.Qs=new Fa,this.js=null}static zs(e){return new bi(e)}get Ws(){if(this.js)return this.js;throw S()}addReference(e,t,r){return this.Qs.addReference(r,t),this.Ws.delete(r.toString()),g.resolve()}removeReference(e,t,r){return this.Qs.removeReference(r,t),this.Ws.add(r.toString()),g.resolve()}markPotentiallyOrphaned(e,t){return this.Ws.add(t.toString()),g.resolve()}removeTarget(e,t){this.Qs.Is(t.targetId).forEach(s=>this.Ws.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Ws.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}Us(){this.js=new Set}Ks(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return g.forEach(this.Ws,r=>{const s=T.fromPath(r);return this.Hs(e,s).next(i=>{i||t.removeEntry(s,A.min())})}).next(()=>(this.js=null,t.apply(e)))}updateLimboDocument(e,t){return this.Hs(e,t).next(r=>{r?this.Ws.delete(t.toString()):this.Ws.add(t.toString())})}Ls(e){return 0}Hs(e,t){return g.or([()=>g.resolve(this.Qs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gs(e,t)])}}class x_{constructor(e){this.serializer=e}O(e,t,r,s){const i=new ti("createOrUpgrade",t);var a;r<1&&s>=1&&(e.createObjectStore("owner"),(a=e).createObjectStore("mutationQueues",{keyPath:"userId"}),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",hh,{unique:!0}),a.createObjectStore("documentMutations"),ef(e),function(a){a.createObjectStore("remoteDocuments")}(e));let o=g.resolve();return r<3&&s>=3&&(0!==r&&(function(a){a.deleteObjectStore("targetDocuments"),a.deleteObjectStore("targets"),a.deleteObjectStore("targetGlobal")}(e),ef(e)),o=o.next(()=>function(a){const u=a.store("targetGlobal"),c={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:A.min().toTimestamp(),targetCount:0};return u.put("targetGlobalKey",c)}(i))),r<4&&s>=4&&(0!==r&&(o=o.next(()=>function(a,u){return u.store("mutations").j().next(c=>{a.deleteObjectStore("mutations"),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",hh,{unique:!0});const l=u.store("mutations"),h=c.map(d=>l.put(d));return g.waitFor(h)})}(e,i))),o=o.next(()=>{!function(a){a.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&s>=5&&(o=o.next(()=>this.Ys(i))),r<6&&s>=6&&(o=o.next(()=>(function(a){a.createObjectStore("remoteDocumentGlobal")}(e),this.Xs(i)))),r<7&&s>=7&&(o=o.next(()=>this.Zs(i))),r<8&&s>=8&&(o=o.next(()=>this.ti(e,i))),r<9&&s>=9&&(o=o.next(()=>{!function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&s>=10&&(o=o.next(()=>this.ei(i))),r<11&&s>=11&&(o=o.next(()=>{(function(a){a.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(a){a.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{!function(a){const u=a.createObjectStore("documentOverlays",{keyPath:ay});u.createIndex("collectionPathOverlayIndex",uy,{unique:!1}),u.createIndex("collectionGroupOverlayIndex",cy,{unique:!1})}(e)})),r<13&&s>=13&&(o=o.next(()=>function(a){const u=a.createObjectStore("remoteDocumentsV14",{keyPath:Zp});u.createIndex("documentKeyIndex",Xp),u.createIndex("collectionGroupIndex",Yp)}(e)).next(()=>this.ni(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.si(e,i))),r<15&&s>=15&&(o=o.next(()=>function(a){a.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),a.createObjectStore("indexState",{keyPath:ry}).createIndex("sequenceNumberIndex",sy,{unique:!1}),a.createObjectStore("indexEntries",{keyPath:iy}).createIndex("documentKeyIndex",oy,{unique:!1})}(e))),o}Xs(e){let t=0;return e.store("remoteDocuments").X((r,s)=>{t+=xi(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Ys(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.j().next(s=>g.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.j("userMutationsIndex",o).next(a=>g.forEach(a,u=>{C(u.userId===i.userId);const c=un(this.serializer,u);return Bd(e,i.userId,c).next(()=>{})}))}))}Zs(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.X((o,a)=>{const u=new V(o),c=[0,Se(u)];i.push(t.get(c).next(l=>l?g.resolve():t.put({targetId:0,path:Se(u),sequenceNumber:s.highestListenSequenceNumber})))}).next(()=>g.waitFor(i))})}ti(e,t){e.createObjectStore("collectionParents",{keyPath:ny});const r=t.store("collectionParents"),s=new Oa,i=o=>{if(s.add(o)){const a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:Se(u)})}};return t.store("remoteDocuments").X({Y:!0},(o,a)=>{const u=new V(o);return i(u.popLast())}).next(()=>t.store("documentMutations").X({Y:!0},([o,a,u],c)=>{const l=Je(a);return i(l.popLast())}))}ei(e){const t=e.store("targets");return t.X((r,s)=>{const i=Xr(s),o=Ad(this.serializer,i);return t.put(o)})}ni(e,t){const r=t.store("remoteDocuments"),s=[];return r.X((i,o)=>{const a=t.store("remoteDocumentsV14"),u=(c=o,c.document?new T(V.fromString(c.document.name).popFirst(5)):c.noDocument?T.fromSegments(c.noDocument.path):c.unknownDocument?T.fromSegments(c.unknownDocument.path):S()).path.toArray();var c;const l={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(l))}).next(()=>g.waitFor(s))}si(e,t){const r=t.store("mutations"),s=Wd(this.serializer),i=new Ma(bi.zs,this.serializer.fe);return r.j().next(o=>{const a=new Map;return o.forEach(u=>{var c;let l=null!==(c=a.get(u.userId))&&void 0!==c?c:O();un(this.serializer,u).keys().forEach(h=>l=l.add(h)),a.set(u.userId,l)}),g.forEach(a,(u,c)=>{const l=new ge(c),h=vi.de(this.serializer,l),d=i.getIndexManager(l),f=Ei.de(l,this.serializer,d,i.referenceDelegate);return new Jd(s,f,h,d).recalculateAndSaveOverlaysForDocumentKeys(new ia(t,Ve.ct),u).next()})})}}function ef(n){n.createObjectStore("targetDocuments",{keyPath:ey}).createIndex("documentTargetsIndex",ty,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Jp,{unique:!0}),n.createObjectStore("targetGlobal")}const La="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Ua{constructor(e,t,r,s,i,o,a,u,c,l,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.ii=i,this.window=o,this.document=a,this.ri=c,this.oi=l,this.ui=h,this.Os=null,this.Fs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.ai=null,this.hi=null,this.li=Number.NEGATIVE_INFINITY,this.fi=d=>Promise.resolve(),!Ua.D())throw new _(m.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new d_(this,s),this.di=t+"main",this.serializer=new bd(u),this.wi=new He(this.di,this.ui,new x_(this.serializer)),this.Bs=new c_(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Wd(this.serializer),this.qs=new e_,this.window&&this.window.localStorage?this._i=this.window.localStorage:(this._i=null,!1===l&&ie("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new _(m.FAILED_PRECONDITION,La);return this.gi(),this.yi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Bs.getHighestSequenceNumber(e))}).then(e=>{this.Os=new Ve(e,this.ri)}).then(()=>{this.Fs=!0}).catch(e=>(this.wi&&this.wi.close(),Promise.reject(e)))}Ii(e){var t=this;return this.fi=function(){var r=(0,p.Z)(function*(s){if(t.started)return e(s)});return function(s){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.wi.B(function(){var t=(0,p.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.ii.enqueueAndForget((0,p.Z)(function*(){t.started&&(yield t.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Ai(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Ti(e).next(t=>{t||(this.isPrimary=!1,this.ii.enqueueRetryable(()=>this.fi(!1)))})}).next(()=>this.Ei(e)).next(t=>this.isPrimary&&!t?this.Ai(e).next(()=>!1):!!t&&this.vi(e).next(()=>!0))).catch(e=>{if(Ct(e))return v("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return v("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ii.enqueueRetryable(()=>this.fi(e)),this.isPrimary=e})}Ti(e){return rs(e).get("owner").next(t=>g.resolve(this.Ri(t)))}Pi(e){return Ai(e).delete(this.clientId)}bi(){var e=this;return(0,p.Z)(function*(){if(e.isPrimary&&!e.Vi(e.li,18e5)){e.li=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const s=me(r,"clientMetadata");return s.j().next(i=>{const o=e.Si(i,18e5),a=i.filter(u=>-1===o.indexOf(u));return g.forEach(a,u=>s.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(e._i)for(const r of t)e._i.removeItem(e.Di(r.clientId))}})()}pi(){this.hi=this.ii.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.bi()).then(()=>this.pi()))}Ri(e){return!!e&&e.ownerId===this.clientId}Ei(e){return this.oi?g.resolve(!0):rs(e).get("owner").next(t=>{if(null!==t&&this.Vi(t.leaseTimestampMs,5e3)&&!this.Ci(t.ownerId)){if(this.Ri(t)&&this.networkEnabled)return!0;if(!this.Ri(t)){if(!t.allowTabSynchronization)throw new _(m.FAILED_PRECONDITION,La);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ai(e).j().next(r=>void 0===this.Si(r,5e3).find(s=>!(this.clientId===s.clientId||!(!this.networkEnabled&&s.networkEnabled||!this.inForeground&&s.inForeground&&this.networkEnabled===s.networkEnabled))))}).next(t=>(this.isPrimary!==t&&v("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,p.Z)(function*(){e.Fs=!1,e.xi(),e.hi&&(e.hi.cancel(),e.hi=null),e.Ni(),e.ki(),yield e.wi.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new ia(t,Ve.ct);return e.Ai(r).next(()=>e.Pi(r))}),e.wi.close(),e.Mi()})()}Si(e,t){return e.filter(r=>this.Vi(r.updateTimeMs,t)&&!this.Ci(r.clientId))}$i(){return this.runTransaction("getActiveClients","readonly",e=>Ai(e).j().next(t=>this.Si(t,18e5).map(r=>r.clientId)))}get started(){return this.Fs}getMutationQueue(e,t){return Ei.de(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Bs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new u_(e,this.serializer.fe.databaseId)}getDocumentOverlayCache(e){return vi.de(this.serializer,e)}getBundleCache(){return this.qs}runTransaction(e,t,r){v("IndexedDbPersistence","Starting transaction:",e);const s="readonly"===t?"readonly":"readwrite",i=15===(o=this.ui)?hy:14===o?mh:13===o?gh:12===o?ly:11===o?fh:void S();var o;let a;return this.wi.runTransaction(e,s,i,u=>(a=new ia(u,this.Os?this.Os.next():Ve.ct),"readwrite-primary"===t?this.Ti(a).next(c=>!!c||this.Ei(a)).next(c=>{if(!c)throw ie(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ii.enqueueRetryable(()=>this.fi(!1)),new _(m.FAILED_PRECONDITION,oh);return r(a)}).next(c=>this.vi(a).next(()=>c)):this.Oi(a).next(()=>r(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}Oi(e){return rs(e).get("owner").next(t=>{if(null!==t&&this.Vi(t.leaseTimestampMs,5e3)&&!this.Ci(t.ownerId)&&!this.Ri(t)&&!(this.oi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new _(m.FAILED_PRECONDITION,La)})}vi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return rs(e).put("owner",t)}static D(){return He.D()}Ai(e){const t=rs(e);return t.get("owner").next(r=>this.Ri(r)?(v("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):g.resolve())}Vi(e,t){const r=Date.now();return!(e<r-t||e>r&&(ie(`Detected an update time that is in the future: ${e} > ${r}`),1))}gi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ai=()=>{this.ii.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.mi()))},this.document.addEventListener("visibilitychange",this.ai),this.inForeground="visible"===this.document.visibilityState)}Ni(){this.ai&&(this.document.removeEventListener("visibilitychange",this.ai),this.ai=null)}yi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ci=()=>{this.xi();const t=/(?:Version|Mobile)\/1[456]/;(0,M.G6)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ii.enterRestrictedMode(!0),this.ii.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}ki(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Ci(e){var t;try{const r=null!==(null===(t=this._i)||void 0===t?void 0:t.getItem(this.Di(e)));return v("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return ie("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}xi(){if(this._i)try{this._i.setItem(this.Di(this.clientId),String(Date.now()))}catch(e){ie("Failed to set zombie client id.",e)}}Mi(){if(this._i)try{this._i.removeItem(this.Di(this.clientId))}catch{}}Di(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function rs(n){return me(n,"owner")}function Ai(n){return me(n,"clientMetadata")}function Va(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class qa{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Fi=r,this.Bi=s}static Li(e,t){let r=O(),s=O();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new qa(e,t.fromCache,r,s)}}class tf{constructor(){this.qi=!1}initialize(e,t){this.Ui=e,this.indexManager=t,this.qi=!0}getDocumentsMatchingQuery(e,t,r,s){return this.Ki(e,t).next(i=>i||this.Gi(e,t,s,r)).next(i=>i||this.Qi(e,t))}Ki(e,t){if(Vh(t))return g.resolve(null);let r=ke(t);return this.indexManager.getIndexType(e,r).next(s=>0===s?null:(null!==t.limit&&1===s&&(t=di(t,null,"F"),r=ke(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=O(...i);return this.Ui.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{const c=this.ji(t,a);return this.zi(t,c,o,u.readTime)?this.Ki(e,di(t,null,"F")):this.Wi(e,c,t,u)}))})))}Gi(e,t,r,s){return Vh(t)||s.isEqual(A.min())?this.Qi(e,t):this.Ui.getDocuments(e,r).next(i=>{const o=this.ji(t,i);return this.zi(t,o,r,s)?this.Qi(e,t):(Jo()<=Qt.in.DEBUG&&v("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),ma(t)),this.Wi(e,o,t,sh(s,-1)))})}ji(e,t){let r=new W(Gh(e));return t.forEach((s,i)=>{qr(e,i)&&(r=r.add(i))}),r}zi(e,t,r,s){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Qi(e,t){return Jo()<=Qt.in.DEBUG&&v("QueryEngine","Using full collection scan to execute query:",ma(t)),this.Ui.getDocumentsMatchingQuery(e,t,Ue.min())}Wi(e,t,r,s){return this.Ui.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}class E_{constructor(e,t,r,s){this.persistence=e,this.Hi=t,this.serializer=s,this.Ji=new K(k),this.Yi=new dt(i=>tn(i),Ur),this.Xi=new Map,this.Zi=e.getRemoteDocumentCache(),this.Bs=e.getTargetCache(),this.qs=e.getBundleCache(),this.tr(r)}tr(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Jd(this.Zi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Zi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ji))}}function nf(n,e,t,r){return new E_(n,e,t,r)}function rf(n,e){return Ba.apply(this,arguments)}function Ba(){return Ba=(0,p.Z)(function*(n,e){const t=x(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.tr(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let u=O();for(const c of s){o.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}for(const c of i){a.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}return t.localDocuments.getDocuments(r,u).next(c=>({er:c,removedBatchIds:o,addedBatchIds:a}))})})}),Ba.apply(this,arguments)}function sf(n){const e=x(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Bs.getLastRemoteSnapshotVersion(t))}function af(n,e,t){let r=O(),s=O();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=Me();return t.forEach((a,u)=>{const c=i.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),u.isNoDocument()&&u.version.isEqual(A.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||0===u.version.compareTo(c.version)&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):v("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{nr:o,sr:s}})}function C_(n,e){const t=x(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function zn(n,e){const t=x(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Bs.getTargetData(r,e).next(i=>i?(s=i,g.resolve(s)):t.Bs.allocateTargetId(r).next(o=>(s=new gt(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Bs.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.Ji.get(r.targetId);return(null===s||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ji=t.Ji.insert(r.targetId,r),t.Yi.set(e,r.targetId)),r})}function jn(n,e,t){return Ga.apply(this,arguments)}function Ga(){return Ga=(0,p.Z)(function*(n,e,t){const r=x(n),s=r.Ji.get(e),i=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!Ct(o))throw o;v("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ji=r.Ji.remove(e),r.Yi.delete(s.target)}),Ga.apply(this,arguments)}function Di(n,e,t){const r=x(n);let s=A.min(),i=O();return r.persistence.runTransaction("Execute query","readonly",o=>function(a,u,c){const l=x(a),h=l.Yi.get(c);return void 0!==h?g.resolve(l.Ji.get(h)):l.Bs.getTargetData(u,c)}(r,o,ke(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Bs.getMatchingKeysForTargetId(o,a.targetId).next(u=>{i=u})}).next(()=>r.Hi.getDocumentsMatchingQuery(o,e,t?s:A.min(),t?i:O())).next(a=>(lf(r,Bh(e),a),{documents:a,ir:i})))}function uf(n,e){const t=x(n),r=x(t.Bs),s=t.Ji.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.le(i,e).next(o=>o?o.target:null))}function cf(n,e){const t=x(n),r=t.Xi.get(e)||A.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.Zi.getAllFromCollectionGroup(s,e,sh(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(lf(t,e,s),s))}function lf(n,e,t){let r=n.Xi.get(e)||A.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.Xi.set(e,r)}function za(){return za=(0,p.Z)(function*(n,e,t,r){const s=x(n);let i=O(),o=Me();for(const c of t){const l=e.rr(c.metadata.name);c.document&&(i=i.add(l));const h=e.ur(c);h.setReadTime(e.cr(c.metadata.readTime)),o=o.insert(l,h)}const a=s.Zi.newChangeBuffer({trackRemovals:!0}),u=yield zn(s,(c=r,ke(On(V.fromString(`__bundle__/docs/${c}`)))));var c;return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>af(c,a,o).next(l=>(a.apply(c),l)).next(l=>s.Bs.removeMatchingKeysForTargetId(c,u.targetId).next(()=>s.Bs.addMatchingKeys(c,i,u.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,l.nr,l.sr)).next(()=>l.nr)))}),za.apply(this,arguments)}function D_(n,e){return ja.apply(this,arguments)}function ja(){return ja=(0,p.Z)(function*(n,e,t=O()){const r=yield zn(n,ke(Aa(e.bundledQuery))),s=x(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=oe(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.qs.saveNamedQuery(i,e);const a=r.withResumeToken(he.EMPTY_BYTE_STRING,o);return s.Ji=s.Ji.insert(a.targetId,a),s.Bs.updateTargetData(i,a).next(()=>s.Bs.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Bs.addMatchingKeys(i,t,r.targetId)).next(()=>s.qs.saveNamedQuery(i,e))})}),ja.apply(this,arguments)}function hf(n,e){return`firestore_clients_${n}_${e}`}function df(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function $a(n,e){return`firestore_targets_${n}_${e}`}class ki{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static ar(e,t,r){const s=JSON.parse(r);let i,o="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return o&&s.error&&(o="string"==typeof s.error.message&&"string"==typeof s.error.code,o&&(i=new _(s.error.code,s.error.message))),o?new ki(e,t,s.state,i):(ie("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}hr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ss{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static ar(e,t){const r=JSON.parse(t);let s,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new _(r.error.code,r.error.message))),i?new ss(e,r.state,s):(ie("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}hr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ni{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static ar(e,t){const r=JSON.parse(t);let s="object"==typeof r&&r.activeTargetIds instanceof Array,i=pa();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=ch(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Ni(e,i):(ie("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Ka{constructor(e,t){this.clientId=e,this.onlineState=t}static ar(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Ka(t.clientId,t.onlineState):(ie("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Qa{constructor(){this.activeTargetIds=pa()}lr(e){this.activeTargetIds=this.activeTargetIds.add(e)}dr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}hr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Ha{constructor(e,t,r,s,i){this.window=e,this.ii=t,this.persistenceKey=r,this.wr=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this._r=this.mr.bind(this),this.gr=new K(k),this.started=!1,this.yr=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.pr=hf(this.persistenceKey,this.wr),this.Ir=`firestore_sequence_number_${this.persistenceKey}`,this.gr=this.gr.insert(this.wr,new Qa),this.Tr=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Er=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ar=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.vr=`firestore_online_state_${this.persistenceKey}`,this.Rr=function(a){return`firestore_bundle_loaded_v2_${a}`}(this.persistenceKey),this.window.addEventListener("storage",this._r)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,p.Z)(function*(){const t=yield e.syncEngine.$i();for(const s of t){if(s===e.wr)continue;const i=e.getItem(hf(e.persistenceKey,s));if(i){const o=Ni.ar(s,i);o&&(e.gr=e.gr.insert(o.clientId,o))}}e.Pr();const r=e.storage.getItem(e.vr);if(r){const s=e.br(r);s&&e.Vr(s)}for(const s of e.yr)e.mr(s);e.yr=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.Ir,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Sr(this.gr)}isActiveQueryTarget(e){let t=!1;return this.gr.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Dr(e,"pending")}updateMutationState(e,t,r){this.Dr(e,t,r),this.Cr(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem($a(this.persistenceKey,e));if(r){const s=ss.ar(e,r);s&&(t=s.state)}}return this.Nr.lr(e),this.Pr(),t}removeLocalQueryTarget(e){this.Nr.dr(e),this.Pr()}isLocalQueryTarget(e){return this.Nr.activeTargetIds.has(e)}clearQueryState(e){this.removeItem($a(this.persistenceKey,e))}updateQueryState(e,t,r){this.kr(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Cr(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Mr(e)}notifyBundleLoaded(e){this.$r(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this._r),this.removeItem(this.pr),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return v("SharedClientState","READ",e,t),t}setItem(e,t){v("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){v("SharedClientState","REMOVE",e),this.storage.removeItem(e)}mr(e){var t=this;const r=e;if(r.storageArea===this.storage){if(v("SharedClientState","EVENT",r.key,r.newValue),r.key===this.pr)return void ie("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ii.enqueueRetryable((0,p.Z)(function*(){if(t.started){if(null!==r.key)if(t.Tr.test(r.key)){if(null==r.newValue){const s=t.Or(r.key);return t.Fr(s,null)}{const s=t.Br(r.key,r.newValue);if(s)return t.Fr(s.clientId,s)}}else if(t.Er.test(r.key)){if(null!==r.newValue){const s=t.Lr(r.key,r.newValue);if(s)return t.qr(s)}}else if(t.Ar.test(r.key)){if(null!==r.newValue){const s=t.Ur(r.key,r.newValue);if(s)return t.Kr(s)}}else if(r.key===t.vr){if(null!==r.newValue){const s=t.br(r.newValue);if(s)return t.Vr(s)}}else if(r.key===t.Ir){const s=function(i){let o=Ve.ct;if(null!=i)try{const a=JSON.parse(i);C("number"==typeof a),o=a}catch(a){ie("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(r.newValue);s!==Ve.ct&&t.sequenceNumberHandler(s)}else if(r.key===t.Rr){const s=t.Gr(r.newValue);yield Promise.all(s.map(i=>t.syncEngine.Qr(i)))}}else t.yr.push(r)}))}}get Nr(){return this.gr.get(this.wr)}Pr(){this.setItem(this.pr,this.Nr.hr())}Dr(e,t,r){const s=new ki(this.currentUser,e,t,r),i=df(this.persistenceKey,this.currentUser,e);this.setItem(i,s.hr())}Cr(e){const t=df(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Mr(e){this.storage.setItem(this.vr,JSON.stringify({clientId:this.wr,onlineState:e}))}kr(e,t,r){const s=$a(this.persistenceKey,e),i=new ss(e,t,r);this.setItem(s,i.hr())}$r(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Rr,t)}Or(e){const t=this.Tr.exec(e);return t?t[1]:null}Br(e,t){const r=this.Or(e);return Ni.ar(r,t)}Lr(e,t){const r=this.Er.exec(e),s=Number(r[1]);return ki.ar(new ge(void 0!==r[2]?r[2]:null),s,t)}Ur(e,t){const r=this.Ar.exec(e),s=Number(r[1]);return ss.ar(s,t)}br(e){return Ka.ar(e)}Gr(e){return JSON.parse(e)}qr(e){var t=this;return(0,p.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.jr(e.batchId,e.state,e.error);v("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}Kr(e){return this.syncEngine.zr(e.targetId,e.state,e.error)}Fr(e,t){const r=t?this.gr.insert(e,t):this.gr.remove(e),s=this.Sr(this.gr),i=this.Sr(r),o=[],a=[];return i.forEach(u=>{s.has(u)||o.push(u)}),s.forEach(u=>{i.has(u)||a.push(u)}),this.syncEngine.Wr(o,a).then(()=>{this.gr=r})}Vr(e){this.gr.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Sr(e){let t=pa();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class ff{constructor(){this.Hr=new Qa,this.Jr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.Hr.lr(e),this.Jr[e]||"not-current"}updateQueryState(e,t,r){this.Jr[e]=t}removeLocalQueryTarget(e){this.Hr.dr(e)}isLocalQueryTarget(e){return this.Hr.activeTargetIds.has(e)}clearQueryState(e){delete this.Jr[e]}getAllActiveQueryTargets(){return this.Hr.activeTargetIds}isActiveQueryTarget(e){return this.Hr.activeTargetIds.has(e)}start(){return this.Hr=new Qa,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class k_{Yr(e){}shutdown(){}}class gf{constructor(){this.Xr=()=>this.Zr(),this.eo=()=>this.no(),this.so=[],this.io()}Yr(e){this.so.push(e)}shutdown(){window.removeEventListener("online",this.Xr),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Xr),window.addEventListener("offline",this.eo)}Zr(){v("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.so)e(0)}no(){v("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.so)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Ri=null;function Wa(){return null===Ri?Ri=268435456+Math.round(2147483648*Math.random()):Ri++,"0x"+Ri.toString(16)}const N_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class R_{constructor(e){this.ro=e.ro,this.oo=e.oo}uo(e){this.co=e}ao(e){this.ho=e}onMessage(e){this.lo=e}close(){this.oo()}send(e){this.ro(e)}fo(){this.co()}wo(e){this.ho(e)}_o(e){this.lo(e)}}const Ce="WebChannelConnection";class P_ extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.mo=(e.ssl?"https":"http")+"://"+e.host,this.yo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get po(){return!1}Io(e,t,r,s,i){const o=Wa(),a=this.To(e,t);v("RestConnection",`Sending RPC '${e}' ${o}:`,a,r);const u={};return this.Eo(u,s,i),this.Ao(e,a,u,r).then(c=>(v("RestConnection",`Received RPC '${e}' ${o}: `,c),c),c=>{throw je("RestConnection",`RPC '${e}' ${o} failed with error: `,c,"url: ",a,"request:",r),c})}vo(e,t,r,s,i,o){return this.Io(e,t,r,s,i)}Eo(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+An,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}To(e,t){return`${this.mo}/v1/${t}:${N_[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ao(e,t,r,s){const i=Wa();return new Promise((o,a)=>{const u=new kp;u.setWithCredentials(!0),u.listenOnce(Cp.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Yo.NO_ERROR:const l=u.getResponseJson();v(Ce,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(l)),o(l);break;case Yo.TIMEOUT:v(Ce,`RPC '${e}' ${i} timed out`),a(new _(m.DEADLINE_EXCEEDED,"Request time out"));break;case Yo.HTTP_ERROR:const h=u.getStatus();if(v(Ce,`RPC '${e}' ${i} failed with status:`,h,"response text:",u.getResponseText()),h>0){let d=u.getResponseJson();Array.isArray(d)&&(d=d[0]);const f=null==d?void 0:d.error;if(f&&f.status&&f.message){const y=function(I){const w=I.toLowerCase().replace(/_/g,"-");return Object.values(m).indexOf(w)>=0?w:m.UNKNOWN}(f.status);a(new _(y,f.message))}else a(new _(m.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new _(m.UNAVAILABLE,"Connection failed."));break;default:S()}}finally{v(Ce,`RPC '${e}' ${i} completed.`)}});const c=JSON.stringify(s);v(Ce,`RPC '${e}' ${i} sending request:`,s),u.send(t,"POST",c,r,15)})}Ro(e,t,r){const s=Wa(),i=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Sp(),a=bp(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.xmlHttpFactory=new Dp({})),this.Eo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const l=i.join("");v(Ce,`Creating RPC '${e}' stream ${s}: ${l}`,u);const h=o.createWebChannel(l,u);let d=!1,f=!1;const y=new R_({ro:w=>{f?v(Ce,`Not sending because RPC '${e}' stream ${s} is closed:`,w):(d||(v(Ce,`Opening RPC '${e}' stream ${s} transport.`),h.open(),d=!0),v(Ce,`RPC '${e}' stream ${s} sending:`,w),h.send(w))},oo:()=>h.close()}),I=(w,D,R)=>{w.listen(D,b=>{try{R(b)}catch(F){setTimeout(()=>{throw F},0)}})};return I(h,Ys.EventType.OPEN,()=>{f||v(Ce,`RPC '${e}' stream ${s} transport opened.`)}),I(h,Ys.EventType.CLOSE,()=>{f||(f=!0,v(Ce,`RPC '${e}' stream ${s} transport closed`),y.wo())}),I(h,Ys.EventType.ERROR,w=>{f||(f=!0,je(Ce,`RPC '${e}' stream ${s} transport errored:`,w),y.wo(new _(m.UNAVAILABLE,"The operation could not be completed")))}),I(h,Ys.EventType.MESSAGE,w=>{var D;if(!f){const R=w.data[0];C(!!R);const F=R.error||(null===(D=R[0])||void 0===D?void 0:D.error);if(F){v(Ce,`RPC '${e}' stream ${s} received error:`,F);const G=F.status;let B=function(Be){const or=ue[Be];if(void 0!==or)return od(or)}(G),ce=F.message;void 0===B&&(B=m.INTERNAL,ce="Unknown error status: "+G+" with message "+F.message),f=!0,y.wo(new _(B,ce)),h.close()}else v(Ce,`RPC '${e}' stream ${s} received:`,R),y._o(R)}}),I(a,Ap.STAT_EVENT,w=>{w.stat===Yl.PROXY?v(Ce,`RPC '${e}' stream ${s} detected buffering proxy`):w.stat===Yl.NOPROXY&&v(Ce,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{y.fo()},0),y}}function mf(){return typeof window<"u"?window:null}function Pi(){return typeof document<"u"?document:null}function is(n){return new zy(n,!0)}class Za{constructor(e,t,r=1e3,s=1.5,i=6e4){this.ii=e,this.timerId=t,this.Po=r,this.bo=s,this.Vo=i,this.So=0,this.Do=null,this.Co=Date.now(),this.reset()}reset(){this.So=0}xo(){this.So=this.Vo}No(e){this.cancel();const t=Math.floor(this.So+this.ko()),r=Math.max(0,Date.now()-this.Co),s=Math.max(0,t-r);s>0&&v("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.So} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Do=this.ii.enqueueAfterDelay(this.timerId,s,()=>(this.Co=Date.now(),e())),this.So*=this.bo,this.So<this.Po&&(this.So=this.Po),this.So>this.Vo&&(this.So=this.Vo)}Mo(){null!==this.Do&&(this.Do.skipDelay(),this.Do=null)}cancel(){null!==this.Do&&(this.Do.cancel(),this.Do=null)}ko(){return(Math.random()-.5)*this.So}}class pf{constructor(e,t,r,s,i,o,a,u){this.ii=e,this.$o=r,this.Oo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Fo=0,this.Bo=null,this.Lo=null,this.stream=null,this.qo=new Za(e,t)}Uo(){return 1===this.state||5===this.state||this.Ko()}Ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Go()}stop(){var e=this;return(0,p.Z)(function*(){e.Uo()&&(yield e.close(0))})()}Qo(){this.state=0,this.qo.reset()}jo(){this.Ko()&&null===this.Bo&&(this.Bo=this.ii.enqueueAfterDelay(this.$o,6e4,()=>this.zo()))}Wo(e){this.Ho(),this.stream.send(e)}zo(){var e=this;return(0,p.Z)(function*(){if(e.Ko())return e.close(0)})()}Ho(){this.Bo&&(this.Bo.cancel(),this.Bo=null)}Jo(){this.Lo&&(this.Lo.cancel(),this.Lo=null)}close(e,t){var r=this;return(0,p.Z)(function*(){r.Ho(),r.Jo(),r.qo.cancel(),r.Fo++,4!==e?r.qo.reset():t&&t.code===m.RESOURCE_EXHAUSTED?(ie(t.toString()),ie("Using maximum backoff delay to prevent overloading the backend."),r.qo.xo()):t&&t.code===m.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.Yo(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.ao(t)})()}Yo(){}auth(){this.state=1;const e=this.Xo(this.Fo),t=this.Fo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.Fo===t&&this.Zo(r,s)},r=>{e(()=>{const s=new _(m.UNKNOWN,"Fetching auth token failed: "+r.message);return this.tu(s)})})}Zo(e,t){const r=this.Xo(this.Fo);this.stream=this.eu(e,t),this.stream.uo(()=>{r(()=>(this.state=2,this.Lo=this.ii.enqueueAfterDelay(this.Oo,1e4,()=>(this.Ko()&&(this.state=3),Promise.resolve())),this.listener.uo()))}),this.stream.ao(s=>{r(()=>this.tu(s))}),this.stream.onMessage(s=>{r(()=>this.onMessage(s))})}Go(){var e=this;this.state=5,this.qo.No((0,p.Z)(function*(){e.state=0,e.start()}))}tu(e){return v("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Xo(e){return t=>{this.ii.enqueueAndForget(()=>this.Fo===e?t():(v("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class O_ extends pf{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i}eu(e,t){return this.connection.Ro("Listen",e,t)}onMessage(e){this.qo.reset();const t=function Ky(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(u=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===u?1:"REMOVE"===u?2:"CURRENT"===u?3:"RESET"===u?4:S(),s=e.targetChange.targetIds||[],i=function(u,c){return u.useProto3Json?(C(void 0===c||"string"==typeof c),he.fromBase64String(c||"")):(C(void 0===c||c instanceof Uint8Array),he.fromUint8Array(c||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const c=void 0===u.code?m.UNKNOWN:od(u.code);return new _(c,u.message||"")}(o);t=new hd(r,s,i,a||null)}else if("documentChange"in e){const r=e.documentChange,s=nt(n,r.document.name),i=oe(r.document.updateTime),o=r.document.createTime?oe(r.document.createTime):A.min(),a=new Ie({mapValue:{fields:r.document.fields}}),u=Z.newFoundDocument(s,i,o,a);t=new yi(r.targetIds||[],r.removedTargetIds||[],u.key,u)}else if("documentDelete"in e){const r=e.documentDelete,s=nt(n,r.document),i=r.readTime?oe(r.readTime):A.min(),o=Z.newNoDocument(s,i);t=new yi([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,s=nt(n,r.document);t=new yi([],r.removedTargetIds||[],s,null)}else{if(!("filter"in e))return S();{const r=e.filter,{count:s=0,unchangedNames:i}=r,o=new Ly(s,i);t=new ld(r.targetId,o)}}var u;return t}(this.serializer,e),r=function(s){if(!("targetChange"in s))return A.min();const i=s.targetChange;return i.targetIds&&i.targetIds.length?A.min():i.readTime?oe(i.readTime):A.min()}(e);return this.listener.nu(t,r)}su(e){const t={};t.database=Wr(this.serializer),t.addTarget=function(s,i){let o;const a=i.target;if(o=ci(a)?{documents:Id(s,a)}:{query:Ca(s,a)},o.targetId=i.targetId,i.resumeToken.approximateByteSize()>0){o.resumeToken=md(s,i.resumeToken);const u=xa(s,i.expectedCount);null!==u&&(o.expectedCount=u)}else if(i.snapshotVersion.compareTo(A.min())>0){o.readTime=Vn(s,i.snapshotVersion.toTimestamp());const u=xa(s,i.expectedCount);null!==u&&(o.expectedCount=u)}return o}(this.serializer,e);const r=function Hy(n,e){const t=function(r){switch(r){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return S()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.Wo(t)}iu(e){const t={};t.database=Wr(this.serializer),t.removeTarget=e,this.Wo(t)}}class F_ extends pf{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.serializer=i,this.ru=!1}get ou(){return this.ru}start(){this.ru=!1,this.lastStreamToken=void 0,super.start()}Yo(){this.ru&&this.uu([])}eu(e,t){return this.connection.Ro("Write",e,t)}onMessage(e){if(C(!!e.streamToken),this.lastStreamToken=e.streamToken,this.ru){this.qo.reset();const t=function Qy(n,e){return n&&n.length>0?(C(void 0!==e),n.map(t=>function(r,s){let i=oe(r.updateTime?r.updateTime:s);return i.isEqual(A.min())&&(i=oe(s)),new Py(i,r.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=oe(e.commitTime);return this.listener.cu(r,t)}return C(!e.writeResults||0===e.writeResults.length),this.ru=!0,this.listener.au()}hu(){const e={};e.database=Wr(this.serializer),this.Wo(e)}uu(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Zr(this.serializer,r))};this.Wo(t)}}class M_ extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.lu=!1}fu(){if(this.lu)throw new _(m.FAILED_PRECONDITION,"The client has already been terminated.")}Io(e,t,r){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.connection.Io(e,t,r,s,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new _(m.UNKNOWN,s.toString())})}vo(e,t,r,s){return this.fu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.vo(e,t,r,i,o,s)).catch(i=>{throw"FirebaseError"===i.name?(i.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new _(m.UNKNOWN,i.toString())})}terminate(){this.lu=!0}}class U_{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.wu=0,this._u=null,this.mu=!0}gu(){0===this.wu&&(this.yu("Unknown"),this._u=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._u=null,this.pu("Backend didn't respond within 10 seconds."),this.yu("Offline"),Promise.resolve())))}Iu(e){"Online"===this.state?this.yu("Unknown"):(this.wu++,this.wu>=1&&(this.Tu(),this.pu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.yu("Offline")))}set(e){this.Tu(),this.wu=0,"Online"===e&&(this.mu=!1),this.yu(e)}yu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}pu(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.mu?(ie(t),this.mu=!1):v("OnlineStateTracker",t)}Tu(){null!==this._u&&(this._u.cancel(),this._u=null)}}class V_{constructor(e,t,r,s,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Eu=[],this.Au=new Map,this.vu=new Set,this.Ru=[],this.Pu=i,this.Pu.Yr(a=>{r.enqueueAndForget((0,p.Z)(function*(){var u;Vt(o)&&(v("RemoteStore","Restarting streams for network reachability change."),yield(u=(0,p.Z)(function*(c){const l=x(c);l.vu.add(4),yield $n(l),l.bu.set("Unknown"),l.vu.delete(4),yield os(l)}),function(c){return u.apply(this,arguments)})(o))}))}),this.bu=new U_(r,s)}}function os(n){return Ya.apply(this,arguments)}function Ya(){return Ya=(0,p.Z)(function*(n){if(Vt(n))for(const e of n.Ru)yield e(!0)}),Ya.apply(this,arguments)}function $n(n){return Ja.apply(this,arguments)}function Ja(){return Ja=(0,p.Z)(function*(n){for(const e of n.Ru)yield e(!1)}),Ja.apply(this,arguments)}function Oi(n,e){const t=x(n);t.Au.has(e.targetId)||(t.Au.set(e.targetId,e),nu(t)?tu(t):Qn(t).Ko()&&eu(t,e))}function as(n,e){const t=x(n),r=Qn(t);t.Au.delete(e),r.Ko()&&yf(t,e),0===t.Au.size&&(r.Ko()?r.jo():Vt(t)&&t.bu.set("Unknown"))}function eu(n,e){if(n.Vu.qt(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(A.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Qn(n).su(e)}function yf(n,e){n.Vu.qt(e),Qn(n).iu(e)}function tu(n){n.Vu=new Vy({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),le:e=>n.Au.get(e)||null,ue:()=>n.datastore.serializer.databaseId}),Qn(n).start(),n.bu.gu()}function nu(n){return Vt(n)&&!Qn(n).Uo()&&n.Au.size>0}function Vt(n){return 0===x(n).vu.size}function _f(n){n.Vu=void 0}function q_(n){return ru.apply(this,arguments)}function ru(){return ru=(0,p.Z)(function*(n){n.Au.forEach((e,t)=>{eu(n,e)})}),ru.apply(this,arguments)}function B_(n,e){return su.apply(this,arguments)}function su(){return su=(0,p.Z)(function*(n,e){_f(n),nu(n)?(n.bu.Iu(e),tu(n)):n.bu.set("Unknown")}),su.apply(this,arguments)}function G_(n,e,t){return iu.apply(this,arguments)}function iu(){return iu=(0,p.Z)(function*(n,e,t){if(n.bu.set("Online"),e instanceof hd&&2===e.state&&e.cause)try{yield(r=(0,p.Z)(function*(s,i){const o=i.cause;for(const a of i.targetIds)s.Au.has(a)&&(yield s.remoteSyncer.rejectListen(a,o),s.Au.delete(a),s.Vu.removeTarget(a))}),function(s,i){return r.apply(this,arguments)})(n,e)}catch(r){v("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Fi(n,r)}else if(e instanceof yi?n.Vu.Ht(e):e instanceof ld?n.Vu.ne(e):n.Vu.Xt(e),!t.isEqual(A.min()))try{const r=yield sf(n.localStore);t.compareTo(r)>=0&&(yield function(s,i){const o=s.Vu.ce(i);return o.targetChanges.forEach((a,u)=>{if(a.resumeToken.approximateByteSize()>0){const c=s.Au.get(u);c&&s.Au.set(u,c.withResumeToken(a.resumeToken,i))}}),o.targetMismatches.forEach((a,u)=>{const c=s.Au.get(a);if(!c)return;s.Au.set(a,c.withResumeToken(he.EMPTY_BYTE_STRING,c.snapshotVersion)),yf(s,a);const l=new gt(c.target,a,u,c.sequenceNumber);eu(s,l)}),s.remoteSyncer.applyRemoteEvent(o)}(n,t))}catch(r){v("RemoteStore","Failed to raise snapshot:",r),yield Fi(n,r)}var r}),iu.apply(this,arguments)}function Fi(n,e,t){return ou.apply(this,arguments)}function ou(){return ou=(0,p.Z)(function*(n,e,t){if(!Ct(e))throw e;n.vu.add(1),yield $n(n),n.bu.set("Offline"),t||(t=()=>sf(n.localStore)),n.asyncQueue.enqueueRetryable((0,p.Z)(function*(){v("RemoteStore","Retrying IndexedDB access"),yield t(),n.vu.delete(1),yield os(n)}))}),ou.apply(this,arguments)}function vf(n,e){return e().catch(t=>Fi(n,t,e))}function Kn(n){return au.apply(this,arguments)}function au(){return au=(0,p.Z)(function*(n){const e=x(n),t=qt(e);let r=e.Eu.length>0?e.Eu[e.Eu.length-1].batchId:-1;for(;z_(e);)try{const s=yield C_(e.localStore,r);if(null===s){0===e.Eu.length&&t.jo();break}r=s.batchId,j_(e,s)}catch(s){yield Fi(e,s)}wf(e)&&If(e)}),au.apply(this,arguments)}function z_(n){return Vt(n)&&n.Eu.length<10}function j_(n,e){n.Eu.push(e);const t=qt(n);t.Ko()&&t.ou&&t.uu(e.mutations)}function wf(n){return Vt(n)&&!qt(n).Uo()&&n.Eu.length>0}function If(n){qt(n).start()}function $_(n){return uu.apply(this,arguments)}function uu(){return uu=(0,p.Z)(function*(n){qt(n).hu()}),uu.apply(this,arguments)}function K_(n){return cu.apply(this,arguments)}function cu(){return cu=(0,p.Z)(function*(n){const e=qt(n);for(const t of n.Eu)e.uu(t.mutations)}),cu.apply(this,arguments)}function Q_(n,e,t){return lu.apply(this,arguments)}function lu(){return lu=(0,p.Z)(function*(n,e,t){const r=n.Eu.shift(),s=va.from(r,e,t);yield vf(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),yield Kn(n)}),lu.apply(this,arguments)}function H_(n,e){return hu.apply(this,arguments)}function hu(){return hu=(0,p.Z)(function*(n,e){var t;e&&qt(n).ou&&(yield(t=(0,p.Z)(function*(r,s){if(id(i=s.code)&&i!==m.ABORTED){const o=r.Eu.shift();qt(r).Qo(),yield vf(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield Kn(r)}var i}),function(r,s){return t.apply(this,arguments)})(n,e)),wf(n)&&If(n)}),hu.apply(this,arguments)}function Tf(n,e){return du.apply(this,arguments)}function du(){return du=(0,p.Z)(function*(n,e){const t=x(n);t.asyncQueue.verifyOperationInProgress(),v("RemoteStore","RemoteStore received new credentials");const r=Vt(t);t.vu.add(3),yield $n(t),r&&t.bu.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.vu.delete(3),yield os(t)}),du.apply(this,arguments)}function fu(n,e){return gu.apply(this,arguments)}function gu(){return gu=(0,p.Z)(function*(n,e){const t=x(n);e?(t.vu.delete(2),yield os(t)):e||(t.vu.add(2),yield $n(t),t.bu.set("Unknown"))}),gu.apply(this,arguments)}function Qn(n){return n.Su||(n.Su=function(e,t,r){const s=x(e);return s.fu(),new O_(t,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{uo:q_.bind(null,n),ao:B_.bind(null,n),nu:G_.bind(null,n)}),n.Ru.push(function(){var e=(0,p.Z)(function*(t){t?(n.Su.Qo(),nu(n)?tu(n):n.bu.set("Unknown")):(yield n.Su.stop(),_f(n))});return function(t){return e.apply(this,arguments)}}())),n.Su}function qt(n){return n.Du||(n.Du=function(e,t,r){const s=x(e);return s.fu(),new F_(t,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,r)}(n.datastore,n.asyncQueue,{uo:$_.bind(null,n),ao:H_.bind(null,n),au:K_.bind(null,n),cu:Q_.bind(null,n)}),n.Ru.push(function(){var e=(0,p.Z)(function*(t){t?(n.Du.Qo(),yield Kn(n)):(yield n.Du.stop(),n.Eu.length>0&&(v("RemoteStore",`Stopping write stream with ${n.Eu.length} pending writes`),n.Eu=[]))});return function(t){return e.apply(this,arguments)}}())),n.Du}class mu{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new le,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new mu(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new _(m.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Hn(n,e){if(ie("AsyncQueue",`${e}: ${n}`),Ct(n))return new _(m.UNAVAILABLE,`${e}: ${n}`);throw n}class Wn{constructor(e){this.comparator=e?(t,r)=>e(t,r)||T.comparator(t.key,r.key):(t,r)=>T.comparator(t.key,r.key),this.keyedMap=Br(),this.sortedSet=new K(this.comparator)}static emptySet(e){return new Wn(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Wn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new Wn;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class xf{constructor(){this.Cu=new K(T.comparator)}track(e){const t=e.doc.key,r=this.Cu.get(t);r?0!==e.type&&3===r.type?this.Cu=this.Cu.insert(t,e):3===e.type&&1!==r.type?this.Cu=this.Cu.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.Cu=this.Cu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.Cu=this.Cu.remove(t):1===e.type&&2===r.type?this.Cu=this.Cu.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.Cu=this.Cu.insert(t,{type:2,doc:e.doc}):S():this.Cu=this.Cu.insert(t,e)}xu(){const e=[];return this.Cu.inorderTraversal((t,r)=>{e.push(r)}),e}}class Zn{constructor(e,t,r,s,i,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Zn(e,t,Wn.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Vr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class W_{constructor(){this.Nu=void 0,this.listeners=[]}}class Z_{constructor(){this.queries=new dt(e=>qh(e),Vr),this.onlineState="Unknown",this.ku=new Set}}function pu(n,e){return yu.apply(this,arguments)}function yu(){return yu=(0,p.Z)(function*(n,e){const t=x(n),r=e.query;let s=!1,i=t.queries.get(r);if(i||(s=!0,i=new W_),s)try{i.Nu=yield t.onListen(r)}catch(o){const a=Hn(o,`Initialization of query '${ma(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,i),i.listeners.push(e),e.Mu(t.onlineState),i.Nu&&e.$u(i.Nu)&&wu(t)}),yu.apply(this,arguments)}function _u(n,e){return vu.apply(this,arguments)}function vu(){return vu=(0,p.Z)(function*(n,e){const t=x(n),r=e.query;let s=!1;const i=t.queries.get(r);if(i){const o=i.listeners.indexOf(e);o>=0&&(i.listeners.splice(o,1),s=0===i.listeners.length)}if(s)return t.queries.delete(r),t.onUnlisten(r)}),vu.apply(this,arguments)}function X_(n,e){const t=x(n);let r=!1;for(const s of e){const o=t.queries.get(s.query);if(o){for(const a of o.listeners)a.$u(s)&&(r=!0);o.Nu=s}}r&&wu(t)}function Y_(n,e,t){const r=x(n),s=r.queries.get(e);if(s)for(const i of s.listeners)i.onError(t);r.queries.delete(e)}function wu(n){n.ku.forEach(e=>{e.next()})}class Iu{constructor(e,t,r){this.query=e,this.Ou=t,this.Fu=!1,this.Bu=null,this.onlineState="Unknown",this.options=r||{}}$u(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)3!==s.type&&r.push(s);e=new Zn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Fu?this.Lu(e)&&(this.Ou.next(e),t=!0):this.qu(e,this.onlineState)&&(this.Uu(e),t=!0),this.Bu=e,t}onError(e){this.Ou.error(e)}Mu(e){this.onlineState=e;let t=!1;return this.Bu&&!this.Fu&&this.qu(this.Bu,e)&&(this.Uu(this.Bu),t=!0),t}qu(e,t){return!e.fromCache||(!this.options.Ku||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Lu(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Bu&&this.Bu.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}Uu(e){e=Zn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Fu=!0,this.Ou.next(e)}}class J_{constructor(e,t){this.Gu=e,this.byteLength=t}Qu(){return"metadata"in this.Gu}}class Ef{constructor(e){this.serializer=e}rr(e){return nt(this.serializer,e)}ur(e){return e.metadata.exists?wd(this.serializer,e.document,!1):Z.newNoDocument(this.rr(e.metadata.name),this.cr(e.metadata.readTime))}cr(e){return oe(e)}}class ev{constructor(e,t,r){this.ju=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Sf(e)}zu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Gu.namedQuery)this.queries.push(e.Gu.namedQuery);else if(e.Gu.documentMetadata){this.documents.push({metadata:e.Gu.documentMetadata}),e.Gu.documentMetadata.exists||++t;const r=V.fromString(e.Gu.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.Gu.document&&(this.documents[this.documents.length-1].document=e.Gu.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Wu(e){const t=new Map,r=new Ef(this.serializer);for(const s of e)if(s.metadata.queries){const i=r.rr(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||O()).add(i);t.set(o,a)}}return t}complete(){var e=this;return(0,p.Z)(function*(){const t=yield function A_(n,e,t,r){return za.apply(this,arguments)}(e.localStore,new Ef(e.serializer),e.documents,e.ju.id),r=e.Wu(e.documents);for(const s of e.queries)yield D_(e.localStore,s,r.get(s.name));return e.progress.taskState="Success",{progress:e.progress,Hu:e.collectionGroups,Ju:t}})()}}function Sf(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class bf{constructor(e){this.key=e}}class Cf{constructor(e){this.key=e}}class Af{constructor(e,t){this.query=e,this.Yu=t,this.Xu=null,this.hasCachedResults=!1,this.current=!1,this.Zu=O(),this.mutatedKeys=O(),this.tc=Gh(e),this.ec=new Wn(this.tc)}get nc(){return this.Yu}sc(e,t){const r=t?t.ic:new xf,s=t?t.ec:this.ec;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const u="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,c="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((l,h)=>{const d=s.get(l),f=qr(this.query,h)?h:null,y=!!d&&this.mutatedKeys.has(d.key),I=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations);let w=!1;d&&f?d.data.isEqual(f.data)?y!==I&&(r.track({type:3,doc:f}),w=!0):this.rc(d,f)||(r.track({type:2,doc:f}),w=!0,(u&&this.tc(f,u)>0||c&&this.tc(f,c)<0)&&(a=!0)):!d&&f?(r.track({type:0,doc:f}),w=!0):d&&!f&&(r.track({type:1,doc:d}),w=!0,(u||c)&&(a=!0)),w&&(f?(o=o.add(f),i=I?i.add(l):i.delete(l)):(o=o.delete(l),i=i.delete(l)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const l="F"===this.query.limitType?o.last():o.first();o=o.delete(l.key),i=i.delete(l.key),r.track({type:1,doc:l})}return{ec:o,ic:r,zi:a,mutatedKeys:i}}rc(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const s=this.ec;this.ec=e.ec,this.mutatedKeys=e.mutatedKeys;const i=e.ic.xu();i.sort((c,l)=>function(h,d){const f=y=>{switch(y){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return S()}};return f(h)-f(d)}(c.type,l.type)||this.tc(c.doc,l.doc)),this.oc(r);const o=t?this.uc():[],a=0===this.Zu.size&&this.current?1:0,u=a!==this.Xu;return this.Xu=a,0!==i.length||u?{snapshot:new Zn(this.query,e.ec,s,i,e.mutatedKeys,0===a,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),cc:o}:{cc:o}}Mu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({ec:this.ec,ic:new xf,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{cc:[]}}ac(e){return!this.Yu.has(e)&&!!this.ec.has(e)&&!this.ec.get(e).hasLocalMutations}oc(e){e&&(e.addedDocuments.forEach(t=>this.Yu=this.Yu.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Yu=this.Yu.delete(t)),this.current=e.current)}uc(){if(!this.current)return[];const e=this.Zu;this.Zu=O(),this.ec.forEach(r=>{this.ac(r.key)&&(this.Zu=this.Zu.add(r.key))});const t=[];return e.forEach(r=>{this.Zu.has(r)||t.push(new Cf(r))}),this.Zu.forEach(r=>{e.has(r)||t.push(new bf(r))}),t}hc(e){this.Yu=e.ir,this.Zu=O();const t=this.sc(e.documents);return this.applyChanges(t,!0)}lc(){return Zn.fromInitialDocuments(this.query,this.ec,this.mutatedKeys,0===this.Xu,this.hasCachedResults)}}class tv{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class nv{constructor(e){this.key=e,this.fc=!1}}class rv{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.dc={},this.wc=new dt(a=>qh(a),Vr),this._c=new Map,this.mc=new Set,this.gc=new K(T.comparator),this.yc=new Map,this.Ic=new Fa,this.Tc={},this.Ec=new Map,this.Ac=hn.Mn(),this.onlineState="Unknown",this.vc=void 0}get isPrimaryClient(){return!0===this.vc}}function sv(n,e){return Tu.apply(this,arguments)}function Tu(){return Tu=(0,p.Z)(function*(n,e){const t=$u(n);let r,s;const i=t.wc.get(e);if(i)r=i.targetId,t.sharedClientState.addLocalQueryTarget(r),s=i.view.lc();else{const o=yield zn(t.localStore,ke(e)),a=t.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,s=yield xu(t,e,r,"current"===a,o.resumeToken),t.isPrimaryClient&&Oi(t.remoteStore,o)}return s}),Tu.apply(this,arguments)}function xu(n,e,t,r,s){return Eu.apply(this,arguments)}function Eu(){return Eu=(0,p.Z)(function*(n,e,t,r,s){n.Rc=(h,d,f)=>{return(y=(0,p.Z)(function*(I,w,D,R){let b=w.view.sc(D);b.zi&&(b=yield Di(I.localStore,w.query,!1).then(({documents:B})=>w.view.sc(B,b)));const F=R&&R.targetChanges.get(w.targetId),G=w.view.applyChanges(b,I.isPrimaryClient,F);return Ou(I,w.targetId,G.cc),G.snapshot}),function(I,w,D,R){return y.apply(this,arguments)})(n,h,d,f);var y};const i=yield Di(n.localStore,e,!0),o=new Af(e,i.ir),a=o.sc(i.documents),u=Qr.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,s),c=o.applyChanges(a,n.isPrimaryClient,u);Ou(n,t,c.cc);const l=new tv(e,t,o);return n.wc.set(e,l),n._c.has(t)?n._c.get(t).push(e):n._c.set(t,[e]),c.snapshot}),Eu.apply(this,arguments)}function iv(n,e){return Su.apply(this,arguments)}function Su(){return Su=(0,p.Z)(function*(n,e){const t=x(n),r=t.wc.get(e),s=t._c.get(r.targetId);if(s.length>1)return t._c.set(r.targetId,s.filter(i=>!Vr(i,e))),void t.wc.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield jn(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),as(t.remoteStore,r.targetId),Xn(t,r.targetId)}).catch(bt))):(Xn(t,r.targetId),yield jn(t.localStore,r.targetId,!0))}),Su.apply(this,arguments)}function bu(){return bu=(0,p.Z)(function*(n,e,t){const r=Ku(n);try{const s=yield function(i,o){const a=x(i),u=J.now(),c=o.reduce((d,f)=>d.add(f.key),O());let l,h;return a.persistence.runTransaction("Locally write mutations","readwrite",d=>{let f=Me(),y=O();return a.Zi.getEntries(d,c).next(I=>{f=I,f.forEach((w,D)=>{D.isValidDocument()||(y=y.add(w))})}).next(()=>a.localDocuments.getOverlayedDocuments(d,f)).next(I=>{l=I;const w=[];for(const D of o){const R=Fy(D,l.get(D.key).overlayedDocument);null!=R&&w.push(new ft(D.key,R,bh(R.value.mapValue),ee.exists(!0)))}return a.mutationQueue.addMutationBatch(d,u,w,o)}).next(I=>{h=I;const w=I.applyToLocalDocumentSet(l,y);return a.documentOverlayCache.saveOverlays(d,I.batchId,w)})}).then(()=>({batchId:h.batchId,changes:jh(l)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(i,o,a){let u=i.Tc[i.currentUser.toKey()];u||(u=new K(k)),u=u.insert(o,a),i.Tc[i.currentUser.toKey()]=u}(r,s.batchId,t),yield mt(r,s.changes),yield Kn(r.remoteStore)}catch(s){const i=Hn(s,"Failed to persist write");t.reject(i)}}),bu.apply(this,arguments)}function Df(n,e){return Cu.apply(this,arguments)}function Cu(){return Cu=(0,p.Z)(function*(n,e){const t=x(n);try{const r=yield function b_(n,e){const t=x(n),r=e.snapshotVersion;let s=t.Ji;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Zi.newChangeBuffer({trackRemovals:!0});s=t.Ji;const a=[];e.targetChanges.forEach((l,h)=>{const d=s.get(h);if(!d)return;a.push(t.Bs.removeMatchingKeys(i,l.removedDocuments,h).next(()=>t.Bs.addMatchingKeys(i,l.addedDocuments,h)));let f=d.withSequenceNumber(i.currentSequenceNumber);var y,I,w;null!==e.targetMismatches.get(h)?f=f.withResumeToken(he.EMPTY_BYTE_STRING,A.min()).withLastLimboFreeSnapshotVersion(A.min()):l.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(l.resumeToken,r)),s=s.insert(h,f),I=f,w=l,(0===(y=d).resumeToken.approximateByteSize()||I.snapshotVersion.toMicroseconds()-y.snapshotVersion.toMicroseconds()>=3e8||w.addedDocuments.size+w.modifiedDocuments.size+w.removedDocuments.size>0)&&a.push(t.Bs.updateTargetData(i,f))});let u=Me(),c=O();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,l))}),a.push(af(i,o,e.documentUpdates).next(l=>{u=l.nr,c=l.sr})),!r.isEqual(A.min())){const l=t.Bs.getLastRemoteSnapshotVersion(i).next(h=>t.Bs.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(l)}return g.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,u,c)).next(()=>u)}).then(i=>(t.Ji=s,i))}(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.yc.get(i);o&&(C(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.fc=!0:s.modifiedDocuments.size>0?C(o.fc):s.removedDocuments.size>0&&(C(o.fc),o.fc=!1))}),yield mt(t,r,e)}catch(r){yield bt(r)}}),Cu.apply(this,arguments)}function kf(n,e,t){const r=x(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const s=[];r.wc.forEach((i,o)=>{const a=o.view.Mu(e);a.snapshot&&s.push(a.snapshot)}),function(i,o){const a=x(i);a.onlineState=o;let u=!1;a.queries.forEach((c,l)=>{for(const h of l.listeners)h.Mu(o)&&(u=!0)}),u&&wu(a)}(r.eventManager,e),s.length&&r.dc.nu(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function av(n,e,t){return Au.apply(this,arguments)}function Au(){return Au=(0,p.Z)(function*(n,e,t){const r=x(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.yc.get(e),i=s&&s.key;if(i){let o=new K(T.comparator);o=o.insert(i,Z.newNoDocument(i,A.min()));const a=O().add(i),u=new Kr(A.min(),new Map,new K(k),o,a);yield Df(r,u),r.gc=r.gc.remove(i),r.yc.delete(e),Fu(r)}else yield jn(r.localStore,e,!1).then(()=>Xn(r,e,t)).catch(bt)}),Au.apply(this,arguments)}function uv(n,e){return Du.apply(this,arguments)}function Du(){return Du=(0,p.Z)(function*(n,e){const t=x(n),r=e.batch.batchId;try{const s=yield function S_(n,e){const t=x(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.Zi.newChangeBuffer({trackRemovals:!0});return function(o,a,u,c){const l=u.batch,h=l.keys();let d=g.resolve();return h.forEach(f=>{d=d.next(()=>c.getEntry(a,f)).next(y=>{const I=u.docVersions.get(f);C(null!==I),y.version.compareTo(I)<0&&(l.applyToRemoteDocument(y,u),y.isValidDocument()&&(y.setReadTime(u.commitVersion),c.addEntry(y)))})}),d.next(()=>o.mutationQueue.removeMutationBatch(a,l))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(o){let a=O();for(let u=0;u<o.mutationResults.length;++u)o.mutationResults[u].transformResults.length>0&&(a=a.add(o.batch.mutations[u].key));return a}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}(t.localStore,e);Pu(t,r,null),Ru(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield mt(t,s)}catch(s){yield bt(s)}}),Du.apply(this,arguments)}function cv(n,e,t){return ku.apply(this,arguments)}function ku(){return ku=(0,p.Z)(function*(n,e,t){const r=x(n);try{const s=yield function(i,o){const a=x(i);return a.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let c;return a.mutationQueue.lookupMutationBatch(u,o).next(l=>(C(null!==l),c=l.keys(),a.mutationQueue.removeMutationBatch(u,l))).next(()=>a.mutationQueue.performConsistencyCheck(u)).next(()=>a.documentOverlayCache.removeOverlaysForBatchId(u,c,o)).next(()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,c)).next(()=>a.localDocuments.getDocuments(u,c))})}(r.localStore,e);Pu(r,e,t),Ru(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield mt(r,s)}catch(s){yield bt(s)}}),ku.apply(this,arguments)}function Nu(){return Nu=(0,p.Z)(function*(n,e){const t=x(n);Vt(t.remoteStore)||v("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(i){const o=x(i);return o.persistence.runTransaction("Get highest unacknowledged batch id","readonly",a=>o.mutationQueue.getHighestUnacknowledgedBatchId(a))}(t.localStore);if(-1===r)return void e.resolve();const s=t.Ec.get(r)||[];s.push(e),t.Ec.set(r,s)}catch(r){const s=Hn(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}),Nu.apply(this,arguments)}function Ru(n,e){(n.Ec.get(e)||[]).forEach(t=>{t.resolve()}),n.Ec.delete(e)}function Pu(n,e,t){const r=x(n);let s=r.Tc[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Tc[r.currentUser.toKey()]=s}}function Xn(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n._c.get(e))n.wc.delete(r),t&&n.dc.Pc(r,t);n._c.delete(e),n.isPrimaryClient&&n.Ic.Is(e).forEach(r=>{n.Ic.containsKey(r)||Nf(n,r)})}function Nf(n,e){n.mc.delete(e.path.canonicalString());const t=n.gc.get(e);null!==t&&(as(n.remoteStore,t),n.gc=n.gc.remove(e),n.yc.delete(t),Fu(n))}function Ou(n,e,t){for(const r of t)r instanceof bf?(n.Ic.addReference(r.key,e),hv(n,r)):r instanceof Cf?(v("SyncEngine","Document no longer in limbo: "+r.key),n.Ic.removeReference(r.key,e),n.Ic.containsKey(r.key)||Nf(n,r.key)):S()}function hv(n,e){const t=e.key,r=t.path.canonicalString();n.gc.get(t)||n.mc.has(r)||(v("SyncEngine","New document in limbo: "+t),n.mc.add(r),Fu(n))}function Fu(n){for(;n.mc.size>0&&n.gc.size<n.maxConcurrentLimboResolutions;){const e=n.mc.values().next().value;n.mc.delete(e);const t=new T(V.fromString(e)),r=n.Ac.next();n.yc.set(r,new nv(t)),n.gc=n.gc.insert(t,r),Oi(n.remoteStore,new gt(ke(On(t.path)),r,"TargetPurposeLimboResolution",Ve.ct))}}function mt(n,e,t){return Mu.apply(this,arguments)}function Mu(){return Mu=(0,p.Z)(function*(n,e,t){const r=x(n),s=[],i=[],o=[];var a;r.wc.isEmpty()||(r.wc.forEach((a,u)=>{o.push(r.Rc(u,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,null!=c&&c.fromCache?"not-current":"current"),c){s.push(c);const l=qa.Li(u.targetId,c);i.push(l)}}))}),yield Promise.all(o),r.dc.nu(s),yield(a=(0,p.Z)(function*(u,c){const l=x(u);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>g.forEach(c,d=>g.forEach(d.Fi,f=>l.persistence.referenceDelegate.addReference(h,d.targetId,f)).next(()=>g.forEach(d.Bi,f=>l.persistence.referenceDelegate.removeReference(h,d.targetId,f)))))}catch(h){if(!Ct(h))throw h;v("LocalStore","Failed to update sequence numbers: "+h)}for(const h of c){const d=h.targetId;if(!h.fromCache){const f=l.Ji.get(d),I=f.withLastLimboFreeSnapshotVersion(f.snapshotVersion);l.Ji=l.Ji.insert(d,I)}}}),function(u,c){return a.apply(this,arguments)})(r.localStore,i))}),Mu.apply(this,arguments)}function dv(n,e){return Lu.apply(this,arguments)}function Lu(){return Lu=(0,p.Z)(function*(n,e){const t=x(n);if(!t.currentUser.isEqual(e)){v("SyncEngine","User change. New user:",e.toKey());const r=yield rf(t.localStore,e);t.currentUser=e,(s=t).Ec.forEach(o=>{o.forEach(a=>{a.reject(new _(m.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.Ec.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield mt(t,r.er)}var s}),Lu.apply(this,arguments)}function fv(n,e){const t=x(n),r=t.yc.get(e);if(r&&r.fc)return O().add(r.key);{let s=O();const i=t._c.get(e);if(!i)return s;for(const o of i){const a=t.wc.get(o);s=s.unionWith(a.view.nc)}return s}}function gv(n,e){return Uu.apply(this,arguments)}function Uu(){return Uu=(0,p.Z)(function*(n,e){const t=x(n),r=yield Di(t.localStore,e.query,!0),s=e.view.hc(r);return t.isPrimaryClient&&Ou(t,e.targetId,s.cc),s}),Uu.apply(this,arguments)}function mv(n,e){return Vu.apply(this,arguments)}function Vu(){return Vu=(0,p.Z)(function*(n,e){const t=x(n);return cf(t.localStore,e).then(r=>mt(t,r))}),Vu.apply(this,arguments)}function pv(n,e,t,r){return qu.apply(this,arguments)}function qu(){return qu=(0,p.Z)(function*(n,e,t,r){const s=x(n),i=yield function(o,a){const u=x(o),c=x(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",l=>c.Sn(l,a).next(h=>h?u.localDocuments.getDocuments(l,h):g.resolve(null)))}(s.localStore,e);var a;null!==i?("pending"===t?yield Kn(s.remoteStore):"acknowledged"===t||"rejected"===t?(Pu(s,e,r||null),Ru(s,e),a=e,x(x(s.localStore).mutationQueue).Cn(a)):S(),yield mt(s,i)):v("SyncEngine","Cannot apply mutation batch with id: "+e)}),qu.apply(this,arguments)}function Bu(){return Bu=(0,p.Z)(function*(n,e){const t=x(n);if($u(t),Ku(t),!0===e&&!0!==t.vc){const r=t.sharedClientState.getAllActiveQueryTargets(),s=yield Rf(t,r.toArray());t.vc=!0,yield fu(t.remoteStore,!0);for(const i of s)Oi(t.remoteStore,i)}else if(!1===e&&!1!==t.vc){const r=[];let s=Promise.resolve();t._c.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(Xn(t,o),jn(t.localStore,o,!0))),as(t.remoteStore,o)}),yield s,yield Rf(t,r),function(i){const o=x(i);o.yc.forEach((a,u)=>{as(o.remoteStore,u)}),o.Ic.Ts(),o.yc=new Map,o.gc=new K(T.comparator)}(t),t.vc=!1,yield fu(t.remoteStore,!1)}}),Bu.apply(this,arguments)}function Rf(n,e,t){return Gu.apply(this,arguments)}function Gu(){return Gu=(0,p.Z)(function*(n,e,t){const r=x(n),s=[],i=[];for(const o of e){let a;const u=r._c.get(o);if(u&&0!==u.length){a=yield zn(r.localStore,ke(u[0]));for(const c of u){const l=r.wc.get(c),h=yield gv(r,l);h.snapshot&&i.push(h.snapshot)}}else{const c=yield uf(r.localStore,o);a=yield zn(r.localStore,c),yield xu(r,Pf(c),o,!1,a.resumeToken)}s.push(a)}return r.dc.nu(i),s}),Gu.apply(this,arguments)}function Pf(n){return Uh(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function _v(n){const e=x(n);return x(x(e.localStore).persistence).$i()}function vv(n,e,t,r){return zu.apply(this,arguments)}function zu(){return zu=(0,p.Z)(function*(n,e,t,r){const s=x(n);if(s.vc)return void v("SyncEngine","Ignoring unexpected query state notification.");const i=s._c.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=yield cf(s.localStore,Bh(i[0])),a=Kr.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,he.EMPTY_BYTE_STRING);yield mt(s,o,a);break}case"rejected":yield jn(s.localStore,e,!0),Xn(s,e,r);break;default:S()}}),zu.apply(this,arguments)}function wv(n,e,t){return ju.apply(this,arguments)}function ju(){return ju=(0,p.Z)(function*(n,e,t){const r=$u(n);if(r.vc){for(const s of e){if(r._c.has(s)){v("SyncEngine","Adding an already active target "+s);continue}const i=yield uf(r.localStore,s),o=yield zn(r.localStore,i);yield xu(r,Pf(i),o.targetId,!1,o.resumeToken),Oi(r.remoteStore,o)}for(const s of t)r._c.has(s)&&(yield jn(r.localStore,s,!1).then(()=>{as(r.remoteStore,s),Xn(r,s)}).catch(bt))}}),ju.apply(this,arguments)}function $u(n){const e=x(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Df.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=fv.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=av.bind(null,e),e.dc.nu=X_.bind(null,e.eventManager),e.dc.Pc=Y_.bind(null,e.eventManager),e}function Ku(n){const e=x(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=uv.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=cv.bind(null,e),e}class us{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,p.Z)(function*(){t.serializer=is(e.databaseInfo.databaseId),t.sharedClientState=t.createSharedClientState(e),t.persistence=t.createPersistence(e),yield t.persistence.start(),t.localStore=t.createLocalStore(e),t.gcScheduler=t.createGarbageCollectionScheduler(e,t.localStore),t.indexBackfillerScheduler=t.createIndexBackfillerScheduler(e,t.localStore)})()}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return nf(this.persistence,new tf,e.initialUser,this.serializer)}createPersistence(e){return new Ma(bi.zs,this.serializer)}createSharedClientState(e){return new ff}terminate(){var e=this;return(0,p.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Qu extends us{constructor(e,t,r){super(),this.Vc=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,p.Z)(function*(){yield t().call(r,e),yield r.Vc.initialize(r,e),yield Ku(r.Vc.syncEngine),yield Kn(r.Vc.remoteStore),yield r.persistence.Ii(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}createLocalStore(e){return nf(this.persistence,new tf,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new Kd(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const r=new Qp(t,this.persistence);return new Kp(e.asyncQueue,r)}createPersistence(e){const t=Va(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?be.withCacheSize(this.cacheSizeBytes):be.DEFAULT;return new Ua(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,mf(),Pi(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new ff}}class Of extends Qu{constructor(e,t){super(e,t,!1),this.Vc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,p.Z)(function*(){yield t().call(r,e);const s=r.Vc.syncEngine;r.sharedClientState instanceof Ha&&(r.sharedClientState.syncEngine={jr:pv.bind(null,s),zr:vv.bind(null,s),Wr:wv.bind(null,s),$i:_v.bind(null,s),Qr:mv.bind(null,s)},yield r.sharedClientState.start()),yield r.persistence.Ii(function(){var i=(0,p.Z)(function*(o){yield function yv(n,e){return Bu.apply(this,arguments)}(r.Vc.syncEngine,o),r.gcScheduler&&(o&&!r.gcScheduler.started?r.gcScheduler.start():o||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(o&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():o||r.indexBackfillerScheduler.stop())});return function(o){return i.apply(this,arguments)}}())})()}createSharedClientState(e){const t=mf();if(!Ha.D(t))throw new _(m.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Va(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Ha(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Yn{initialize(e,t){var r=this;return(0,p.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=s=>kf(r.syncEngine,s,1),r.remoteStore.remoteSyncer.handleCredentialChange=dv.bind(null,r.syncEngine),yield fu(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Z_}createDatastore(e){const t=is(e.databaseInfo.databaseId),r=new P_(e.databaseInfo);return new M_(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return t=this.localStore,r=this.datastore,s=e.asyncQueue,i=a=>kf(this.syncEngine,a,0),o=gf.D()?new gf:new k_,new V_(t,r,s,i,o);var t,r,s,i,o}createSyncEngine(e,t){return function(r,s,i,o,a,u,c){const l=new rv(r,s,i,o,a,u);return c&&(l.vc=!0),l}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,p.Z)(function*(t){const r=x(t);v("RemoteStore","RemoteStore shutting down."),r.vu.add(5),yield $n(r),r.Pu.shutdown(),r.bu.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}function Ff(n,e=10240){let t=0;return{read:()=>(0,p.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,p.Z)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class Mi{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Sc(this.observer.next,e)}error(e){this.observer.error?this.Sc(this.observer.error,e):ie("Uncaught Error in snapshot listener:",e.toString())}Dc(){this.muted=!0}Sc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class xv{constructor(e,t){this.Cc=e,this.serializer=t,this.metadata=new le,this.buffer=new Uint8Array,this.xc=new TextDecoder("utf-8"),this.Nc().then(r=>{r&&r.Qu()?this.metadata.resolve(r.Gu.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==r?void 0:r.Gu)}`))},r=>this.metadata.reject(r))}close(){return this.Cc.cancel()}getMetadata(){var e=this;return(0,p.Z)(function*(){return e.metadata.promise})()}bc(){var e=this;return(0,p.Z)(function*(){return yield e.getMetadata(),e.Nc()})()}Nc(){var e=this;return(0,p.Z)(function*(){const t=yield e.kc();if(null===t)return null;const r=e.xc.decode(t),s=Number(r);isNaN(s)&&e.Mc(`length string (${r}) is not valid number`);const i=yield e.$c(s);return new J_(JSON.parse(i),t.length+s)})()}Oc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}kc(){var e=this;return(0,p.Z)(function*(){for(;e.Oc()<0&&!(yield e.Fc()););if(0===e.buffer.length)return null;const t=e.Oc();t<0&&e.Mc("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}$c(e){var t=this;return(0,p.Z)(function*(){for(;t.buffer.length<e;)(yield t.Fc())&&t.Mc("Reached the end of bundle when more is expected.");const r=t.xc.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}Mc(e){throw this.Cc.cancel(),new Error(`Invalid bundle format: ${e}`)}Fc(){var e=this;return(0,p.Z)(function*(){const t=yield e.Cc.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class Ev{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,p.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new _(m.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const r=yield(s=(0,p.Z)(function*(i,o){const a=x(i),u=Wr(a.serializer)+"/documents",c={documents:o.map(f=>Hr(a.serializer,f))},l=yield a.vo("BatchGetDocuments",u,c,o.length),h=new Map;l.forEach(f=>{const y=function $y(n,e){return"found"in e?function(t,r){C(!!r.found);const s=nt(t,r.found.name),i=oe(r.found.updateTime),o=r.found.createTime?oe(r.found.createTime):A.min(),a=new Ie({mapValue:{fields:r.found.fields}});return Z.newFoundDocument(s,i,o,a)}(n,e):"missing"in e?function(t,r){C(!!r.missing),C(!!r.readTime);const s=nt(t,r.missing),i=oe(r.readTime);return Z.newNoDocument(s,i)}(n,e):S()}(a.serializer,f);h.set(y.key.toString(),y)});const d=[];return o.forEach(f=>{const y=h.get(f.toString());C(!!y),d.push(y)}),d}),function(i,o){return s.apply(this,arguments)})(t.datastore,e);var s;return r.forEach(s=>t.recordVersion(s)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Un(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,p.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,s)=>{const i=T.fromPath(s);e.mutations.push(new ya(i,e.precondition(i)))}),yield(r=(0,p.Z)(function*(s,i){const o=x(s),a=Wr(o.serializer)+"/documents",u={writes:i.map(c=>Zr(o.serializer,c))};yield o.Io("Commit",a,u)}),function(s,i){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw S();t=A.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new _(m.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(A.min())?ee.exists(!1):ee.updateTime(t):ee.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(A.min()))throw new _(m.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ee.updateTime(t)}return ee.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Sv{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this.Bc=r.maxAttempts,this.qo=new Za(this.asyncQueue,"transaction_retry")}run(){this.Bc-=1,this.Lc()}Lc(){var e=this;this.qo.No((0,p.Z)(function*(){const t=new Ev(e.datastore),r=e.qc(t);r&&r.then(s=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(s)}).catch(i=>{e.Uc(i)}))}).catch(s=>{e.Uc(s)})}))}qc(e){try{const t=this.updateFunction(e);return!Rr(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Uc(e){this.Bc>0&&this.Kc(e)?(this.Bc-=1,this.asyncQueue.enqueueAndForget(()=>(this.Lc(),Promise.resolve()))):this.deferred.reject(e)}Kc(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!id(t)}return!1}}class bv{constructor(e,t,r,s){var i=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=ge.UNAUTHENTICATED,this.clientId=nh.A(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var o=(0,p.Z)(function*(a){v("FirestoreClient","Received user=",a.uid),yield i.authCredentialListener(a),i.user=a});return function(a){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(r,o=>(v("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}getConfiguration(){var e=this;return(0,p.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new _(m.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new le;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,p.Z)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const s=Hn(r,"Failed to shutdown persistence");t.reject(s)}})),t.promise}}function Li(n,e){return Hu.apply(this,arguments)}function Hu(){return Hu=(0,p.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),v("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var s=(0,p.Z)(function*(i){r.isEqual(i)||(yield rf(e.localStore,i),r=i)});return function(i){return s.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}),Hu.apply(this,arguments)}function Wu(n,e){return Zu.apply(this,arguments)}function Zu(){return Zu=(0,p.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield Xu(n);v("FirestoreClient","Initializing OnlineComponentProvider");const r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(s=>Tf(e.remoteStore,s)),n.setAppCheckTokenChangeListener((s,i)=>Tf(e.remoteStore,i)),n._onlineComponents=e}),Zu.apply(this,arguments)}function Mf(n){return"FirebaseError"===n.name?n.code===m.FAILED_PRECONDITION||n.code===m.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||22===n.code||20===n.code||11===n.code}function Xu(n){return Yu.apply(this,arguments)}function Yu(){return Yu=(0,p.Z)(function*(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){v("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Li(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!Mf(t))throw t;je("Error using user provided cache. Falling back to memory cache: "+t),yield Li(n,new us)}}else v("FirestoreClient","Using default OfflineComponentProvider"),yield Li(n,new us);return n._offlineComponents}),Yu.apply(this,arguments)}function Ui(n){return Ju.apply(this,arguments)}function Ju(){return Ju=(0,p.Z)(function*(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(v("FirestoreClient","Using user provided OnlineComponentProvider"),yield Wu(n,n._uninitializedComponentsProvider._online)):(v("FirestoreClient","Using default OnlineComponentProvider"),yield Wu(n,new Yn))),n._onlineComponents}),Ju.apply(this,arguments)}function Lf(n){return Xu(n).then(e=>e.persistence)}function Vi(n){return Xu(n).then(e=>e.localStore)}function Uf(n){return Ui(n).then(e=>e.remoteStore)}function ec(n){return Ui(n).then(e=>e.syncEngine)}function Jn(n){return tc.apply(this,arguments)}function tc(){return tc=(0,p.Z)(function*(n){const e=yield Ui(n),t=e.eventManager;return t.onListen=sv.bind(null,e.syncEngine),t.onUnlisten=iv.bind(null,e.syncEngine),t}),tc.apply(this,arguments)}function qf(n,e,t={}){const r=new le;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function(s,i,o,a,u){const c=new Mi({next:h=>{i.enqueueAndForget(()=>_u(s,l));const d=h.docs.has(o);!d&&h.fromCache?u.reject(new _(m.UNAVAILABLE,"Failed to get document because the client is offline.")):d&&h.fromCache&&a&&"server"===a.source?u.reject(new _(m.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(h)},error:h=>u.reject(h)}),l=new Iu(On(o.path),c,{includeMetadataChanges:!0,Ku:!0});return pu(s,l)}(yield Jn(n),n.asyncQueue,e,t,r)})),r.promise}function Bf(n,e,t={}){const r=new le;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function(s,i,o,a,u){const c=new Mi({next:h=>{i.enqueueAndForget(()=>_u(s,l)),h.fromCache&&"server"===a.source?u.reject(new _(m.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(h)},error:h=>u.reject(h)}),l=new Iu(o,c,{includeMetadataChanges:!0,Ku:!0});return pu(s,l)}(yield Jn(n),n.asyncQueue,e,t,r)})),r.promise}function Gf(n){const e={};return void 0!==n.timeoutSeconds&&(e.timeoutSeconds=n.timeoutSeconds),e}const zf=new Map;function nc(n,e,t){if(!t)throw new _(m.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function jf(n,e,t,r){if(!0===e&&!0===r)throw new _(m.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function $f(n){if(!T.isDocumentKey(n))throw new _(m.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Kf(n){if(T.isDocumentKey(n))throw new _(m.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function qi(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":S()}function U(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new _(m.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=qi(n);throw new _(m.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function Qf(n,e){if(e<=0)throw new _(m.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class Hf{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new _(m.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.cache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new _(m.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}jf("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=Gf(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new _(m.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new _(m.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new _(m.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class cs{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Hf({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new _(m.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new _(m.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Hf(e),void 0!==e.credentials&&(this._authCredentials=function(t){if(!t)return new Op;switch(t.type){case"firstParty":return new Up(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new _(m.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=zf.get(e);t&&(v("ComponentProvider","Removing Datastore"),zf.delete(e),t.terminate())}(this),Promise.resolve()}}class X{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new rt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new X(this.firestore,e,this._key)}}class Te{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Te(this.firestore,e,this._query)}}class rt extends Te{constructor(e,t,r){super(e,t,On(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new X(this.firestore,null,new T(e))}withConverter(e){return new rt(this.firestore,e,this._path)}}function Zf(n,e,...t){if(n=(0,M.m9)(n),nc("collection","path",e),n instanceof cs){const r=V.fromString(e,...t);return Kf(r),new rt(n,null,r)}{if(!(n instanceof X||n instanceof rt))throw new _(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(V.fromString(e,...t));return Kf(r),new rt(n.firestore,null,r)}}function Bi(n,e,...t){if(n=(0,M.m9)(n),1===arguments.length&&(e=nh.A()),nc("doc","path",e),n instanceof cs){const r=V.fromString(e,...t);return $f(r),new X(n,null,new T(r))}{if(!(n instanceof X||n instanceof rt))throw new _(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(V.fromString(e,...t));return $f(r),new X(n.firestore,n instanceof rt?n.converter:null,new T(r))}}function Xf(n,e){return n=(0,M.m9)(n),e=(0,M.m9)(e),(n instanceof X||n instanceof rt)&&(e instanceof X||e instanceof rt)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function rc(n,e){return n=(0,M.m9)(n),e=(0,M.m9)(e),n instanceof Te&&e instanceof Te&&n.firestore===e.firestore&&Vr(n._query,e._query)&&n.converter===e.converter}class Mv{constructor(){this.Gc=Promise.resolve(),this.Qc=[],this.jc=!1,this.zc=[],this.Wc=null,this.Hc=!1,this.Jc=!1,this.Yc=[],this.qo=new Za(this,"async_queue_retry"),this.Xc=()=>{const t=Pi();t&&v("AsyncQueue","Visibility state changed to "+t.visibilityState),this.qo.Mo()};const e=Pi();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Xc)}get isShuttingDown(){return this.jc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Zc(),this.ta(e)}enterRestrictedMode(e){if(!this.jc){this.jc=!0,this.Jc=e||!1;const t=Pi();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Xc)}}enqueue(e){if(this.Zc(),this.jc)return new Promise(()=>{});const t=new le;return this.ta(()=>this.jc&&this.Jc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Qc.push(e),this.ea()))}ea(){var e=this;return(0,p.Z)(function*(){if(0!==e.Qc.length){try{yield e.Qc[0](),e.Qc.shift(),e.qo.reset()}catch(t){if(!Ct(t))throw t;v("AsyncQueue","Operation failed with retryable error: "+t)}e.Qc.length>0&&e.qo.No(()=>e.ea())}})()}ta(e){const t=this.Gc.then(()=>(this.Hc=!0,e().catch(r=>{throw this.Wc=r,this.Hc=!1,ie("INTERNAL UNHANDLED ERROR: ",function(i){let o=i.message||"";return i.stack&&(o=i.stack.includes(i.message)?i.stack:i.message+"\n"+i.stack),o}(r)),r}).then(r=>(this.Hc=!1,r))));return this.Gc=t,t}enqueueAfterDelay(e,t,r){this.Zc(),this.Yc.indexOf(e)>-1&&(t=0);const s=mu.createAndSchedule(this,e,t,r,i=>this.na(i));return this.zc.push(s),s}Zc(){this.Wc&&S()}verifyOperationInProgress(){}sa(){var e=this;return(0,p.Z)(function*(){let t;do{t=e.Gc,yield t}while(t!==e.Gc)})()}ia(e){for(const t of this.zc)if(t.timerId===e)return!0;return!1}ra(e){return this.sa().then(()=>{this.zc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.zc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.sa()})}oa(e){this.Yc.push(e)}na(e){const t=this.zc.indexOf(e);this.zc.splice(t,1)}}function sc(n){return function(e,t){if("object"!=typeof e||null===e)return!1;const r=e;for(const s of["next","error","complete"])if(s in r&&"function"==typeof r[s])return!0;return!1}(n)}class Lv{constructor(){this._progressObserver={},this._taskCompletionResolver=new le,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class Y extends cs{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new Mv,this._persistenceKey=(null==s?void 0:s.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Yf(this),this._firestoreClient.terminate()}}function ae(n){return n._firestoreClient||Yf(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function Yf(n){var e,t,r;const s=n._freezeSettings(),i=(a=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new gy(n._databaseId,a,n._persistenceKey,(c=s).host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,Gf(c.experimentalLongPollingOptions),c.useFetchStreams));var a,c;n._firestoreClient=new bv(n._authCredentials,n._appCheckCredentials,n._queue,i),null!==(t=s.cache)&&void 0!==t&&t._offlineComponentProvider&&null!==(r=s.cache)&&void 0!==r&&r._onlineComponentProvider&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.cache.kind,_offline:s.cache._offlineComponentProvider,_online:s.cache._onlineComponentProvider})}function Jf(n,e,t){const r=new le;return n.asyncQueue.enqueue((0,p.Z)(function*(){try{yield Li(n,t),yield Wu(n,e),r.resolve()}catch(s){const i=s;if(!Mf(i))throw i;je("Error enabling indexeddb cache. Falling back to memory cache: "+i),r.reject(i)}})).then(()=>r.promise)}function eg(n){if(n._initialized||n._terminated)throw new _(m.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class st{constructor(e){this._byteString=e}static fromBase64String(e){try{return new st(he.fromBase64String(e))}catch(t){throw new _(m.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new st(he.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class pt{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new _(m.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new re(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class fn{constructor(e){this._methodName=e}}class Gi{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new _(m.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new _(m.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return k(this._lat,e._lat)||k(this._long,e._long)}}const Hv=/^__.*__$/;class Wv{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new ft(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ln(e,this.data,t,this.fieldTransforms)}}class tg{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new ft(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function ng(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw S()}}class zi{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,void 0===i&&this.ua(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get ca(){return this.settings.ca}aa(e){return new zi(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ha(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.aa({path:r,la:!1});return s.fa(e),s}da(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.aa({path:r,la:!1});return s.ua(),s}wa(e){return this.aa({path:void 0,la:!0})}_a(e){return Ki(e,this.settings.methodName,this.settings.ma||!1,this.path,this.settings.ga)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}ua(){if(this.path)for(let e=0;e<this.path.length;e++)this.fa(this.path.get(e))}fa(e){if(0===e.length)throw this._a("Document fields must not be empty");if(ng(this.ca)&&Hv.test(e))throw this._a('Document fields cannot begin and end with "__"')}}class Zv{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||is(e)}ya(e,t,r,s=!1){return new zi({ca:e,methodName:t,ga:r,path:re.emptyPath(),la:!1,ma:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function gn(n){const e=n._freezeSettings(),t=is(n._databaseId);return new Zv(n._databaseId,!!e.ignoreUndefinedProperties,t)}function ji(n,e,t,r,s,i={}){const o=n.ya(i.merge||i.mergeFields?2:0,e,t,s);uc("Data must be an object, but it was:",o,r);const a=ig(r,o);let u,c;if(i.merge)u=new Fe(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const l=[];for(const h of i.mergeFields){const d=ds(e,h,t);if(!o.contains(d))throw new _(m.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);ag(l,d)||l.push(d)}u=new Fe(l),c=o.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,c=o.fieldTransforms;return new Wv(new Ie(a),u,c)}class hs extends fn{_toFieldTransform(e){if(2!==e.ca)throw e._a(1===e.ca?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof hs}}function rg(n,e,t){return new zi({ca:3,ga:e.settings.ga,methodName:n._methodName,la:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class ic extends fn{_toFieldTransform(e){return new zr(e.path,new Fn)}isEqual(e){return e instanceof ic}}class Xv extends fn{constructor(e,t){super(e),this.pa=t}_toFieldTransform(e){const t=rg(this,e,!0),r=this.pa.map(i=>mn(i,t)),s=new rn(r);return new zr(e.path,s)}isEqual(e){return this===e}}class Yv extends fn{constructor(e,t){super(e),this.pa=t}_toFieldTransform(e){const t=rg(this,e,!0),r=this.pa.map(i=>mn(i,t)),s=new sn(r);return new zr(e.path,s)}isEqual(e){return this===e}}class Jv extends fn{constructor(e,t){super(e),this.Ia=t}_toFieldTransform(e){const t=new Mn(e.serializer,Hh(e.serializer,this.Ia));return new zr(e.path,t)}isEqual(e){return this===e}}function oc(n,e,t,r){const s=n.ya(1,e,t);uc("Data must be an object, but it was:",s,r);const i=[],o=Ie.empty();At(r,(u,c)=>{const l=$i(e,u,t);c=(0,M.m9)(c);const h=s.da(l);if(c instanceof hs)i.push(l);else{const d=mn(c,h);null!=d&&(i.push(l),o.set(l,d))}});const a=new Fe(i);return new tg(o,a,s.fieldTransforms)}function ac(n,e,t,r,s,i){const o=n.ya(1,e,t),a=[ds(e,r,t)],u=[s];if(i.length%2!=0)throw new _(m.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<i.length;d+=2)a.push(ds(e,i[d])),u.push(i[d+1]);const c=[],l=Ie.empty();for(let d=a.length-1;d>=0;--d)if(!ag(c,a[d])){const f=a[d];let y=u[d];y=(0,M.m9)(y);const I=o.da(f);if(y instanceof hs)c.push(f);else{const w=mn(y,I);null!=w&&(c.push(f),l.set(f,w))}}const h=new Fe(c);return new tg(l,h,o.fieldTransforms)}function sg(n,e,t,r=!1){return mn(t,n.ya(r?4:3,e))}function mn(n,e){if(og(n=(0,M.m9)(n)))return uc("Unsupported field value:",e,n),ig(n,e);if(n instanceof fn)return function(t,r){if(!ng(r.ca))throw r._a(`${t._methodName}() can only be used with update() and set()`);if(!r.path)throw r._a(`${t._methodName}() is not currently supported inside arrays`);const s=t._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.la&&4!==e.ca)throw e._a("Nested arrays are not supported");return function(t,r){const s=[];let i=0;for(const o of t){let a=mn(o,r.wa(i));null==a&&(a={nullValue:"NULL_VALUE"}),s.push(a),i++}return{arrayValue:{values:s}}}(n,e)}return function(t,r){if(null===(t=(0,M.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Hh(r.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const s=J.fromDate(t);return{timestampValue:Vn(r.serializer,s)}}if(t instanceof J){const s=new J(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Vn(r.serializer,s)}}if(t instanceof Gi)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof st)return{bytesValue:md(r.serializer,t._byteString)};if(t instanceof X){const s=r.databaseId,i=t.firestore._databaseId;if(!i.isEqual(s))throw r._a(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Ea(t.firestore._databaseId||r.databaseId,t._key.path)}}throw r._a(`Unsupported field value: ${qi(t)}`)}(n,e)}function ig(n,e){const t={};return yh(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):At(n,(r,s)=>{const i=mn(s,e.ha(r));null!=i&&(t[r]=i)}),{mapValue:{fields:t}}}function og(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof J||n instanceof Gi||n instanceof st||n instanceof X||n instanceof fn)}function uc(n,e,t){if(!og(t)||"object"!=typeof(r=t)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){const r=qi(t);throw e._a("an object"===r?n+" a custom object":n+" "+r)}var r}function ds(n,e,t){if((e=(0,M.m9)(e))instanceof pt)return e._internalPath;if("string"==typeof e)return $i(n,e);throw Ki("Field path arguments must be of type string or ",n,!1,void 0,t)}const ew=new RegExp("[~\\*/\\[\\]]");function $i(n,e,t){if(e.search(ew)>=0)throw Ki(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new pt(...e.split("."))._internalPath}catch{throw Ki(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Ki(n,e,t,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(i||o)&&(u+=" (found",i&&(u+=` in field ${r}`),o&&(u+=` in document ${s}`),u+=")"),new _(m.INVALID_ARGUMENT,a+n+u)}function ag(n,e){return n.some(t=>t.isEqual(e))}class fs{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new X(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new tw(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Qi("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class tw extends fs{data(){return super.data()}}function Qi(n,e){return"string"==typeof e?$i(n,e):e instanceof pt?e._internalPath:e._delegate._internalPath}function ug(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new _(m.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class cc{}class gs extends cc{}function Bt(n,e,...t){let r=[];e instanceof cc&&r.push(e),r=r.concat(t),function(s){const i=s.filter(a=>a instanceof er).length,o=s.filter(a=>a instanceof ms).length;if(i>1||i>0&&o>0)throw new _(m.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class ms extends gs{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new ms(e,t,r)}_apply(e){const t=this._parse(e);return dg(e._query,t),new Te(e.firestore,e.converter,ga(e._query,t))}_parse(e){const t=gn(e.firestore);return function(s,i,o,a,u,c,l){let h;if(u.isKeyField()){if("array-contains"===c||"array-contains-any"===c)throw new _(m.INVALID_ARGUMENT,`Invalid Query. You can't perform '${c}' queries on documentId().`);if("in"===c||"not-in"===c){hg(l,c);const d=[];for(const f of l)d.push(lg(a,s,f));h={arrayValue:{values:d}}}else h=lg(a,s,l)}else"in"!==c&&"not-in"!==c&&"array-contains-any"!==c||hg(l,c),h=sg(o,"where",l,"in"===c||"not-in"===c);return L.create(u,c,h)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class er extends cc{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new er(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return 1===t.length?t[0]:j.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(r,s){let i=r;const o=s.getFlattenedFilters();for(const a of o)dg(i,a),i=ga(i,a)}(e._query,t),new Te(e.firestore,e.converter,ga(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class lc extends gs{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new lc(e,t)}_apply(e){const t=function(r,s,i){if(null!==r.startAt)throw new _(m.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==r.endAt)throw new _(m.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const o=new Rn(s,i);return function(a,u){if(null===da(a)){const c=hi(a);null!==c&&fg(0,c,u.field)}}(r,o),o}(e._query,this._field,this._direction);return new Te(e.firestore,e.converter,function(r,s){const i=r.explicitOrderBy.concat([s]);return new ht(r.path,r.collectionGroup,i,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}class Hi extends gs{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Hi(e,t,r)}_apply(e){return new Te(e.firestore,e.converter,di(e._query,this._limit,this._limitType))}}class Wi extends gs{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Wi(e,t,r)}_apply(e){const t=cg(e,this.type,this._docOrFields,this._inclusive);return new Te(e.firestore,e.converter,(s=t,new ht((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,s,r.endAt)));var r,s}}class Zi extends gs{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Zi(e,t,r)}_apply(e){const t=cg(e,this.type,this._docOrFields,this._inclusive);return new Te(e.firestore,e.converter,(s=t,new ht((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,s)));var r,s}}function cg(n,e,t,r){if(t[0]=(0,M.m9)(t[0]),t[0]instanceof fs)return function(s,i,o,a,u){if(!a)throw new _(m.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${o}().`);const c=[];for(const l of nn(s))if(l.field.isKeyField())c.push(en(i,a.key));else{const h=a.data.field(l.field);if(si(h))throw new _(m.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+l.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===h){const d=l.field.canonicalString();throw new _(m.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${d}' (used as the orderBy) does not exist.`)}c.push(h)}return new Ot(c,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=gn(n.firestore);return function(i,o,a,u,c,l){const h=i.explicitOrderBy;if(c.length>h.length)throw new _(m.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const d=[];for(let f=0;f<c.length;f++){const y=c[f];if(h[f].field.isKeyField()){if("string"!=typeof y)throw new _(m.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof y}`);if(!fa(i)&&-1!==y.indexOf("/"))throw new _(m.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${y}' contains a slash.`);const I=i.path.child(V.fromString(y));if(!T.isDocumentKey(I))throw new _(m.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${I}' is not because it contains an odd number of segments.`);const w=new T(I);d.push(en(o,w))}else{const I=sg(a,u,y);d.push(I)}}return new Ot(d,l)}(n._query,n.firestore._databaseId,s,e,t,r)}}function lg(n,e,t){if("string"==typeof(t=(0,M.m9)(t))){if(""===t)throw new _(m.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!fa(e)&&-1!==t.indexOf("/"))throw new _(m.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(V.fromString(t));if(!T.isDocumentKey(r))throw new _(m.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return en(n,new T(r))}if(t instanceof X)return en(n,t._key);throw new _(m.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${qi(t)}.`)}function hg(n,e){if(!Array.isArray(n)||0===n.length)throw new _(m.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function dg(n,e){if(e.isInequality()){const r=hi(n),s=e.field;if(null!==r&&!r.isEqual(s))throw new _(m.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${s.toString()}'`);const i=da(n);null!==i&&fg(0,s,i)}const t=function(r,s){for(const i of r)for(const o of i.getFlattenedFilters())if(s.indexOf(o.op)>=0)return o.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new _(m.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function fg(n,e,t){if(!t.isEqual(e))throw new _(m.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class hc{convertValue(e,t="none"){switch(Rt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return se(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(lt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw S()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return At(e,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertGeoPoint(e){return new Gi(se(e.latitude),se(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=ii(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Or(e));default:return null}}convertTimestamp(e){const t=Dt(e);return new J(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=V.fromString(e);C(Sd(r));const s=new kt(r.get(1),r.get(3)),i=new T(r.popFirst(5));return s.isEqual(t)||ie(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Xi(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class lw extends hc{constructor(e){super(),this.firestore=e}convertBytes(e){return new st(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new X(this.firestore,null,t)}}class pn{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class yt extends fs{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ps(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Qi("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class ps extends yt{data(e={}){return super.data(e)}}class Gt{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new pn(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new ps(this._firestore,this._userDataWriter,r.key,r,new pn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new _(m.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let i=0;return r._snapshot.docChanges.map(o=>({type:"added",doc:new ps(r._firestore,r._userDataWriter,o.doc.key,o.doc,new pn(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:i++}))}{let i=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(o=>s||3!==o.type).map(o=>{const a=new ps(r._firestore,r._userDataWriter,o.doc.key,o.doc,new pn(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);let u=-1,c=-1;return 0!==o.type&&(u=i.indexOf(o.doc.key),i=i.delete(o.doc.key)),1!==o.type&&(i=i.add(o.doc),c=i.indexOf(o.doc.key)),{type:dw(o.type),doc:a,oldIndex:u,newIndex:c}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function dw(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return S()}}function mg(n,e){return n instanceof yt&&e instanceof yt?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Gt&&e instanceof Gt&&n._firestore===e._firestore&&rc(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}class zt extends hc{constructor(e){super(),this.firestore=e}convertBytes(e){return new st(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new X(this.firestore,null,t)}}function pg(n,e,t){n=U(n,X);const r=U(n.firestore,Y),s=Xi(n.converter,e,t);return tr(r,[ji(gn(r),"setDoc",n._key,s,null!==n.converter,t).toMutation(n._key,ee.none())])}function yg(n,e,t,...r){n=U(n,X);const s=U(n.firestore,Y),i=gn(s);let o;return o="string"==typeof(e=(0,M.m9)(e))||e instanceof pt?ac(i,"updateDoc",n._key,e,t,r):oc(i,"updateDoc",n._key,e),tr(s,[o.toMutation(n._key,ee.exists(!0))])}function _g(n,...e){var t,r,s;n=(0,M.m9)(n);let i={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||sc(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges};if(sc(e[o])){const h=e[o];e[o]=null===(t=h.next)||void 0===t?void 0:t.bind(h),e[o+1]=null===(r=h.error)||void 0===r?void 0:r.bind(h),e[o+2]=null===(s=h.complete)||void 0===s?void 0:s.bind(h)}let u,c,l;if(n instanceof X)c=U(n.firestore,Y),l=On(n._key.path),u={next:h=>{e[o]&&e[o](dc(c,n,h))},error:e[o+1],complete:e[o+2]};else{const h=U(n,Te);c=U(h.firestore,Y),l=h._query;const d=new zt(c);u={next:f=>{e[o]&&e[o](new Gt(c,d,h,f))},error:e[o+1],complete:e[o+2]},ug(n._query)}return function(h,d,f,y){const I=new Mi(y),w=new Iu(d,I,f);return h.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return pu(yield Jn(h),w)})),()=>{I.Dc(),h.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return _u(yield Jn(h),w)}))}}(ae(c),l,a,u)}function tr(n,e){return function(t,r){const s=new le;return t.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function ov(n,e,t){return bu.apply(this,arguments)}(yield ec(t),r,s)})),s.promise}(ae(n),e)}function dc(n,e,t){const r=t.docs.get(e._key),s=new zt(n);return new yt(n,s,e._key,r,new pn(t.hasPendingWrites,t.fromCache),e.converter)}const kw={maxAttempts:5};class vg{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=gn(e)}set(e,t,r){this._verifyNotCommitted();const s=jt(e,this._firestore),i=Xi(s.converter,t,r),o=ji(this._dataReader,"WriteBatch.set",s._key,i,null!==s.converter,r);return this._mutations.push(o.toMutation(s._key,ee.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=jt(e,this._firestore);let o;return o="string"==typeof(t=(0,M.m9)(t))||t instanceof pt?ac(this._dataReader,"WriteBatch.update",i._key,t,r,s):oc(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,ee.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=jt(e,this._firestore);return this._mutations=this._mutations.concat(new Un(t._key,ee.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new _(m.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function jt(n,e){if((n=(0,M.m9)(n)).firestore!==e)throw new _(m.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class Nw extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=gn(e)}get(e){const t=jt(e,this._firestore),r=new lw(this._firestore);return this._transaction.lookup([t._key]).then(s=>{if(!s||1!==s.length)return S();const i=s[0];if(i.isFoundDocument())return new fs(this._firestore,r,i.key,i,t.converter);if(i.isNoDocument())return new fs(this._firestore,r,t._key,null,t.converter);throw S()})}set(e,t,r){const s=jt(e,this._firestore),i=Xi(s.converter,t,r),o=ji(this._dataReader,"Transaction.set",s._key,i,null!==s.converter,r);return this._transaction.set(s._key,o),this}update(e,t,r,...s){const i=jt(e,this._firestore);let o;return o="string"==typeof(t=(0,M.m9)(t))||t instanceof pt?ac(this._dataReader,"Transaction.update",i._key,t,r,s):oc(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=jt(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=jt(e,this._firestore),r=new zt(this._firestore);return super.get(e).then(s=>new yt(this._firestore,r,t._key,s._document,new pn(!1,!1),t.converter))}}!function(n,e=!0){An=Tt.SDK_VERSION,(0,Tt._registerComponent)(new Ss.wA("firestore",(t,{instanceIdentifier:r,options:s})=>{const i=t.getProvider("app").getImmediate(),o=new Y(new Mp(t.getProvider("auth-internal")),new Vp(t.getProvider("app-check-internal")),function(a,u){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new _(m.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new kt(a.options.projectId,u)}(i,r),i);return s=Object.assign({useFetchStreams:e},s),o._setSettings(s),o},"PUBLIC").setMultipleInstances(!0)),(0,Tt.registerVersion)(Jl,"3.13.0",n),(0,Tt.registerVersion)(Jl,"3.13.0","esm2017")}();function fc(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new _("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function Ig(){if(typeof Uint8Array>"u")throw new _("unimplemented","Uint8Arrays are not available in this environment.")}function Tg(){if(!function dy(){return typeof atob<"u"}())throw new _("unimplemented","Blobs are unavailable in Firestore in this environment.")}class ys{constructor(e){this._delegate=e}static fromBase64String(e){return Tg(),new ys(st.fromBase64String(e))}static fromUint8Array(e){return Ig(),new ys(st.fromUint8Array(e))}toBase64(){return Tg(),this._delegate.toBase64()}toUint8Array(){return Ig(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function gc(n){return function qw(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}(n,["next","error","complete"])}class Bw{enableIndexedDbPersistence(e,t){return function Vv(n,e){eg(n=U(n,Y));const t=ae(n);if(t._uninitializedComponentsProvider)throw new _(m.FAILED_PRECONDITION,"SDK cache is already specified.");je("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=n._freezeSettings(),s=new Yn;return Jf(t,s,new Qu(s,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function qv(n){eg(n=U(n,Y));const e=ae(n);if(e._uninitializedComponentsProvider)throw new _(m.FAILED_PRECONDITION,"SDK cache is already specified.");je("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings(),r=new Yn;return Jf(e,r,new Of(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function Bv(n){if(n._initialized&&!n._terminated)throw new _(m.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new le;return n._queue.enqueueAndForgetEvenWhileRestricted((0,p.Z)(function*(){try{yield(t=(0,p.Z)(function*(r){if(!He.D())return Promise.resolve();const s=r+"main";yield He.delete(s)}),function(r){return t.apply(this,arguments)})(Va(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class xg{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof kt||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&je("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){!function Wf(n,e,t,r={}){var s;const i=(n=U(n,cs))._getSettings(),o=`${e}:${t}`;if("firestore.googleapis.com"!==i.host&&i.host!==o&&je("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let a,u;if("string"==typeof r.mockUserToken)a=r.mockUserToken,u=ge.MOCK_USER;else{a=(0,M.Sg)(r.mockUserToken,null===(s=n._app)||void 0===s?void 0:s.options.projectId);const c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new _(m.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new ge(c)}n._authCredentials=new Fp(new eh(a,u))}}(this._delegate,e,t,r)}enableNetwork(){return function zv(n){return function Cv(n){return n.asyncQueue.enqueue((0,p.Z)(function*(){const e=yield Lf(n),t=yield Uf(n);return e.setNetworkEnabled(!0),function(r){const s=x(r);return s.vu.delete(0),os(s)}(t)}))}(ae(n=U(n,Y)))}(this._delegate)}disableNetwork(){return function jv(n){return function Av(n){return n.asyncQueue.enqueue((0,p.Z)(function*(){const e=yield Lf(n),t=yield Uf(n);return e.setNetworkEnabled(!1),(r=(0,p.Z)(function*(s){const i=x(s);i.vu.add(0),yield $n(i),i.bu.set("Offline")}),function(s){return r.apply(this,arguments)})(t);var r}))}(ae(n=U(n,Y)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,jf("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function Gv(n){return function(e){const t=new le;return e.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function lv(n,e){return Nu.apply(this,arguments)}(yield ec(e),t)})),t.promise}(ae(n=U(n,Y)))}(this._delegate)}onSnapshotsInSync(e){return function Iw(n,e){return function Nv(n,e){const t=new Mi(e);return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return r=yield Jn(n),s=t,x(r).ku.add(s),void s.next();var r,s})),()=>{t.Dc(),n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return r=yield Jn(n),s=t,void x(r).ku.delete(s);var r,s}))}}(ae(n=U(n,Y)),sc(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new _("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new nr(this,Zf(this._delegate,e))}catch(t){throw Ne(t,"collection()","Firestore.collection()")}}doc(e){try{return new $e(this,Bi(this._delegate,e))}catch(t){throw Ne(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Re(this,function Fv(n,e){if(n=U(n,cs),nc("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new _(m.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Te(n,null,(t=e,new ht(V.emptyPath(),t)));var t}(this._delegate,e))}catch(t){throw Ne(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function Rw(n,e,t){n=U(n,Y);const r=Object.assign(Object.assign({},kw),t);return function(s){if(s.maxAttempts<1)throw new _(m.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,i,o){const a=new le;return s.asyncQueue.enqueueAndForget((0,p.Z)(function*(){const u=yield function Vf(n){return Ui(n).then(e=>e.datastore)}(s);new Sv(s.asyncQueue,u,o,i,a).run()})),a.promise}(ae(n),s=>e(new Nw(n,s)),r)}(this._delegate,t=>e(new Eg(this,t)))}batch(){return ae(this._delegate),new Sg(new vg(this._delegate,e=>tr(this._delegate,e)))}loadBundle(e){return function $v(n,e){const t=ae(n=U(n,Y)),r=new Lv;return function Rv(n,e,t,r){const s=function(i,o){let a;return a="string"==typeof i?ad().encode(i):i,u=function(u,c){if(u instanceof Uint8Array)return Ff(u,c);if(u instanceof ArrayBuffer)return Ff(new Uint8Array(u),c);if(u instanceof ReadableStream)return u.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(a),new xv(u,o);var u}(t,is(e));n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){!function Iv(n,e,t){const r=x(n);var s;(s=(0,p.Z)(function*(i,o,a){try{const u=yield o.getMetadata();if(yield function(d,f){const y=x(d),I=oe(f.createTime);return y.persistence.runTransaction("hasNewerBundle","readonly",w=>y.qs.getBundleMetadata(w,f.id)).then(w=>!!w&&w.createTime.compareTo(I)>=0)}(i.localStore,u))return yield o.close(),a._completeWith({taskState:"Success",documentsLoaded:(d=u).totalDocuments,bytesLoaded:d.totalBytes,totalDocuments:d.totalDocuments,totalBytes:d.totalBytes}),Promise.resolve(new Set);a._updateProgress(Sf(u));const c=new ev(u,i.localStore,o.serializer);let l=yield o.bc();for(;l;){const d=yield c.zu(l);d&&a._updateProgress(d),l=yield o.bc()}const h=yield c.complete();return yield mt(i,h.Ju,void 0),yield function(d,f){const y=x(d);return y.persistence.runTransaction("Save bundle","readwrite",I=>y.qs.saveBundleMetadata(I,f))}(i.localStore,u),a._completeWith(h.progress),Promise.resolve(h.Hu)}catch(u){return je("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}var d}),function(i,o,a){return s.apply(this,arguments)})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}(yield ec(n),s,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function Kv(n,e){return function Pv(n,e){return n.asyncQueue.enqueue((0,p.Z)(function*(){return function(t,r){const s=x(t);return s.persistence.runTransaction("Get named query","readonly",i=>s.qs.getNamedQuery(i,r))}(yield Vi(n),e)}))}(ae(n=U(n,Y)),e).then(t=>t?new Te(n,null,t.query):null)}(this._delegate,e).then(t=>t?new Re(this,t):null)}}class Yi extends hc{constructor(e){super(),this.firestore=e}convertBytes(e){return new ys(new st(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return $e.forKey(t,this.firestore,null)}}class Eg{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Yi(e)}get(e){const t=_n(e);return this._delegate.get(t).then(r=>new _s(this._firestore,new yt(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const s=_n(e);return r?(fc("Transaction.set",r),this._delegate.set(s,t,r)):this._delegate.set(s,t),this}update(e,t,r,...s){const i=_n(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,r,...s),this}delete(e){const t=_n(e);return this._delegate.delete(t),this}}class Sg{constructor(e){this._delegate=e}set(e,t,r){const s=_n(e);return r?(fc("WriteBatch.set",r),this._delegate.set(s,t,r)):this._delegate.set(s,t),this}update(e,t,r,...s){const i=_n(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,r,...s),this}delete(e){const t=_n(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class yn{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new ps(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new vs(this._firestore,r),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=yn.INSTANCES;let s=r.get(e);s||(s=new WeakMap,r.set(e,s));let i=s.get(t);return i||(i=new yn(e,new Yi(e),t),s.set(t,i)),i}}yn.INSTANCES=new WeakMap;class $e{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Yi(e)}static forPath(e,t,r){if(e.length%2!=0)throw new _("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new $e(t,new X(t._delegate,r,new T(e)))}static forKey(e,t,r){return new $e(t,new X(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new nr(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new nr(this.firestore,Zf(this._delegate,e))}catch(t){throw Ne(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,M.m9)(e))instanceof X&&Xf(this._delegate,e)}set(e,t){t=fc("DocumentReference.set",t);try{return t?pg(this._delegate,e,t):pg(this._delegate,e)}catch(r){throw Ne(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?yg(this._delegate,e):yg(this._delegate,e,t,...r)}catch(s){throw Ne(s,"updateDoc()","DocumentReference.update()")}}delete(){return function vw(n){return tr(U(n.firestore,Y),[new Un(n._key,ee.none())])}(this._delegate)}onSnapshot(...e){const t=bg(e),r=Cg(e,s=>new _s(this.firestore,new yt(this.firestore._delegate,this._userDataWriter,s._key,s._document,s.metadata,this._delegate.converter)));return _g(this._delegate,t,r)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function gw(n){n=U(n,X);const e=U(n.firestore,Y),t=ae(e),r=new zt(e);return function Dv(n,e){const t=new le;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return(r=(0,p.Z)(function*(s,i,o){try{const a=yield function(u,c){const l=x(u);return l.persistence.runTransaction("read document","readonly",h=>l.localDocuments.getDocument(h,c))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new _(m.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const u=Hn(a,`Failed to get document '${i} from cache`);o.reject(u)}}),function(s,i,o){return r.apply(this,arguments)})(yield Vi(n),e,t);var r})),t.promise}(t,n._key).then(s=>new yt(e,r,n._key,s,new pn(null!==s&&s.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function mw(n){n=U(n,X);const e=U(n.firestore,Y);return qf(ae(e),n._key,{source:"server"}).then(t=>dc(e,n,t))}(this._delegate):function fw(n){n=U(n,X);const e=U(n.firestore,Y);return qf(ae(e),n._key).then(t=>dc(e,n,t))}(this._delegate),t.then(r=>new _s(this.firestore,new yt(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new $e(this.firestore,this._delegate.withConverter(e?yn.getInstance(this.firestore,e):null))}}function Ne(n,e,t){return n.message=n.message.replace(e,t),n}function bg(n){for(const e of n)if("object"==typeof e&&!gc(e))return e;return{}}function Cg(n,e){var t,r;let s;return s=gc(n[0])?n[0]:gc(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:i=>{s.next&&s.next(e(i))},error:null===(t=s.error)||void 0===t?void 0:t.bind(s),complete:null===(r=s.complete)||void 0===r?void 0:r.bind(s)}}class _s{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new $e(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return mg(this._delegate,e._delegate)}}class vs extends _s{data(e){const t=this._delegate.data(e);return function Pp(n,e){n||S()}(void 0!==t),t}}class Re{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Yi(e)}where(e,t,r){try{return new Re(this.firestore,Bt(this._delegate,function nw(n,e,t){const r=e,s=Qi("where",n);return ms._create(s,r,t)}(e,t,r)))}catch(s){throw Ne(s,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Re(this.firestore,Bt(this._delegate,function rw(n,e="asc"){const t=e,r=Qi("orderBy",n);return lc._create(r,t)}(e,t)))}catch(r){throw Ne(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Re(this.firestore,Bt(this._delegate,function sw(n){return Qf("limit",n),Hi._create("limit",n,"F")}(e)))}catch(t){throw Ne(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Re(this.firestore,Bt(this._delegate,function iw(n){return Qf("limitToLast",n),Hi._create("limitToLast",n,"L")}(e)))}catch(t){throw Ne(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Re(this.firestore,Bt(this._delegate,function ow(...n){return Wi._create("startAt",n,!0)}(...e)))}catch(t){throw Ne(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Re(this.firestore,Bt(this._delegate,function aw(...n){return Wi._create("startAfter",n,!1)}(...e)))}catch(t){throw Ne(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Re(this.firestore,Bt(this._delegate,function uw(...n){return Zi._create("endBefore",n,!1)}(...e)))}catch(t){throw Ne(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Re(this.firestore,Bt(this._delegate,function cw(...n){return Zi._create("endAt",n,!0)}(...e)))}catch(t){throw Ne(t,"endAt()","Query.endAt()")}}isEqual(e){return rc(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function yw(n){n=U(n,Te);const e=U(n.firestore,Y),t=ae(e),r=new zt(e);return function kv(n,e){const t=new le;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return(r=(0,p.Z)(function*(s,i,o){try{const a=yield Di(s,i,!0),u=new Af(i,a.ir),c=u.sc(a.documents),l=u.applyChanges(c,!1);o.resolve(l.snapshot)}catch(a){const u=Hn(a,`Failed to execute query '${i} against cache`);o.reject(u)}}),function(s,i,o){return r.apply(this,arguments)})(yield Vi(n),e,t);var r})),t.promise}(t,n._query).then(s=>new Gt(e,r,n,s))}(this._delegate):"server"===(null==e?void 0:e.source)?function _w(n){n=U(n,Te);const e=U(n.firestore,Y),t=ae(e),r=new zt(e);return Bf(t,n._query,{source:"server"}).then(s=>new Gt(e,r,n,s))}(this._delegate):function pw(n){n=U(n,Te);const e=U(n.firestore,Y),t=ae(e),r=new zt(e);return ug(n._query),Bf(t,n._query).then(s=>new Gt(e,r,n,s))}(this._delegate),t.then(r=>new mc(this.firestore,new Gt(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=bg(e),r=Cg(e,s=>new mc(this.firestore,new Gt(this.firestore._delegate,this._userDataWriter,this._delegate,s._snapshot)));return _g(this._delegate,t,r)}withConverter(e){return new Re(this.firestore,this._delegate.withConverter(e?yn.getInstance(this.firestore,e):null))}}class zw{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new vs(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class mc{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Re(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new vs(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new zw(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new vs(this._firestore,r))})}isEqual(e){return mg(this._delegate,e._delegate)}}class nr extends Re{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new $e(this.firestore,e):null}doc(e){try{return new $e(this.firestore,void 0===e?Bi(this._delegate):Bi(this._delegate,e))}catch(t){throw Ne(t,"doc()","CollectionReference.doc()")}}add(e){return function ww(n,e){const t=U(n.firestore,Y),r=Bi(n),s=Xi(n.converter,e);return tr(t,[ji(gn(n.firestore),"addDoc",r._key,s,null!==n.converter,{}).toMutation(r._key,ee.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new $e(this.firestore,t))}isEqual(e){return Xf(this._delegate,e._delegate)}withConverter(e){return new nr(this.firestore,this._delegate.withConverter(e?yn.getInstance(this.firestore,e):null))}}function _n(n){return U(n,X)}class pc{constructor(...e){this._delegate=new pt(...e)}static documentId(){return new pc(re.keyField().canonicalString())}isEqual(e){return(e=(0,M.m9)(e))instanceof pt&&this._delegate._internalPath.isEqual(e._internalPath)}}class vn{constructor(e){this._delegate=e}static serverTimestamp(){const e=function Ow(){return new ic("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new vn(e)}static delete(){const e=function Pw(){return new hs("deleteField")}();return e._methodName="FieldValue.delete",new vn(e)}static arrayUnion(...e){const t=function Fw(...n){return new Xv("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new vn(t)}static arrayRemove(...e){const t=function Mw(...n){return new Yv("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new vn(t)}static increment(e){const t=function Lw(n){return new Jv("increment",n)}(e);return t._methodName="FieldValue.increment",new vn(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const jw={Firestore:xg,GeoPoint:Gi,Timestamp:J,Blob:ys,Transaction:Eg,WriteBatch:Sg,DocumentReference:$e,DocumentSnapshot:_s,Query:Re,QueryDocumentSnapshot:vs,QuerySnapshot:mc,CollectionReference:nr,FieldPath:pc,FieldValue:vn,setLogLevel:function Gw(n){!function Rp(n){St.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};!function Kw(n){(function $w(n,e){n.INTERNAL.registerComponent(new Ss.wA("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),s=t.getProvider("firestore").getImmediate();return e(r,s)},"PUBLIC").setServiceProps(Object.assign({},jw)))})(n,(e,t)=>new xg(e,t,new Bw)),n.registerVersion("@firebase/firestore-compat","0.3.12")}(Mc.Z);var $t=$(1205),Ag=$(6217);function Dg(n,e){return function Qw(n,e=Nc.z){return new Rc.y(t=>{let r;return null!=e?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{null!=r&&r()}})}(n,e)}function yc(n,e){return Dg(n,e).pipe((0,Ge.U)(t=>({payload:t,type:"query"})))}function Ji(n,e){return yc(n,e).pipe((0,ao.O)(void 0),uo(),(0,Ge.U)(([t,r])=>{const s=r.payload.docChanges(),i=s.map(o=>({type:o.type,payload:o}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((o,a)=>{const u=s.find(l=>l.doc.ref.isEqual(o.ref)),c=null==t?void 0:t.payload.docs.find(l=>l.ref.isEqual(o.ref));u&&JSON.stringify(u.doc.metadata)===JSON.stringify(o.metadata)||!u&&c&&JSON.stringify(c.metadata)===JSON.stringify(o.metadata)||i.push({type:"modified",payload:{oldIndex:a,newIndex:a,type:"modified",doc:o}})}),i}))}function kg(n,e,t){return Ji(n,t).pipe((0,co.R)((r,s)=>function Ww(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=function Zw(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return _c(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return _c(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return _c(n,e.oldIndex,1)}return n}(n,r))}),n}(r,s.map(i=>i.payload),e),[]),(0,xm.x)(),(0,Ge.U)(r=>r.map(s=>({type:s.type,payload:s}))))}function _c(n,e,t,...r){const s=n.slice();return s.splice(e,t,...r),s}function Ng(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}$(9260);class Rg{constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=Ji(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,Ge.U)(r=>r.filter(s=>e.indexOf(s.type)>-1)))),t.pipe((0,ao.O)(void 0),uo(),(0,Fc.h)(([r,s])=>s.length>0||!r),(0,Ge.U)(([r,s])=>s),ye.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,co.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=Ng(e);return kg(this.query,t,this.afs.schedulers.outsideAngular).pipe(ye.iC)}valueChanges(e={}){return yc(this.query,this.afs.schedulers.outsideAngular).pipe((0,Ge.U)(t=>t.payload.docs.map(r=>e.idField?Object.assign(Object.assign({},r.data()),{[e.idField]:r.id}):r.data())),ye.iC)}get(e){return(0,wt.D)(this.query.get(e)).pipe(ye.iC)}add(e){return this.ref.add(e)}doc(e){return new Pg(this.ref.doc(e),this.afs)}}class Pg{constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const r=this.ref.collection(e),{ref:s,query:i}=Og(r,t);return new Rg(s,i,this.afs)}snapshotChanges(){return function Hw(n,e){return Dg(n,e).pipe((0,ao.O)(void 0),uo(),(0,Ge.U)(([t,r])=>r.exists?null!=t&&t.exists?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(ye.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,Ge.U)(({payload:t})=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return(0,wt.D)(this.ref.get(e)).pipe(ye.iC)}}class Xw{constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?Ji(this.query,this.afs.schedulers.outsideAngular).pipe((0,Ge.U)(t=>t.filter(r=>e.indexOf(r.type)>-1)),(0,Fc.h)(t=>t.length>0),ye.iC):Ji(this.query,this.afs.schedulers.outsideAngular).pipe(ye.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,co.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=Ng(e);return kg(this.query,t,this.afs.schedulers.outsideAngular).pipe(ye.iC)}valueChanges(e={}){return yc(this.query,this.afs.schedulers.outsideAngular).pipe((0,Ge.U)(r=>r.payload.docs.map(s=>e.idField?Object.assign({[e.idField]:s.id},s.data()):s.data())),ye.iC)}get(e){return(0,wt.D)(this.query.get(e)).pipe(ye.iC)}}const Yw=new P.OlP("angularfire2.enableFirestorePersistence"),Jw=new P.OlP("angularfire2.firestore.persistenceSettings"),e0=new P.OlP("angularfire2.firestore.settings"),t0=new P.OlP("angularfire2.firestore.use-emulator");function Og(n,e=(t=>t)){return{query:e(n),ref:n}}let n0=(()=>{class n{constructor(t,r,s,i,o,a,u,c,l,h,d,f,y,I,w,D,R){this.schedulers=u;const b=(0,It.on)(t,a,r),F=l;h&&(0,$t.nw)(b,a,d,y,I,w,f,D),[this.firestore,this.persistenceEnabled$]=(0,It.cc)(`${b.name}.firestore`,"AngularFirestore",b.name,()=>{const G=a.runOutsideAngular(()=>b.firestore());if(i&&G.settings(i),F&&G.useEmulator(...F),s&&!(0,Em.PM)(o)){const B=()=>{try{return(0,wt.D)(G.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(ce){return typeof console<"u"&&console.warn(ce),(0,Es.of)(!1)}};return[G,a.runOutsideAngular(B)]}return[G,(0,Es.of)(!1)]},[i,F,s])}collection(t,r){let s;s="string"==typeof t?this.firestore.collection(t):t;const{ref:i,query:o}=Og(s,r),a=this.schedulers.ngZone.run(()=>i);return new Rg(a,o,this)}collectionGroup(t,r){const s=r||(o=>o),i=this.firestore.collectionGroup(t);return new Xw(s(i),this)}doc(t){let r;r="string"==typeof t?this.firestore.doc(t):t;const s=this.schedulers.ngZone.run(()=>r);return new Pg(s,this)}createId(){return this.firestore.collection("_").doc().id}}return n.\u0275fac=function(t){return new(t||n)(P.LFG(It.Dh),P.LFG(It.xv,8),P.LFG(Yw,8),P.LFG(e0,8),P.LFG(P.Lbi),P.LFG(P.R0b),P.LFG(ye.HU),P.LFG(Jw,8),P.LFG(t0,8),P.LFG($t.zQ,8),P.LFG($t.Qv,8),P.LFG($t.L6,8),P.LFG($t._Q,8),P.LFG($t.rT,8),P.LFG($t.lh,8),P.LFG($t.f7,8),P.LFG(Ag.nm,8))},n.\u0275prov=P.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();var Fg=$(3900);const Mg="firebasestorage.googleapis.com",Lg="storageBucket";class te extends M.ZR{constructor(e,t,r=0){super(vc(e),`Firebase Storage: ${t} (${vc(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,te.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return vc(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.message=this.customData.serverResponse?`${this._baseMessage}\n${this.customData.serverResponse}`:this._baseMessage}}var Q=(()=>(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(Q||(Q={})),Q))();function vc(n){return"storage/"+n}function wc(){return new te(Q.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function Ug(){return new te(Q.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function Vg(){return new te(Q.CANCELED,"User canceled the upload/download.")}function qg(){return new te(Q.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function rr(n){return new te(Q.INVALID_ARGUMENT,n)}function Bg(){return new te(Q.APP_DELETED,"The Firebase app was deleted.")}function Gg(n){return new te(Q.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function ws(n,e){return new te(Q.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function Is(n){throw new te(Q.INTERNAL_ERROR,"Internal error: "+n)}class Ae{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=Ae.makeFromUrl(e,t)}catch{return new Ae(e,"")}if(""===r.path)return r;throw function g0(n){return new te(Q.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}(e)}static makeFromUrl(e,t){let r=null;const s="([A-Za-z0-9.\\-_]+)",a=new RegExp("^gs://"+s+"(/(.*))?$","i");function c(F){F.path_=decodeURIComponent(F.path)}const h=t.replace(/[.]/g,"\\."),b=[{regex:a,indices:{bucket:1,path:3},postModify:function i(F){"/"===F.path.charAt(F.path.length-1)&&(F.path_=F.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${h}/v[A-Za-z0-9_]+/b/${s}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:c},{regex:new RegExp(`^https?://${t===Mg?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${s}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:c}];for(let F=0;F<b.length;F++){const G=b[F],B=G.regex.exec(e);if(B){let Be=B[G.indices.path];Be||(Be=""),r=new Ae(B[G.indices.bucket],Be),G.postModify(r);break}}if(null==r)throw function f0(n){return new te(Q.INVALID_URL,"Invalid URL '"+n+"'.")}(e);return r}}class v0{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function eo(n){return"string"==typeof n||n instanceof String}function zg(n){return Ic()&&n instanceof Blob}function Ic(){return typeof Blob<"u"&&!(0,M.UG)()}function Tc(n,e,t,r){if(r<e)throw rr(`Invalid value for '${n}'. Expected ${e} or greater.`);if(r>t)throw rr(`Invalid value for '${n}'. Expected ${t} or less.`)}function _t(n,e,t){let r=e;return null==t&&(r=`https://${e}`),`${t}://${r}/v0${n}`}function jg(n){const e=encodeURIComponent;let t="?";for(const r in n)n.hasOwnProperty(r)&&(t=t+(e(r)+"=")+e(n[r])+"&");return t=t.slice(0,-1),t}var Kt=(()=>(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"}(Kt||(Kt={})),Kt))();function $g(n,e){const t=n>=500&&n<600,s=-1!==[408,429].indexOf(n),i=-1!==e.indexOf(n);return t||s||i}class S0{constructor(e,t,r,s,i,o,a,u,c,l,h,d=!0){this.url_=e,this.method_=t,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=u,this.timeout_=c,this.progressCallback_=l,this.connectionFactory_=h,this.retry=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((f,y)=>{this.resolve_=f,this.reject_=y,this.start_()})}start_(){const t=(r,s)=>{const i=this.resolve_,o=this.reject_,a=s.connection;if(s.wasSuccessCode)try{const u=this.callback_(a,a.getResponse());!function T0(n){return void 0!==n}(u)?i():i(u)}catch(u){o(u)}else if(null!==a){const u=wc();u.serverResponse=a.getErrorText(),o(this.errorCallback_?this.errorCallback_(a,u):u)}else o(s.canceled?this.appDelete_?Bg():Vg():Ug())};this.canceled_?t(0,new to(!1,null,!0)):this.backoffId_=function w0(n,e,t){let r=1,s=null,i=null,o=!1,a=0;function u(){return 2===a}let c=!1;function l(...w){c||(c=!0,e.apply(null,w))}function h(w){s=setTimeout(()=>{s=null,n(f,u())},w)}function d(){i&&clearTimeout(i)}function f(w,...D){if(c)return void d();if(w)return d(),void l.call(null,w,...D);if(u()||o)return d(),void l.call(null,w,...D);let b;r<64&&(r*=2),1===a?(a=2,b=0):b=1e3*(r+Math.random()),h(b)}let y=!1;function I(w){y||(y=!0,d(),!c&&(null!==s?(w||(a=2),clearTimeout(s),h(0)):w||(a=1)))}return h(0),i=setTimeout(()=>{o=!0,I(!0)},t),I}((r,s)=>{if(s)return void r(!1,new to(!1,null,!0));const i=this.connectionFactory_();this.pendingConnection_=i;const o=a=>{null!==this.progressCallback_&&this.progressCallback_(a.loaded,a.lengthComputable?a.total:-1)};null!==this.progressCallback_&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const a=i.getErrorCode()===Kt.NO_ERROR,u=i.getStatus();if(!a||$g(u,this.additionalRetryCodes_)&&this.retry){const l=i.getErrorCode()===Kt.ABORT;return void r(!1,new to(!1,null,l))}const c=-1!==this.successCodes_.indexOf(u);r(!0,new to(c,i))})},t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&function I0(n){n(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class to{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function R0(...n){const e=function N0(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}();if(void 0!==e){const t=new e;for(let r=0;r<n.length;r++)t.append(n[r]);return t.getBlob()}if(Ic())return new Blob(n);throw new te(Q.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}const qe={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class xc{constructor(e,t){this.data=e,this.contentType=t||null}}function Ec(n,e){switch(n){case qe.RAW:return new xc(Kg(e));case qe.BASE64:case qe.BASE64URL:return new xc(Qg(n,e));case qe.DATA_URL:return new xc(function M0(n){const e=new Hg(n);return e.base64?Qg(qe.BASE64,e.rest):function F0(n){let e;try{e=decodeURIComponent(n)}catch{throw ws(qe.DATA_URL,"Malformed data URL.")}return Kg(e)}(e.rest)}(e),function L0(n){return new Hg(n).contentType}(e))}throw wc()}function Kg(n){const e=[];for(let t=0;t<n.length;t++){let r=n.charCodeAt(t);r<=127?e.push(r):r<=2047?e.push(192|r>>6,128|63&r):55296==(64512&r)?t<n.length-1&&56320==(64512&n.charCodeAt(t+1))?(r=65536|(1023&r)<<10|1023&n.charCodeAt(++t),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)):e.push(239,191,189):56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function Qg(n,e){switch(n){case qe.BASE64:{const s=-1!==e.indexOf("-"),i=-1!==e.indexOf("_");if(s||i)throw ws(n,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case qe.BASE64URL:{const s=-1!==e.indexOf("+"),i=-1!==e.indexOf("/");if(s||i)throw ws(n,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=function O0(n){if(typeof atob>"u")throw function _0(n){return new te(Q.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}("base-64");return atob(n)}(e)}catch(s){throw s.message.includes("polyfill")?s:ws(n,"Invalid character found")}const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r}class Hg{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw ws(qe.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=t[1]||null;null!=r&&(this.base64=function U0(n,e){return n.length>=e.length&&n.substring(n.length-e.length)===e}(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}class it{constructor(e,t){let r=0,s="";zg(e)?(this.data_=e,r=e.size,s=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,t){if(zg(this.data_)){const s=function P0(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}(this.data_,e,t);return null===s?null:new it(s)}{const r=new Uint8Array(this.data_.buffer,e,t-e);return new it(r,!0)}}static getBlob(...e){if(Ic()){const t=e.map(r=>r instanceof it?r.data_:r);return new it(R0.apply(null,t))}{const t=e.map(o=>eo(o)?Ec(qe.RAW,o).data:o.data_);let r=0;t.forEach(o=>{r+=o.byteLength});const s=new Uint8Array(r);let i=0;return t.forEach(o=>{for(let a=0;a<o.length;a++)s[i++]=o[a]}),new it(s,!0)}}uploadData(){return this.data_}}function Sc(n){let e;try{e=JSON.parse(n)}catch{return null}return function E0(n){return"object"==typeof n&&!Array.isArray(n)}(e)?e:null}function Wg(n){const e=n.lastIndexOf("/",n.length-2);return-1===e?n:n.slice(e+1)}function B0(n,e){return e}class Pe{constructor(e,t,r,s){this.server=e,this.local=t||e,this.writable=!!r,this.xform=s||B0}}let no=null;function Ts(){if(no)return no;const n=[];n.push(new Pe("bucket")),n.push(new Pe("generation")),n.push(new Pe("metageneration")),n.push(new Pe("name","fullPath",!0));const t=new Pe("name");t.xform=function e(i,o){return function G0(n){return!eo(n)||n.length<2?n:Wg(n)}(o)},n.push(t);const s=new Pe("size");return s.xform=function r(i,o){return void 0!==o?Number(o):o},n.push(s),n.push(new Pe("timeCreated")),n.push(new Pe("updated")),n.push(new Pe("md5Hash",null,!0)),n.push(new Pe("cacheControl",null,!0)),n.push(new Pe("contentDisposition",null,!0)),n.push(new Pe("contentEncoding",null,!0)),n.push(new Pe("contentLanguage",null,!0)),n.push(new Pe("contentType",null,!0)),n.push(new Pe("metadata","customMetadata",!0)),no=n,no}function Zg(n,e,t){const r=Sc(e);return null===r?null:function j0(n,e,t){const r={type:"file"},s=t.length;for(let i=0;i<s;i++){const o=t[i];r[o.local]=o.xform(r,e[o.server])}return function z0(n,e){Object.defineProperty(n,"ref",{get:function t(){const i=new Ae(n.bucket,n.fullPath);return e._makeStorageReference(i)}})}(r,n),r}(n,r,t)}function bc(n,e){const t={},r=e.length;for(let s=0;s<r;s++){const i=e[s];i.writable&&(t[i.server]=n[i.local])}return JSON.stringify(t)}const Xg="prefixes",Yg="items";class ot{constructor(e,t,r,s){this.url=e,this.method=t,this.handler=r,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function at(n){if(!n)throw wc()}function ro(n,e){return function t(r,s){const i=Zg(n,s,e);return at(null!==i),i}}function sr(n){return function e(t,r){let s;return s=401===t.getStatus()?t.getErrorText().includes("Firebase App Check token is invalid")?function h0(){return new te(Q.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}():function l0(){return new te(Q.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again.")}():402===t.getStatus()?function c0(n){return new te(Q.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}(n.bucket):403===t.getStatus()?function d0(n){return new te(Q.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}(n.path):r,s.status=t.getStatus(),s.serverResponse=r.serverResponse,s}}function xs(n){const e=sr(n);return function t(r,s){let i=e(r,s);return 404===r.getStatus()&&(i=function u0(n){return new te(Q.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}(n.path)),i.serverResponse=s.serverResponse,i}}function Jg(n,e,t){const s=_t(e.fullServerUrl(),n.host,n._protocol),o=n.maxOperationRetryTime,a=new ot(s,"GET",ro(n,t),o);return a.errorHandler=xs(e),a}function Z0(n,e,t,r,s){const i={};i.prefix=e.isRoot?"":e.path+"/",t&&t.length>0&&(i.delimiter=t),r&&(i.pageToken=r),s&&(i.maxResults=s);const a=_t(e.bucketOnlyServerUrl(),n.host,n._protocol),c=n.maxOperationRetryTime,l=new ot(a,"GET",function H0(n,e){return function t(r,s){const i=function Q0(n,e,t){const r=Sc(t);return null===r?null:function K0(n,e,t){const r={prefixes:[],items:[],nextPageToken:t.nextPageToken};if(t[Xg])for(const s of t[Xg]){const i=s.replace(/\/$/,""),o=n._makeStorageReference(new Ae(e,i));r.prefixes.push(o)}if(t[Yg])for(const s of t[Yg]){const i=n._makeStorageReference(new Ae(e,s.name));r.items.push(i)}return r}(n,e,r)}(n,e,s);return at(null!==i),i}}(n,e.bucket),c);return l.urlParams=i,l.errorHandler=sr(e),l}function tm(n,e,t){const r=Object.assign({},t);return r.fullPath=n.path,r.size=e.size(),r.contentType||(r.contentType=function eI(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}(null,e)),r}class so{constructor(e,t,r,s){this.current=e,this.total=t,this.finalized=!!r,this.metadata=s||null}}function Cc(n,e){let t=null;try{t=n.getResponseHeader("X-Goog-Upload-Status")}catch{at(!1)}return at(!!t&&-1!==(e||["active"]).indexOf(t)),t}const sI={STATE_CHANGED:"state_changed"},Oe={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function Ac(n){switch(n){case"running":case"pausing":case"canceling":return Oe.RUNNING;case"paused":return Oe.PAUSED;case"success":return Oe.SUCCESS;case"canceled":return Oe.CANCELED;default:return Oe.ERROR}}class iI{constructor(e,t,r){if(function x0(n){return"function"==typeof n}(e)||null!=t||null!=r)this.next=e,this.error=null!=t?t:void 0,this.complete=null!=r?r:void 0;else{const i=e;this.next=i.next,this.error=i.error,this.complete=i.complete}}}function ir(n){return(...e)=>{Promise.resolve().then(()=>n(...e))}}let sm=null;class oI{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Kt.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Kt.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Kt.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,s){if(this.sent_)throw Is("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==s)for(const i in s)s.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,s[i].toString());return void 0!==r?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Is("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Is("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Is("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Is("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class aI extends oI{initXhr(){this.xhr_.responseType="text"}}function We(){return sm?sm():new aI}class im{constructor(e,t,r=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=r,this._mappings=Ts(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=s=>{if(this._request=void 0,this._chunkMultiplier=1,s._codeEquals(Q.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const i=this.isExponentialBackoffExpired();if($g(s.status,[])){if(!i)return this.sleepTime=Math.max(2*this.sleepTime,1e3),this._needToFetchStatus=!0,void this.completeTransitions_();s=Ug()}this._error=s,this._transition("error")}},this._metadataErrorHandler=s=>{this._request=void 0,s._codeEquals(Q.CANCELED)?this.completeTransitions_():(this._error=s,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((s,i)=>{this._resolve=s,this._reject=i,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>262144}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([t,r])=>{switch(this._state){case"running":e(t,r);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}})}_createResumable(){this._resolveToken((e,t)=>{const r=function tI(n,e,t,r,s){const i=e.bucketOnlyServerUrl(),o=tm(e,r,s),a={name:o.fullPath},u=_t(i,n.host,n._protocol),l={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},h=bc(o,t),y=new ot(u,"POST",function f(I){let w;Cc(I);try{w=I.getResponseHeader("X-Goog-Upload-URL")}catch{at(!1)}return at(eo(w)),w},n.maxUploadRetryTime);return y.urlParams=a,y.headers=l,y.body=h,y.errorHandler=sr(e),y}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),s=this._ref.storage._makeRequest(r,We,e,t);this._request=s,s.getPromise().then(i=>{this._request=void 0,this._uploadUrl=i,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((t,r)=>{const s=function nI(n,e,t,r){const u=new ot(t,"POST",function i(c){const l=Cc(c,["active","final"]);let h=null;try{h=c.getResponseHeader("X-Goog-Upload-Size-Received")}catch{at(!1)}h||at(!1);const d=Number(h);return at(!isNaN(d)),new so(d,r.size(),"final"===l)},n.maxUploadRetryTime);return u.headers={"X-Goog-Upload-Command":"query"},u.errorHandler=sr(e),u}(this._ref.storage,this._ref._location,e,this._blob),i=this._ref.storage._makeRequest(s,We,t,r);this._request=i,i.getPromise().then(o=>{this._request=void 0,this._updateProgress(o.current),this._needToFetchStatus=!1,o.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=262144*this._chunkMultiplier,t=new so(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken((s,i)=>{let o;try{o=function rI(n,e,t,r,s,i,o,a){const u=new so(0,0);if(o?(u.current=o.current,u.total=o.total):(u.current=0,u.total=r.size()),r.size()!==u.total)throw function p0(){return new te(Q.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}();const c=u.total-u.current;let l=c;s>0&&(l=Math.min(l,s));const h=u.current;let f="";f=0===l?"finalize":c===l?"upload, finalize":"upload";const y={"X-Goog-Upload-Command":f,"X-Goog-Upload-Offset":`${u.current}`},I=r.slice(h,h+l);if(null===I)throw qg();const b=new ot(t,"POST",function w(F,G){const B=Cc(F,["active","final"]),ce=u.current+l,Be=r.size();let or;return or="final"===B?ro(e,i)(F,G):null,new so(ce,Be,"final"===B,or)},e.maxUploadRetryTime);return b.headers=y,b.body=I.uploadData(),b.progressCallback=a||null,b.errorHandler=sr(n),b}(this._ref._location,this._ref.storage,r,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(u){return this._error=u,void this._transition("error")}const a=this._ref.storage._makeRequest(o,We,s,i,!1);this._request=a,a.getPromise().then(u=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(u.current),u.finalized?(this._metadata=u.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){262144*this._chunkMultiplier*2<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{const r=Jg(this._ref.storage,this._ref._location,this._mappings),s=this._ref.storage._makeRequest(r,We,e,t);this._request=s,s.getPromise().then(i=>{this._request=void 0,this._metadata=i,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{const r=function nm(n,e,t,r,s){const i=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"},u=function a(){let b="";for(let F=0;F<2;F++)b+=Math.random().toString().slice(2);return b}();o["Content-Type"]="multipart/related; boundary="+u;const c=tm(e,r,s),l=bc(c,t),f=it.getBlob("--"+u+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+l+"\r\n--"+u+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",r,"\r\n--"+u+"--");if(null===f)throw qg();const y={name:c.fullPath},I=_t(i,n.host,n._protocol),D=n.maxUploadRetryTime,R=new ot(I,"POST",ro(n,t),D);return R.urlParams=y,R.headers=o,R.body=f.uploadData(),R.errorHandler=sr(e),R}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),s=this._ref.storage._makeRequest(r,We,e,t);this._request=s,s.getPromise().then(i=>{this._request=void 0,this._metadata=i,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":case"error":case"success":this._state=e,this._notifyObservers();break;case"canceled":this._error=Vg(),this._state=e,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){const e=Ac(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,r,s){const i=new iI(t||void 0,r||void 0,s||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const t=this._observers.indexOf(e);-1!==t&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(t=>{this._notifyObserver(t)})}_finishPromise(){if(void 0!==this._resolve){let e=!0;switch(Ac(this._state)){case Oe.SUCCESS:ir(this._resolve.bind(null,this.snapshot))();break;case Oe.CANCELED:case Oe.ERROR:ir(this._reject.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(Ac(this._state)){case Oe.RUNNING:case Oe.PAUSED:e.next&&ir(e.next.bind(e,this.snapshot))();break;case Oe.SUCCESS:e.complete&&ir(e.complete.bind(e))();break;default:e.error&&ir(e.error.bind(e,this._error))()}}resume(){const e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e}pause(){const e="running"===this._state;return e&&this._transition("pausing"),e}cancel(){const e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e}}class wn{constructor(e,t){this._service=e,this._location=t instanceof Ae?t:Ae.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new wn(e,t)}get root(){const e=new Ae(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Wg(this._location.path)}get storage(){return this._service}get parent(){const e=function V0(n){if(0===n.length)return null;const e=n.lastIndexOf("/");return-1===e?"":n.slice(0,e)}(this._location.path);if(null===e)return null;const t=new Ae(this._location.bucket,e);return new wn(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw Gg(e)}}function am(n,e,t){return Dc.apply(this,arguments)}function Dc(){return Dc=(0,p.Z)(function*(n,e,t){const s=yield um(n,{pageToken:t});e.prefixes.push(...s.prefixes),e.items.push(...s.items),null!=s.nextPageToken&&(yield am(n,e,s.nextPageToken))}),Dc.apply(this,arguments)}function um(n,e){null!=e&&"number"==typeof e.maxResults&&Tc("options.maxResults",1,1e3,e.maxResults);const t=e||{},r=Z0(n.storage,n._location,"/",t.pageToken,t.maxResults);return n.storage.makeRequestWithTokens(r,We)}function vI(n){n._throwIfRoot("getDownloadURL");const e=function X0(n,e,t){const s=_t(e.fullServerUrl(),n.host,n._protocol),o=n.maxOperationRetryTime,a=new ot(s,"GET",function W0(n,e){return function t(r,s){const i=Zg(n,s,e);return at(null!==i),function $0(n,e,t,r){const s=Sc(e);if(null===s||!eo(s.downloadTokens))return null;const i=s.downloadTokens;if(0===i.length)return null;const o=encodeURIComponent;return i.split(",").map(c=>{const h=n.fullPath;return _t("/b/"+o(n.bucket)+"/o/"+o(h),t,r)+jg({alt:"media",token:c})})[0]}(i,s,n.host,n._protocol)}}(n,t),o);return a.errorHandler=xs(e),a}(n.storage,n._location,Ts());return n.storage.makeRequestWithTokens(e,We).then(t=>{if(null===t)throw function y0(){return new te(Q.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}();return t})}function cm(n,e){const t=function q0(n,e){const t=e.split("/").filter(r=>r.length>0).join("/");return 0===n.length?t:n+"/"+t}(n._location.path,e),r=new Ae(n._location.bucket,t);return new wn(n.storage,r)}function lm(n,e){if(n instanceof kc){const t=n;if(null==t._bucket)throw function m0(){return new te(Q.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Lg+"' property when initializing the app?")}();const r=new wn(t,t._bucket);return null!=e?lm(r,e):r}return void 0!==e?cm(n,e):n}function xI(n,e){if(e&&function II(n){return/^[A-Za-z]+:\/\//.test(n)}(e)){if(n instanceof kc)return function TI(n,e){return new wn(n,e)}(n,e);throw rr("To use ref(service, url), the first argument must be a Storage instance.")}return lm(n,e)}function hm(n,e){const t=null==e?void 0:e[Lg];return null==t?null:Ae.makeFromBucketSpec(t,n)}class kc{constructor(e,t,r,s,i){this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._bucket=null,this._host=Mg,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=s?Ae.makeFromBucketSpec(s,this._host):hm(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._bucket=null!=this._url?Ae.makeFromBucketSpec(this._url,e):hm(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Tc("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Tc("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){var e=this;return(0,p.Z)(function*(){if(e._overrideAuthToken)return e._overrideAuthToken;const t=e._authProvider.getImmediate({optional:!0});if(t){const r=yield t.getToken();if(null!==r)return r.accessToken}return null})()}_getAppCheckToken(){var e=this;return(0,p.Z)(function*(){const t=e._appCheckProvider.getImmediate({optional:!0});return t?(yield t.getToken()).token:null})()}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new wn(this,e)}_makeRequest(e,t,r,s,i=!0){if(this._deleted)return new v0(Bg());{const o=function k0(n,e,t,r,s,i,o=!0){const a=jg(n.urlParams),u=n.url+a,c=Object.assign({},n.headers);return function A0(n,e){e&&(n["X-Firebase-GMPID"]=e)}(c,e),function b0(n,e){null!==e&&e.length>0&&(n.Authorization="Firebase "+e)}(c,t),function C0(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(null!=e?e:"AppManager")}(c,i),function D0(n,e){null!==e&&(n["X-Firebase-AppCheck"]=e)}(c,r),new S0(u,n.method,c,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,s,o)}(e,this._appId,r,s,t,this._firebaseVersion,i);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}makeRequestWithTokens(e,t){var r=this;return(0,p.Z)(function*(){const[s,i]=yield Promise.all([r._getAuthToken(),r._getAppCheckToken()]);return r._makeRequest(e,t,s,i).getPromise()})()}}const dm="@firebase/storage";function mm(n,e){return xI(n=(0,M.m9)(n),e)}function PI(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),r=n.getProvider("auth-internal"),s=n.getProvider("app-check-internal");return new kc(t,r,s,e,Tt.SDK_VERSION)}!function OI(){(0,Tt._registerComponent)(new Ss.wA("storage",PI,"PUBLIC").setMultipleInstances(!0)),(0,Tt.registerVersion)(dm,"0.11.2",""),(0,Tt.registerVersion)(dm,"0.11.2","esm2017")}();class io{constructor(e,t,r){this._delegate=e,this.task=t,this.ref=r}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}class ym{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new io(this._delegate.snapshot,this,this._ref)}then(e,t){return this._delegate.then(r=>{if(e)return e(new io(r,this,this._ref))},t)}on(e,t,r,s){let i;return t&&(i="function"==typeof t?o=>t(new io(o,this,this._ref)):{next:t.next?o=>t.next(new io(o,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,i,r||void 0,s||void 0)}}class _m{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new vt(e,this._service))}get items(){return this._delegate.items.map(e=>new vt(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}class vt{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){const t=function RI(n,e){return cm(n,e)}(this._delegate,e);return new vt(t,this.storage)}get root(){return new vt(this._delegate.root,this.storage)}get parent(){const e=this._delegate.parent;return null==e?null:new vt(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new ym(function SI(n,e,t){return function gI(n,e,t){return n._throwIfRoot("uploadBytesResumable"),new im(n,new it(e),t)}(n=(0,M.m9)(n),e,t)}(this._delegate,e,t),this)}putString(e,t=qe.RAW,r){this._throwIfRoot("putString");const s=Ec(t,e),i=Object.assign({},r);return null==i.contentType&&null!=s.contentType&&(i.contentType=s.contentType),new ym(new im(this._delegate,new it(s.data,!0),i),this)}listAll(){return function DI(n){return function pI(n){const e={prefixes:[],items:[]};return am(n,e).then(()=>e)}(n=(0,M.m9)(n))}(this._delegate).then(e=>new _m(e,this.storage))}list(e){return function AI(n,e){return um(n=(0,M.m9)(n),e)}(this._delegate,e||void 0).then(t=>new _m(t,this.storage))}getMetadata(){return function bI(n){return function yI(n){n._throwIfRoot("getMetadata");const e=Jg(n.storage,n._location,Ts());return n.storage.makeRequestWithTokens(e,We)}(n=(0,M.m9)(n))}(this._delegate)}updateMetadata(e){return function CI(n,e){return function _I(n,e){n._throwIfRoot("updateMetadata");const t=function Y0(n,e,t,r){const i=_t(e.fullServerUrl(),n.host,n._protocol),a=bc(t,r),c=n.maxOperationRetryTime,l=new ot(i,"PATCH",ro(n,r),c);return l.headers={"Content-Type":"application/json; charset=utf-8"},l.body=a,l.errorHandler=xs(e),l}(n.storage,n._location,e,Ts());return n.storage.makeRequestWithTokens(t,We)}(n=(0,M.m9)(n),e)}(this._delegate,e)}getDownloadURL(){return function kI(n){return vI(n=(0,M.m9)(n))}(this._delegate)}delete(){return this._throwIfRoot("delete"),function NI(n){return function wI(n){n._throwIfRoot("deleteObject");const e=function J0(n,e){const r=_t(e.fullServerUrl(),n.host,n._protocol),a=new ot(r,"DELETE",function o(u,c){},n.maxOperationRetryTime);return a.successCodes=[200,204],a.errorHandler=xs(e),a}(n.storage,n._location);return n.storage.makeRequestWithTokens(e,We)}(n=(0,M.m9)(n))}(this._delegate)}_throwIfRoot(e){if(""===this._delegate._location.path)throw Gg(e)}}class vm{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(wm(e))throw rr("ref() expected a child path but got a URL, use refFromURL instead.");return new vt(mm(this._delegate,e),this)}refFromURL(e){if(!wm(e))throw rr("refFromURL() expected a full URL but got a child path, use ref() instead.");try{Ae.makeFromUrl(e,this._delegate.host)}catch{throw rr("refFromUrl() expected a valid full URL but got an invalid one.")}return new vt(mm(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,r={}){!function pm(n,e,t,r={}){!function EI(n,e,t,r={}){n.host=`${e}:${t}`,n._protocol="http";const{mockUserToken:s}=r;s&&(n._overrideAuthToken="string"==typeof s?s:(0,M.Sg)(s,n.app.options.projectId))}(n,e,t,r)}(this._delegate,e,t,r)}}function wm(n){return/^[A-Za-z]+:\/\//.test(n)}function UI(n,{instanceIdentifier:e}){const t=n.getProvider("app-compat").getImmediate(),r=n.getProvider("storage").getImmediate({identifier:e});return new vm(t,r)}function Im(n){const e=function qI(n){return new Rc.y(e=>{const t=o=>e.next(o);t(n.snapshot);const i=n.on("state_changed",t);return n.then(o=>{t(o),e.complete()},o=>{t(n.snapshot),(o=>{e.error(o)})(o)}),function(){i()}}).pipe(function r0(n,e=Nc.z){return(0,Pc.e)((t,r)=>{let s=null,i=null,o=null;const a=()=>{if(s){s.unsubscribe(),s=null;const c=i;i=null,r.next(c)}};function u(){const c=o+n,l=e.now();if(l<c)return s=this.schedule(void 0,c-l),void r.add(s);a()}t.subscribe((0,Oc.x)(r,c=>{i=c,o=e.now(),s||(s=e.schedule(u,n),r.add(s))},()=>{a(),r.complete()},void 0,()=>{i=s=null}))})}(0))}(n);return{task:n,then:n.then.bind(n),catch:n.catch.bind(n),pause:n.pause.bind(n),cancel:n.cancel.bind(n),resume:n.resume.bind(n),snapshotChanges:()=>e,percentageChanges:()=>e.pipe((0,Ge.U)(t=>t.bytesTransferred/t.totalBytes*100))}}function oo(n){return{getDownloadURL:()=>(0,Es.of)(void 0).pipe(ye.fc,(0,Fg.w)(()=>n.getDownloadURL()),ye.iC),getMetadata:()=>(0,Es.of)(void 0).pipe(ye.fc,(0,Fg.w)(()=>n.getMetadata()),ye.iC),delete:()=>(0,wt.D)(n.delete()),child:e=>oo(n.child(e)),updateMetadata:e=>(0,wt.D)(n.updateMetadata(e)),put:(e,t)=>Im(n.put(e,t)),putString:(e,t,r)=>Im(n.putString(e,t,r)),list:e=>(0,wt.D)(n.list(e)),listAll:()=>(0,wt.D)(n.listAll())}}!function VI(n){const e={TaskState:Oe,TaskEvent:sI,StringFormat:qe,Storage:vm,Reference:vt};n.INTERNAL.registerComponent(new Ss.wA("storage-compat",UI,"PUBLIC").setServiceProps(e).setMultipleInstances(!0)),n.registerVersion("@firebase/storage-compat","0.3.2")}(Mc.Z);const BI=new P.OlP("angularfire2.storageBucket"),GI=new P.OlP("angularfire2.storage.maxUploadRetryTime"),zI=new P.OlP("angularfire2.storage.maxOperationRetryTime"),jI=new P.OlP("angularfire2.storage.use-emulator");let $I=(()=>{class n{constructor(t,r,s,i,o,a,u,c,l,h){const d=(0,It.on)(t,o,r);this.storage=(0,It.cc)(`${d.name}.storage.${s}`,"AngularFireStorage",d.name,()=>{const f=o.runOutsideAngular(()=>d.storage(s||void 0)),y=l;return y&&f.useEmulator(...y),u&&f.setMaxUploadRetryTime(u),c&&f.setMaxOperationRetryTime(c),f},[u,c])}ref(t){return oo(this.storage.ref(t))}refFromURL(t){return oo(this.storage.refFromURL(t))}upload(t,r,s){return oo(this.storage.ref(t)).put(r,s)}}return n.\u0275fac=function(t){return new(t||n)(P.LFG(It.Dh),P.LFG(It.xv,8),P.LFG(BI,8),P.LFG(P.Lbi),P.LFG(P.R0b),P.LFG(ye.HU),P.LFG(GI,8),P.LFG(zI,8),P.LFG(jI,8),P.LFG(Ag.nm,8))},n.\u0275prov=P.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})(),KI=(()=>{class n{constructor(t,r){this.firestore=t,this.afStorage=r}getHuecas(){return this.firestore.collection("Huecas").snapshotChanges().pipe((0,Ge.U)(t=>t.map(r=>{const s=r.payload.doc.data();return{id:r.payload.doc.id,...s}})))}getHuecaById(t){return this.firestore.collection("Huecas").doc(t).valueChanges()}updateHueca(t,r,s,i,o){return this.firestore.collection("Huecas").doc(t).update({nombre:r,descripcion:s})}updateCoordinates(t,r,s){return this.firestore.collection("Huecas").doc(t).update({latitude:r,longitude:s})}deleteHueca(t){return this.firestore.collection("Huecas").doc(t).delete()}guardarDatosHuecaConFotos(t,r,s,i,o){var a=this;return(0,p.Z)(function*(){const u=o.map(function(){var l=(0,p.Z)(function*(h){const d=`filesStorage/${(new Date).getTime()}_${h.name}`,f=a.afStorage.ref(d);return yield a.afStorage.upload(d,h),yield f.getDownloadURL().toPromise()});return function(h){return l.apply(this,arguments)}}()),c=yield Promise.all(u);return a.firestore.collection("Huecas").add({nombre:t,descripcion:r,latitude:s,longitude:i,fotos:c})})()}}return n.\u0275fac=function(t){return new(t||n)(P.LFG(n0),P.LFG($I))},n.\u0275prov=P.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})()}}]);